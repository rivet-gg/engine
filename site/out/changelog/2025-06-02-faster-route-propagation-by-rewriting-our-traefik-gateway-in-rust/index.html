<!DOCTYPE html><html lang="en" class="dark"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/565f4925fe90494c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/b2a053553e69c47d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/9ded352fd1582faa.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-1a373ad8fd0a15c2.js"/><script src="/_next/static/chunks/c7879cf7-ee7261df99d96810.js" async=""></script><script src="/_next/static/chunks/4870-70facba32d301b1a.js" async=""></script><script src="/_next/static/chunks/main-app-9dd32803f609a1e8.js" async=""></script><script src="/_next/static/chunks/f67032f2-9c72234b0d8f41b4.js" async=""></script><script src="/_next/static/chunks/9da6db1e-dbfab9261a7c6a02.js" async=""></script><script src="/_next/static/chunks/7134-7a2ccc87dc1f1c96.js" async=""></script><script src="/_next/static/chunks/9078-9c4b2ff48765f274.js" async=""></script><script src="/_next/static/chunks/6855-c97c866fb9680afe.js" async=""></script><script src="/_next/static/chunks/3285-d8e61078321bd50f.js" async=""></script><script src="/_next/static/chunks/9657-90d7d8e86cd8d7b3.js" async=""></script><script src="/_next/static/chunks/1983-7439545cf8f39348.js" async=""></script><script src="/_next/static/chunks/7678-80db3db210142fa5.js" async=""></script><script src="/_next/static/chunks/3459-aa0b1d8277b7bbbd.js" async=""></script><script src="/_next/static/chunks/app/layout-e3cfc449b871f8f6.js" async=""></script><script src="/_next/static/chunks/5051-51ff92d736937f41.js" async=""></script><script src="/_next/static/chunks/3545-9e4a648ea2701538.js" async=""></script><script src="/_next/static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js" async=""></script><script src="/_next/static/chunks/3591-193e430a542376f5.js" async=""></script><script src="/_next/static/chunks/4395-09a8f40ef66f9d5c.js" async=""></script><script src="/_next/static/chunks/7261-eddb3e7984c54a8d.js" async=""></script><script src="/_next/static/chunks/app/(v2)/(blog)/changelog/layout-b36961b4d0c22716.js" async=""></script><script src="/_next/static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js" async=""></script><script src="/_next/static/chunks/3733-74f52baf8b8f8b32.js" async=""></script><script src="/_next/static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-GHX1328ZFD" as="script"/><link rel="preload" href="https://analytics.ahrefs.com/analytics.js" as="script"/><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png?20240925"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png?20240925"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png?20240925"/><link rel="manifest" href="/icons/site.webmanifest?20240925"/><link rel="mask-icon" href="/icons/safari-pinned-tab.svg?20240925" color="#5bbad5"/><meta name="msapplication-TileColor" content="#0c0a09"/><meta name="theme-color" content="#0c0a09"/><script>(self.__next_s=self.__next_s||[]).push(["https://analytics.ahrefs.com/analytics.js",{"data-key":"wQAsHie9RgJMLNhmUbr/fQ"}])</script><title>2,000x faster route propagation by rewriting our Traefik gateway in Rust</title><meta name="description" content="Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We&#x27;ve rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform."/><meta name="author" content="Nathan Flurry"/><meta property="og:title" content="2,000x faster route propagation by rewriting our Traefik gateway in Rust"/><meta property="og:description" content="Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We&#x27;ve rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform."/><meta property="og:image" content="http://localhost:3000/_next/static/media/image.c02c4de6.png"/><meta property="og:image:width" content="2048"/><meta property="og:image:height" content="1024"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-06-02T00:00:00.000Z"/><meta property="article:author" content="Nathan Flurry"/><meta property="article:section" content="Technical"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@rivetgg"/><meta name="twitter:title" content="2,000x faster route propagation by rewriting our Traefik gateway in Rust"/><meta name="twitter:description" content="Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We&#x27;ve rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform."/><meta name="twitter:image" content="http://localhost:3000/_next/static/media/image.c02c4de6.png"/><meta name="twitter:image:width" content="2048"/><meta name="twitter:image:height" content="1024"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="dark"><div class="fixed top-0 z-50 w-full max-w-[1200px] md:left-1/2 md:top-4 md:-translate-x-1/2 md:px-8"><div class="hero-bg-exclude relative before:pointer-events-none before:absolute before:inset-[-1px] before:z-20 before:hidden before:rounded-2xl before:border before:content-[&quot;&quot;] before:transition-colors before:duration-300 before:ease-in-out md:before:block before:border-transparent"><div class="absolute inset-0 -z-[1] hidden overflow-hidden rounded-2xl transition-all duration-300 ease-in-out md:block bg-background backdrop-blur-none"></div><header class="bg-background/60 border-b-border sticky top-0 z-10 flex flex-col items-center border-b backdrop-blur pt-2 pb-2 md:static md:bg-transparent md:rounded-2xl md:max-w-[1200px] md:border-transparent md:backdrop-none [&amp;&gt;div:first-child]:px-3 md:backdrop-blur-none transition-all hover:opacity-100 opacity-80"><div class="w-full px-8 flex min-h-10 flex-col justify-center"><div class="flex w-full items-center gap-4"><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:size-[1em] border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-10 w-10 gap-1.5 shrink-0 md:hidden text-foreground" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«Rmjerddb»" data-state="closed"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars size-5" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"></path></svg><span class="sr-only">Toggle navigation menu</span></button><nav class="flex-1 font-medium md:flex md:flex-row md:items-center md:gap-3 md:text-sm lg:gap-4"><span data-state="closed" data-slot="context-menu-trigger" style="-webkit-touch-callout:none"><a href="/"><img alt="Rivet logo" loading="lazy" width="80" height="24" decoding="async" data-nimg="1" class="ml-1 w-20" style="color:transparent" src="/_next/static/media/icon-text-white.f8263556.svg"/></a></span><div class="hidden md:flex"><div class="flex items-center font-v2 subpixel-antialiased"><div class="px-2.5 py-2 opacity-60 hover:opacity-100 transition-all duration-200"><a class="text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white" href="/docs/">Documentation</a></div><div class="px-2.5 py-2 opacity-60 hover:opacity-100 transition-all duration-200"><a class="text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white" href="/cloud/">Cloud</a></div><div class="px-2.5 py-2 opacity-60 hover:opacity-100 transition-all duration-200"><a class="text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white" aria-current="page" href="/changelog/">Changelog</a></div></div></div></nav><div class="gap-6 font-medium md:flex md:flex-row md:items-center md:gap-5 md:text-sm"><div class="flex flex-row items-center"><a class="p-2 mr-4 text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white/90" href="https://rivet.gg/discord"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord drop-shadow-md" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></a><div class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border border-white/10 px-4 py-2 h-10 text-sm mr-2 hover:border-white/20 text-white/90 hover:text-white transition-colors"><button class="flex items-center gap-2 transition-colors text-white/90 hover:text-white" aria-expanded="false" aria-haspopup="true"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span class="hidden md:inline">GitHub</span></button></div><a class="font-v2 subpixel-antialiased inline-flex items-center justify-center whitespace-nowrap rounded-md border border-white/10 bg-white/5 px-4 py-2 text-sm text-white shadow-sm hover:border-white/20 transition-colors" href="https://hub.rivet.gg">Sign In</a></div></div></div></div></header></div></div><div class="mx-auto mt-20 w-full max-w-6xl px-8 md:mt-32" style="--header-height:5rem"><ul class="text-muted-foreground my-4 flex flex-wrap items-center gap-2 text-xs"><li><a href="/changelog/">Changelog</a></li><li class="h-2.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-right" class="svg-inline--fa fa-chevron-right block h-full w-auto" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"></path></svg></li><li class="text-foreground font-semibold">2,000x faster route propagation by rewriting our Traefik gateway in Rust</li></ul><div class="flex flex-col gap-4 pb-6 lg:flex-row"><aside class="order-1 mt-2 flex min-w-0 max-w-xs flex-1 flex-col gap-2"><div class="top-header sticky pt-2"><p class="mb-2 text-sm font-semibold">Posted by</p><div class="mb-4 flex items-center gap-2"><span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted"></span></span><div class="flex flex-col"><h3 class="font-bold">Nathan Flurry</h3><p class="text-muted-foreground text-sm">Co-founder &amp; CTO</p></div></div><div class="text-muted-foreground mb-6 flex items-center gap-2 text-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-day" class="svg-inline--fa fa-calendar-day " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 48 0c26.5 0 48 21.5 48 48l0 48L0 160l0-48C0 85.5 21.5 64 48 64l48 0 0-32c0-17.7 14.3-32 32-32zM0 192l448 0 0 272c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 192zm80 64c-8.8 0-16 7.2-16 16l0 96c0 8.8 7.2 16 16 16l96 0c8.8 0 16-7.2 16-16l0-96c0-8.8-7.2-16-16-16l-96 0z"></path></svg><time class="text-sm">June 2, 2025</time></div><p class="mb-2 hidden text-sm font-semibold lg:block">Other entries</p><ul class="text-muted-foreground hidden list-disc pl-5 text-sm lg:block"><li class="py-1"><a href="/changelog/2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas/">Introducing RivetKit: Backend Libraries That Replace SaaS</a></li><li class="py-1"><a href="/changelog/2025-06-10-rivet-functions-launch/">Rivet Functions Launch</a></li><li class="py-1"><a href="/changelog/2025-03-15-cli-installation-fixes/">Rivet CLI Installation Update</a></li></ul></div></aside><article class="order-3 mt-4 w-full max-w-prose flex-shrink-0 lg:order-2 prose-invert prose"><img blurWidth="8" blurHeight="4" alt="Promo Image" loading="lazy" width="2048" height="1024" decoding="async" data-nimg="1" class="rounded-sm border" style="color:transparent" src="/_next/static/media/image.c02c4de6.png"/><h1>2,000x faster route propagation by rewriting our Traefik gateway in Rust</h1>
<p><strong>Rivet is an open-source, self-hostable serverless platform that supports <a href="/docs/cloud/functions/">Rivet Functions</a>, <a href="/docs/actors/">Rivet Actors</a> (open-source Cloudflare Durable Objects), and <a href="/docs/cloud/containers/">Rivet Containers</a>. We&#x27;ve rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform.</strong></p>
<h2 id="what-is-rivet-guard" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#what-is-rivet-guard"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#what-is-rivet-guard">What is Rivet Guard</a></h2>
<p>Rivet Guard is our gateway service that handles all incoming traffic to the Rivet platform. Its core responsibilities include:</p>
<ul>
<li><strong><a href="/docs/cloud/functions/">Rivet Function</a> Routing</strong>: Routing the appropriate paths + hostnames to the correct Rivet Function</li>
<li><strong><a href="/docs/actors/">Rivet Actors</a> &amp; <a href="/docs/cloud/containers/">Rivet Containers</a> Routing</strong>: Route incoming requests to the correct Rivet Actor or Rivet Container</li>
<li><strong>Rivet API</strong>: Route API endpoints to the Rivet API server</li>
</ul>
<h2 id="the-problem-with-traefik" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#the-problem-with-traefik"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#the-problem-with-traefik">The Problem with Traefik</a></h2>
<p>Traefik is a widely used reverse proxy that makes it incredibly easy to set up load balancing &amp; routing in a variety of environments.</p>
<p>To ship the original version of Rivet, we chose Traefik because of its ease of use for configuring dynamic routes. We always knew this was a temporary solution until we could write a more mature gateway ourselves.</p>
<h3 id="architecture-with-traefik-http-provider" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#architecture-with-traefik-http-provider"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#architecture-with-traefik-http-provider">Architecture with Traefik HTTP Provider</a></h3>
<p>We took advantage of the <a href="https://doc.traefik.io/traefik/providers/http/">Traefik HTTP provider</a> to dynamically configure routes for the MVP of Rivet. Our setup consisted of 3 components:</p>
<ul>
<li><strong>Traefik</strong>: Acts as a gateway for proxying requests from clients to the appropriate Rivet Function, Actor, Container, or API endpoint</li>
<li><strong>HTTP provider</strong>: An HTTP API that Traefik polls every 500 ms to pull the available routes<!-- -->
<ul>
<li>Responds with a &quot;state of the world&quot; that includes all of the routes, middleware, and services.</li>
<li>Includes an in-process memory cache of available routes</li>
</ul>
</li>
<li><strong>NATS Cache Pub/Sub Topic for purging</strong>: NATS provides a topic to notify the HTTP API that the routes have updated and the in-memory cache needs to be purged</li>
</ul>
<div class="max-w-3xl mx-auto mx-auto py-6"><div class="not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden"><div class="relative flex justify-center border-b border-white/5"><img alt="Architecture of Traefik, API server, and NATS" loading="lazy" width="1380" height="798" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/traefik-arch.c1b6739c.svg"/></div><div class="relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4"><p>Old Gateway Architecture With Traefik</p></div></div></div>
<h3 id="where-traefik-started-getting-jammed" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#where-traefik-started-getting-jammed"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#where-traefik-started-getting-jammed">Where Traefik Started Getting Jammed</a></h3>
<p><strong>Part 1: Slow route propagation</strong></p>
<p>It&#x27;s incredibly important that Rivet Functions, Actors, and Containers are immediately available when provisioned. We put a lot of work into our infrastructure to make this happen, but Traefik has always been the one piece that slowed down how fast we can make resources available.</p>
<p>Under the hood, we had Traefik configured to poll at a 500 ms interval and <a href="https://doc.traefik.io/traefik/providers/overview/#providersprovidersthrottleduration"><code>providersThrottleDuration</code></a> configured to <code>0.025s</code>. If we tried to set the interval any faster, it caused internal backpressure. Despite being configured as such, Traefik does not expose routes within 500 ms in practice. Instead, we found it reliably taking between 1-2 seconds. Therefore, we <strong>had to add an artificial timeout of 2 seconds just to wait for our routes to propagate reliably</strong> within that time window.</p>
<p>All of the work we had put into making our backend &amp; infrastructure provision resources blazing fast was going to waste with a measly timeout.</p>
<p><strong>Part 2: Large HTTP provider responses</strong></p>
<p>Every single route available on Traefik required a configuration entry for:</p>
<ul>
<li>A route entry</li>
<li>A service entry</li>
<li>Custom middleware for in-flight request limits (configurable by developers)</li>
</ul>
<p>These routes come out to a minimum 1.3 KB of JSON per route — assuming the developer has not configured additional middleware.</p>
<div role="listitem" class="border dark:border-charcole-800 rounded-xl mb-3 overflow-hidden"><button class="not-prose flex w-full flex-row content-center items-center py-4 px-5 space-x-2 hover:bg-violet-100 hover:dark:bg-white/10 rounded-t-xl transition" aria-controls="Example HTTP routeChildren" aria-expanded="false"><div class="mr-0.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-right" class="svg-inline--fa fa-caret-right h-3 w-3 text-charcole-800 opacity-75 dark:text-cream-100" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><path fill="currentColor" d="M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z"></path></svg></div><div class="text-left leading-tight"><p class="m-0 font-medium text-charcole-900 dark:text-cream-200">Example HTTP route</p></div></button><div class="mt-2 mb-4 mx-6 hidden"><p>A single route looks roughly like this:</p><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">JSON</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#BFBDB6">{</span></span>
<span class="line"><span style="color:#39BAE6">  "http"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">    "services"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run:00000000-0000-0000-0000-000000000000:game_default"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "loadBalancer"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"servers"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ { </span><span style="color:#39BAE6">"url"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "http://10.0.0.1:24534"</span><span style="color:#BFBDB6"> } ]</span></span>
<span class="line"><span style="color:#BFBDB6">        }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">    "routers"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run:00000000-0000-0000-0000-000000000000:example-hash-1:https"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "entryPoints"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"lb-443"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "rule"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "Host(`11111111-1111-1111-1111-111111111111-default.lobby.22222222-2222-2222-2222-222222222222.rivet.run`)"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "service"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "job-run:00000000-0000-0000-0000-000000000000:game_default"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "middlewares"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"job-rate-limit"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> "job-in-flight"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "tls"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"domains"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ { </span><span style="color:#39BAE6">"main"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "lobby.22222222-2222-2222-2222-222222222222.rivet.run"</span><span style="color:#BFBDB6B3">,</span><span style="color:#39BAE6"> "sans"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"*.lobby.22222222-2222-2222-2222-222222222222.rivet.run"</span><span style="color:#BFBDB6"> ] } ] }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run:00000000-0000-0000-0000-000000000000:example-hash-2:https"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "entryPoints"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"lb-443"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "rule"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "(Host(`lobby.22222222-2222-2222-2222-222222222222.rivet.run`) &#x26;&#x26; PathPrefix(`/11111111-1111-1111-1111-111111111111-default`))"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "service"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "job-run:00000000-0000-0000-0000-000000000000:game_default"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "middlewares"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"job-rate-limit"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> "job-in-flight"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> "job-run-strip-prefix:00000000-0000-0000-0000-000000000000:example-hash-3"</span><span style="color:#BFBDB6"> ]</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">        "tls"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"domains"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ { </span><span style="color:#39BAE6">"main"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "lobby.22222222-2222-2222-2222-222222222222.rivet.run/11111111-1111-1111-1111-111111111111-default"</span><span style="color:#BFBDB6B3">,</span><span style="color:#39BAE6"> "sans"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [] } ] }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#39BAE6">    "middlewares"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">      "job-run-strip-prefix:00000000-0000-0000-0000-000000000000:example-hash-3"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#39BAE6">        "stripPrefix"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { </span><span style="color:#39BAE6">"prefixes"</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [ </span><span style="color:#AAD94C">"/11111111-1111-1111-1111-111111111111-default"</span><span style="color:#BFBDB6"> ] }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div></div>
<p>At <strong>around 3 MB JSON responses</strong> (just over 100 routes, or 800 routes spread across our 8 regions), Traefik&#x27;s latency started to increase noticeably.</p>
<p>Our load tests had previously shown that <strong>Traefik completely stops working once your HTTP provider JSON config hits ~14 MB</strong>, so we knew it was time to upgrade the Rivet gateway or bad things would happen.</p>
<h2 id="redesigning-from-the-ground-up" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#redesigning-from-the-ground-up"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#redesigning-from-the-ground-up">Redesigning from the Ground Up</a></h2>
<p>When designing Rivet Guard, we wanted it to support:</p>
<ul>
<li><strong>Fast route propagation</strong>: Routes should be available immediately without having to wait for them to propagate</li>
<li><strong>Infinite routes</strong>: Vital for the amount of Rivet Actors that developers are creating</li>
<li><strong>Stateless</strong>: No complex route materialization or config generation</li>
</ul>
<h2 id="architecture" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#architecture"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#architecture">Architecture</a></h2>
<p>Rivet Guard is built differently than most other proxies: it&#x27;s built as a library that we can internally plug in our own custom routing handlers. Its routes are lazily resolved &amp; cached instead of being kept in memory.</p>
<h3 id="lazy-routing" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#lazy-routing"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#lazy-routing">Lazy routing</a></h3>
<p>When a request is made to Rivet Guard, it will call a user-provided function called <code>routing_fn</code> that will return the endpoint to connect to lazily. This endpoint will be cached for future requests.</p>
<p>In contrast to the previous Traefik configuration, this provides the following benefits:</p>
<ul>
<li><strong>Simpler architecture</strong>: Simplifying from 3 components (Traefik, API, NATS) → 1 component (Rivet Guard)</li>
<li><strong>Completely stateless</strong>: Routes are fetched &amp; cached on demand</li>
<li><strong>Scales</strong>: Infinite number of routes</li>
<li><strong>Flexible</strong>: We can parse &amp; generate routes in any way that you can with code, e.g. regex, dynamic route lookups, etc.</li>
<li><strong>Easy to debug</strong>: We can use our existing monitoring stack</li>
<li><strong>Configuration-free</strong>: &quot;Configuring&quot; Rivet Guard is just writing code without the sharp edges that configuring things like Traefik routes has</li>
</ul>
<p>When configured with a <code>routing_fn</code> that can resolve routes from an external datasource, the new gateway architecture for Rivet looks like:</p>
<div class="max-w-4xl mx-auto mx-auto py-6"><div class="not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden"><div class="relative flex justify-center border-b border-white/5"><img alt="Rivet Guard and FoundationDB architecture" loading="lazy" width="1343" height="500" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/rivet-guard-arch.a0a2b7ee.svg"/></div><div class="relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4"><p>New Rivet Guard Architecture</p></div></div></div>
<h3 id="configuring-rivet-guard" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#configuring-rivet-guard"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#configuring-rivet-guard">Configuring Rivet Guard</a></h3>
<p>Configuring Rivet Guard is done by defining three functions:</p>
<ul>
<li><code>routing_fn</code>: For a given hostname and path, return the target endpoints to route to</li>
<li><code>middleware_fn</code>: For a given endpoint, return the middleware (i.e. rate limiting, max in-flight, retries, timeout)</li>
<li><code>cert_resolver_fn</code>: For a given hostname, return the TLS certificate to use</li>
</ul>
<div class="max-w-2xl mx-auto mx-auto py-6"><div class="not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden"><div class="relative flex justify-center border-b border-white/5"><img alt="Rivet Guard stack" loading="lazy" width="836" height="454" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/rivet-guard-stack.d9641c98.svg"/></div><div class="relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4"><p>Configuring Rivet Guard</p></div></div></div>
<p>Configuring Rivet Guard looks like this:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">main.rs</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#BFBDB6">#[tokio</span><span style="color:#F29668">::</span><span style="color:#BFBDB6">main]</span></span>
<span class="line"><span style="color:#FF8F40">async</span><span style="color:#FF8F40"> fn</span><span style="color:#FFB454"> main</span><span style="color:#BFBDB6">() </span><span style="color:#F29668">-></span><span style="color:#59C2FF"> Result</span><span style="color:#BFBDB6">&#x3C;()> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// Routing</span></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> routing_fn </span><span style="color:#F29668">=</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">hostname</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, path</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, port_type</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> rivet_guard_core</span><span style="color:#F29668">::</span><span style="color:#59C2FF">proxy_service</span><span style="color:#F29668">::</span><span style="color:#59C2FF">PortType</span><span style="color:#F29668">|</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...fetch routes here...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">RoutingOutput</span><span style="color:#F29668">::</span><span style="color:#FFB454">Route</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">RouteConfig</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">			targets</span><span style="color:#F29668">:</span><span style="color:#FFB454"> vec!</span><span style="color:#BFBDB6">[</span></span>
<span class="line"><span style="color:#59C2FF">				RouteTarget</span><span style="color:#BFBDB6"> { host, port, path },</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">				// ...more targets...</span></span>
<span class="line"><span style="color:#BFBDB6">			],</span></span>
<span class="line"><span style="color:#BFBDB6">			timeout</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> RoutingTimeout</span><span style="color:#BFBDB6"> { routing_timeout },</span></span>
<span class="line"><span style="color:#BFBDB6">		})))</span></span>
<span class="line"><span style="color:#BFBDB6">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// Middleware</span></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> middleware_fn </span><span style="color:#F29668">=</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">actor_id</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">uuid</span><span style="color:#F29668">::</span><span style="color:#59C2FF">Uuid</span><span style="color:#F29668">|</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...fetch middleware configuration...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">MiddlewareResponse</span><span style="color:#F29668">::</span><span style="color:#59C2FF">Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">MiddlewareConfig</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">			rate_limit</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> RateLimitConfig</span><span style="color:#BFBDB6"> { requests, period },</span></span>
<span class="line"><span style="color:#BFBDB6">			max_in_flight</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> MaxInFlightConfig</span><span style="color:#BFBDB6"> { amount },</span></span>
<span class="line"><span style="color:#BFBDB6">			retry</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> RetryConfig</span><span style="color:#BFBDB6"> { max_attempts, initial_interval },</span></span>
<span class="line"><span style="color:#BFBDB6">			timeout</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> TimeoutConfig</span><span style="color:#BFBDB6"> { request_timeout },</span></span>
<span class="line"><span style="color:#BFBDB6">		}))</span></span>
<span class="line"><span style="color:#BFBDB6">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// TLS certificates</span></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> cert </span><span style="color:#F29668">=</span><span style="color:#FFB454"> load_certified_key</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#59C2FF">CertificatePair</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">		name</span><span style="color:#F29668">:</span><span style="color:#AAD94C"> "My Cert"</span><span style="color:#BFBDB6">,</span></span>
<span class="line"><span style="color:#BFBDB6">		cert_path</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Path</span><span style="color:#F29668">::</span><span style="color:#FFB454">new</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">tls_config</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">actor_cert_path)</span><span style="color:#F29668">.</span><span style="color:#FFB454">into</span><span style="color:#BFBDB6">(),</span></span>
<span class="line"><span style="color:#BFBDB6">		key_path</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Path</span><span style="color:#F29668">::</span><span style="color:#FFB454">new</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">tls_config</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">actor_key_path)</span><span style="color:#F29668">.</span><span style="color:#FFB454">into</span><span style="color:#BFBDB6">(),</span></span>
<span class="line"><span style="color:#BFBDB6">	})</span><span style="color:#F29668">?</span><span style="color:#BFBDB6">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">	let</span><span style="color:#BFBDB6"> cert_resolver_fn </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> move</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">hostname</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#F29668">|</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ... match hostname to the appropriate cert...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(cert</span><span style="color:#F29668">.</span><span style="color:#FFB454">clone</span><span style="color:#BFBDB6">())</span></span>
<span class="line"><span style="color:#BFBDB6">	};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// Start server</span></span>
<span class="line"><span style="color:#59C2FF">	rivet_guard_core</span><span style="color:#F29668">::</span><span style="color:#FFB454">run_server</span><span style="color:#BFBDB6">(config, routing_fn, middleware_fn, cert_resolver_fn)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#F29668">?</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<div role="listitem" class="border dark:border-charcole-800 rounded-xl mb-3 overflow-hidden"><button class="not-prose flex w-full flex-row content-center items-center py-4 px-5 space-x-2 hover:bg-violet-100 hover:dark:bg-white/10 rounded-t-xl transition" aria-controls="Example of Rivet&#x27;s real routing functionChildren" aria-expanded="false"><div class="mr-0.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="caret-right" class="svg-inline--fa fa-caret-right h-3 w-3 text-charcole-800 opacity-75 dark:text-cream-100" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 512"><path fill="currentColor" d="M246.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-9.2-9.2-22.9-11.9-34.9-6.9s-19.8 16.6-19.8 29.6l0 256c0 12.9 7.8 24.6 19.8 29.6s25.7 2.2 34.9-6.9l128-128z"></path></svg></div><div class="text-left leading-tight"><p class="m-0 font-medium text-charcole-900 dark:text-cream-200">Example of Rivet&#x27;s real routing function</p></div></button><div class="mt-2 mb-4 mx-6 hidden"><p>In practice, Rivet&#x27;s actual routing function looks like this:</p><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">routing.rs</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> routing_fn </span><span style="color:#F29668">=</span><span style="color:#F29668"> |</span><span style="color:#BFBDB6">hostname</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, path</span><span style="color:#F29668">:</span><span style="color:#F29668"> &#x26;</span><span style="color:#59C2FF">str</span><span style="color:#BFBDB6">, port_type</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> rivet_guard_core</span><span style="color:#F29668">::</span><span style="color:#59C2FF">proxy_service</span><span style="color:#F29668">::</span><span style="color:#59C2FF">PortType</span><span style="color:#F29668">|</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">	match</span><span style="color:#59C2FF"> actor_routes</span><span style="color:#F29668">::</span><span style="color:#FFB454">route_via_route_config</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">ctx, host, path, dc_id)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(x)) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(x); }</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">None</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#ACB6BF8C;font-style:italic">/* Continue to next routing method */</span><span style="color:#BFBDB6"> }</span></span>
<span class="line"><span style="color:#59C2FF">		Err</span><span style="color:#BFBDB6">(err) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">error_response</span><span style="color:#BFBDB6">(err)); }</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">	match</span><span style="color:#59C2FF"> actor</span><span style="color:#F29668">::</span><span style="color:#FFB454">route_actor_request</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">ctx, host, path, dc_id)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(x)) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(x); }</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">None</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#ACB6BF8C;font-style:italic">/* Continue to next routing method */</span><span style="color:#BFBDB6"> }</span></span>
<span class="line"><span style="color:#59C2FF">		Err</span><span style="color:#BFBDB6">(err) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">error_response</span><span style="color:#BFBDB6">(err)); }</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">	match</span><span style="color:#59C2FF"> api</span><span style="color:#F29668">::</span><span style="color:#FFB454">route_api_request</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">ctx, host, path, </span><span style="color:#F29668">&#x26;</span><span style="color:#BFBDB6">dc</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">name_id, dc_id)</span><span style="color:#F29668">.</span><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">Some</span><span style="color:#BFBDB6">(x)) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(x); }</span></span>
<span class="line"><span style="color:#59C2FF">		Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">None</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#ACB6BF8C;font-style:italic">/* Continue to next routing method */</span><span style="color:#BFBDB6"> }</span></span>
<span class="line"><span style="color:#59C2FF">		Err</span><span style="color:#BFBDB6">(err) </span><span style="color:#F29668">=></span><span style="color:#BFBDB6"> { </span><span style="color:#FF8F40">return</span><span style="color:#59C2FF"> Ok</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">error_response</span><span style="color:#BFBDB6">(err)); }</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// No matching route found</span></span>
<span class="line"><span style="color:#59C2FF">	Ok</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">RoutingOutput</span><span style="color:#F29668">::</span><span style="color:#FFB454">Response</span><span style="color:#BFBDB6">(</span><span style="color:#59C2FF">StructuredResponse</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">		status</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> StatusCode</span><span style="color:#F29668">::</span><span style="color:#95E6CB">NOT_FOUND</span><span style="color:#BFBDB6">,</span></span>
<span class="line"><span style="color:#BFBDB6">		message</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Cow</span><span style="color:#F29668">::</span><span style="color:#FFB454">Owned</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">format!</span><span style="color:#BFBDB6">(</span></span>
<span class="line"><span style="color:#AAD94C">			"No route found for hostname: {host}, path: {path}"</span></span>
<span class="line"><span style="color:#BFBDB6">		)),</span></span>
<span class="line"><span style="color:#BFBDB6">		docs</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> None</span><span style="color:#BFBDB6">,</span></span>
<span class="line"><span style="color:#BFBDB6">	}))</span></span>
<span class="line"><span style="color:#BFBDB6">};</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div></div>
<h3 id="request-lifecycle" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#request-lifecycle"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#request-lifecycle">Request lifecycle</a></h3>
<p>Rivet Guard is responsible for handling everything from the TCP connection to the actual proxying. Accepting a request handles the following steps:</p>
<ol>
<li><strong>Accept TCP connection</strong>: Incoming TCP connection accepted on configured port</li>
<li><strong>TLS Handshake</strong>: TLS handshake using the cert from <code>cert_resolver_fn</code></li>
<li><strong>HTTP Request Parsing</strong>: Request parsed by <code>hyper</code></li>
<li><strong>Route Resolution</strong>: Check route cache or call <code>routing_fn</code></li>
<li><strong>Middleware Resolution</strong>: Check cache or call <code>middleware_fn</code></li>
<li><strong>Rate &amp; in-flight limiting</strong>: Apply rate limits using middleware config</li>
<li><strong>Request Proxying</strong>: Transform and forward request to the target service with retry logic from middleware config (more on this later)<!-- -->
<ul>
<li>Requires extra logic for forwarding WebSockets powered by <code>tokio-tungstenite</code></li>
</ul>
</li>
<li><strong>Response Handling</strong>: Receive and forward response from target service to the client</li>
</ol>
<p>Most of this is pretty standard across reverse proxies, <strong>except for steps 4 and 7</strong>. We&#x27;ll dive into how these work in practice.</p>
<h2 id="achieving-2-000x-faster-route-propagation" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#achieving-2-000x-faster-route-propagation"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#achieving-2-000x-faster-route-propagation">Achieving 2,000x Faster Route Propagation</a></h2>
<p>Now for the good part: how does rewriting this critical piece of software make it so much faster?</p>
<p>Instead of waiting 2 seconds for Traefik to poll our configuration, <strong>we can immediately look up where to route a request with <code>routing_fn</code></strong> — even if the route isn&#x27;t ready to serve requests yet (more on that later).</p>
<p>Under the hood, almost everything in Rivet is powered by FoundationDB. Route lookups are a single key get operation, which takes between 0.1-1 ms. That means that <strong>our worst-case routing latency is 1 millisecond</strong> — which is 2,000x faster than our previous 2 second latency.</p>
<p>After the first request to a route, all following requests are cached, meaning that the 1 millisecond overhead is a one-off scenario &amp; future requests take a negligible amount of time to resolve. More on this later.</p>
<h2 id="speeding-up-cold-starts-and-cheating-the-speed-of-light" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#speeding-up-cold-starts-and-cheating-the-speed-of-light"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#speeding-up-cold-starts-and-cheating-the-speed-of-light">Speeding Up Cold Starts &amp; Cheating the Speed of Light</a></h2>
<p>Most infrastructure like Kubernetes <strong>takes a long time to start containers because you have to wait for many steps</strong> (download image, start container, wait for server ready, wait for health check).</p>
<p>This means that whenever you need to start a resource, you usually need to wait a <em>long</em> time for it to come up before you have a URL you can access it from.</p>
<p>On the other hand, Rivet returns a URL to access a resource <em>before</em> the resource is ready. This way, <strong>the resource has time to start up while the connection URL is being sent back to the client over WAN</strong> (which is bottlenecked by the speed of light) and while the caller&#x27;s backend processes the request.</p>
<div class="max-w-3xl mx-auto mx-auto py-6"><div class="not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden"><div class="relative flex justify-center border-b border-white/5"><img alt="Diagram of cold start events with and without Rivet Guard" loading="lazy" width="1707" height="752" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/cold-starts.75cad13b.svg"/></div><div class="relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4"><p>Create Container Sequence</p></div></div></div>
<p>This means that instead of waiting for:</p>
<ol>
<li>Container Request</li>
<li>Container Starting</li>
<li>Route Propagating</li>
<li>Your Backend</li>
<li>Send URL To Client</li>
<li>Client Connects To URL</li>
</ol>
<p>Rivet Guard can do:</p>
<ol>
<li>Container Request</li>
<li>In Parallel:<!-- -->
<ul>
<li>Rivet Infrastructure<!-- -->
<ol>
<li>Container Starting</li>
</ol>
</li>
<li>Your Infrastructure<!-- -->
<ol>
<li>Your Backend</li>
<li>Send URL To Client</li>
<li>Client Connects To URL</li>
</ol>
</li>
</ul>
</li>
</ol>
<div class="relative w-full rounded-xl border p-4 my-4 flex gap-3 bg-gray-950/20 border-gray-700/50"><div class="flex-shrink-0 pt-0.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="circle-info" class="svg-inline--fa fa-circle-info w-5 h-5 text-gray-400" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"></path></svg></div><div class="flex-1 prose-invert prose max-w-full w-full text-gray-100"><p><strong>What if I don&#x27;t send URL to the client over WAN?</strong></p><p>This sequence assumes that a container URL has to be sent back to the client over WAN,  which adds a full round trip. This is a common pattern for container workloads like game servers, desktop automation, and code sandboxes. Even if you don&#x27;t need to share the URL to a container publicly, this still significantly cuts latency given that your backend needs time to process the response in parallel with the container starting.</p></div></div>
<h3 id="request-buffering" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#request-buffering"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#request-buffering">Request Buffering</a></h3>
<p>However, if the resource is not ready by the time the client makes the request, <strong>normally a reverse proxy would fail with something like a <em>Bad Gateway</em> error</strong>.</p>
<p>Instead, Rivet Guard is able to intelligently buffer requests until the resource is ready then delivers the requests.</p>
<p>This has the added benefit of <strong>gracefully handling resource crashes &amp; restarts</strong>. Say a resource becomes unresponsive or restarts: this mechanism can intelligently buffer and send requests once the service accepts the underlying TCP connection. This is incredibly important for Rivet Actors and Rivet Containers where — unlike traditional edge functions — there are frequently singletons (only one instance of a single resource) which need to be able to be gracefully restarted.</p>
<p>This pattern is <strong>well proven in systems like FoundationDB</strong> where instead of doing rolling deploys for upgrades, you simply restart the database with the new version. The clients are able to intelligently replay requests so there is no impact to the client. <a href="https://github.com/apple/foundationdb/wiki/Upgrading-FoundationDB#upgrade-process">Read more about FoundationDB&#x27;s upgrade process</a> to see prior art to this pattern.</p>
<h2 id="caching-routes" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#caching-routes"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#caching-routes">Caching Routes</a></h2>
<p>The key part of this architecture is that the routing function is called lazily and cached for speedy responses.</p>
<p>The caching is done by returning the host &amp; path prefix from the routing function. For example, if the user requests <code>example.com/foo/bar</code>, but we know that the route prefix is <code>/foo</code>, we&#x27;ll cache that route for all future requests to <code>example.com/foo/*</code> (e.g. including <code>example.com/foo/baz</code>).</p>
<p>The value that gets cached is the targets &amp; the middleware (in separate caches with different timeouts).</p>
<h3 id="cache-invalidation-of-targets" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#cache-invalidation-of-targets"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#cache-invalidation-of-targets">Cache Invalidation of Targets</a></h3>
<p>If we cache routes and the target changes (e.g. resource upgrades or migrates to a different machine), how do we know when we need to update the target list?</p>
<p>We could implement a cache invalidation system by sending a message to all Rivet Guard instances (similar to what we did for Traefik with NATS), but this requires adding another moving part to a system that we&#x27;re trying to keep as simple as possible. <em>(We&#x27;ll still implement this later to minimize p99 when restarting resources &amp; pick up new targets faster.)</em></p>
<p>Instead, we can implement a much simpler alternative: if we can&#x27;t route to a target, invalidate the cache and try again:</p>
<ol>
<li>Make request to target 1.2.3.4:5678</li>
<li>1.2.3.4:5678 returns connection refused</li>
<li>Invalidate cache &amp; call routing function again</li>
<li>Proceed as usual</li>
</ol>
<p>A keen eye may notice — what if Container B gets scheduled on 1.2.3.4:5678 before our cache can be invalidated with a connection refused to Container A? Wouldn&#x27;t that incorrectly route requests meant for Container A to Container B incorrectly? Yep — that&#x27;s why we reserve the port after it&#x27;s been released for a duration longer than our cache expiration, so this never happens.</p>
<h2 id="why-rust-and-not-go" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#why-rust-and-not-go"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#why-rust-and-not-go">Why Rust, and Not Go?</a></h2>
<p>Now for the fun part — provoking the age-old Crustaceans-Gophers Wars.</p>
<p>I want to be clear that this is not your usual &quot;Rewrite It In Rust&quot; post — I firmly believe Go would have been a great choice for this as well.</p>
<p>Either would have been well suited for the job, but these are some factors that made us comfortable choosing Rust instead of Go, despite Go&#x27;s extensive history with Traefik, Istio, and other networking infrastructure tools:</p>
<ul>
<li><strong>Extensive internal ecosystem at Rivet</strong>: Everything we have is written in Rust, so we could use all of the monitoring &amp; database tooling we&#x27;ve already battle tested</li>
<li><strong>Building around Hyper &amp; Tungstenite</strong>: Hyper is powering many production systems. As a startup, we don&#x27;t have time to futz with building &quot;correct&quot; lower-level networking implementations. We also want to support QUIC &amp; upcoming transports, which Hyper provides for free.</li>
<li><strong>Memory safety</strong>: The surface area of bugs we need to worry about with Rust is much smaller than Go — which I can&#x27;t overstate the importance of for something as critical as our gateway that touches every request that reaches Rivet</li>
<li><strong>Correctness guarantees</strong>: The surface area of bugs we need to worry about with Rust is much smaller than Go because of features like <code>Option</code> preventing null pointer panics, sum types making invalid states unrepresentable, and concrete error types forcing explicit error handling. I can&#x27;t overstate the importance of for something as critical as our gateway that touches every request that reaches Rivet.</li>
<li><strong>No GC pauses</strong>: Go advertises sub-millisecond GC pauses, but I&#x27;m not an expert enough in Go to understand the tradeoffs here. The real experience is always different than the advertised — and Rust has fewer moving parts that make it much easier to conceptualize where any potential performance issues might be coming from.</li>
</ul>
<h2 id="alternatives-considered" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#alternatives-considered"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#alternatives-considered">Alternatives Considered</a></h2>
<p>Our use case is not totally unique. Most large companies need complicated dynamic route discovery, so there are mature tools in the ecosystem for this.</p>
<h3 id="envoy" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#envoy"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#envoy">Envoy</a></h3>
<p>Envoy is used heavily in services like Consul for dynamic configuration. <a href="https://www.envoyproxy.io/">Envoy</a> works via using a &quot;discovery service&quot; (xDS) as described in their <a href="https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration">dynamic configuration documentation</a>.</p>
<p>We could&#x27;ve exposed a customized Endpoint Discovery Service (EDS) and Route Discovery Service (RDS) over gRPC or REST to support this.</p>
<p>Why we went with our own custom solution:</p>
<ul>
<li>Our logic for optimistic retries, caching, and cache invalidation is incredibly specialized to our architecture</li>
<li>We can easily add more features deeply integrated with the gateway, such as analytics, etc</li>
<li>Gateways are always on the bleeding edge of networking standards — if we want to support WebTransport or other new technologies, we don&#x27;t want to have fork Envoy</li>
<li>We have use cases that include TCP &amp; UDP that&#x27;s not included in this piece. This is not Envoy&#x27;s strong suite — we&#x27;d likely have to also incorporate <a href="https://github.com/googleforgames/quilkin">Quilkin</a> to make UDP work</li>
<li>Less moving parts: this is a single binary with fewer points of failure (no need for a gRPC or REST server)</li>
<li>We care a lot about portability &amp; being able to run all of Rivet in a single container for a full local dev environment (<a href="https://rivet.gg/docs/cloud/self-hosting/single-container">single container docs</a>)</li>
<li>Faster &amp; easier to write it from scratch than parse Envoy&#x27;s obscure documentation; past experiences with Envoy require reading the source to understand how to configure it</li>
</ul>
<h3 id="cloudflare-pingora" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#cloudflare-pingora"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#cloudflare-pingora">Cloudflare Pingora</a></h3>
<p><code>rivet-guard-core</code> has a lot of similarities to <a href="https://blog.cloudflare.com/pingora-open-source/">Cloudflare&#x27;s Pingora project</a> which supports programmable network services.</p>
<p>Pingora likely would&#x27;ve met our use case with flying colors. It came down to: the MVP for what we need is not that large. <code>rivet-guard-core</code> is only 1,777 physical lines of code (excluding tests) and <code>rivet-guard</code> (which implements routing logic) is only 861 physical lines of code.</p>
<p>Similar to our reason for not using Envoy, we have a lot of edge cases in what our gateway needs to do, so it was a safer bet in time investment (both for MVP and our future projects) to build it from scratch rather than run into a wall with an external library and have to fork + try to get merged.</p>
<p>Despite Rivet Guard&#x27;s source being relatively small, I don&#x27;t want to understate the difficulty of writing a reverse proxy. Reverse proxies are easy to implement, but even easier to implement incorrectly. Most of the time developing Rivet Guard was spent writing test cases to handle edge cases around TLS, WebSockets, retries, caching, common DoS attacks, etc.</p>
<h2 id="looking-forward" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#looking-forward"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#looking-forward">Looking Forward</a></h2>
<p>There are many features that we&#x27;re looking forward to being able to support having a solid foundation with Rivet Guard.</p>
<h3 id="rivet-platform-features" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#rivet-platform-features"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#rivet-platform-features">Rivet Platform Features</a></h3>
<p>These are features that we hope to implement in the future that influenced our design:</p>
<ul>
<li><strong>Rivet Container &amp; Rivet Actor wake on network request</strong>: We can dynamically wake containers when a network request comes to them to make workloads cheaper</li>
<li><strong>WebSocket &amp; SSE hibernation for Rivet Actors &amp; Rivet Containers</strong>: A neat feature that Cloudflare has on Durable Objects, having a fully custom gateway allows us to maintain WebSocket connections open on the gateway while letting our actors sleep and re-wake on a WebSocket message</li>
<li><strong>Request-based autoscaling for Rivet Containers &amp; Rivet Functions</strong> CPU/memory metric based autoscaling (think HPA/VPA) is notoriously slow to respond to requests and can lead to outages if traffic spikes too fast or minimums are not set correctly. You can autoscale much more efficiently and avoid dropping requests with request-based autoscaling that factors the load balancer into the equation. This allows for fewer wasted resources and no outages on spiky traffic.</li>
<li><strong>Analytics on traffic going to your application</strong></li>
<li><strong>Anycast</strong>: Roll out our own anycast network with Rivet Guard as the entrypoint</li>
</ul>
<h3 id="quic-http-3-and-web-transport" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#quic-http-3-and-web-transport"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#quic-http-3-and-web-transport">QUIC, HTTP/3, and WebTransport</a></h3>
<ul>
<li><strong>QUIC</strong> We don&#x27;t support QUIC yet — mainly because we haven&#x27;t taken the time to figure out what sorts of DoS attacks we need to handle with an entirely new transport — but it will be coming soon.</li>
<li><strong>WebTransport</strong>: <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebTransport">WebTransport</a> is coming... eventually (<a href="https://caniuse.com/webtransport">looking at you Apple</a>). It will serve as a modern replacement to WebSockets, with support for congestion control, unreliable transport, and much more. This is going to make proxies much trickier, since it includes unreliable transport &amp; relies on QUIC. This is something we&#x27;d much rather be able to handle ourselves, since this is fairly bleeding edge and we&#x27;ve found that many load balancers lag behind in proper support for new transports.</li>
</ul>
<h2 id="conclusion" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#conclusion"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#conclusion">Conclusion</a></h2>
<p>Building Rivet Guard has unlocked a massive amount of performance benefits, flexibility with future features, and removed the biggest bottleneck to scaling Rivet.</p>
<p>Key technical improvements include:</p>
<ul>
<li><strong>2,000x faster route propagation</strong>: From 2 seconds to 1 millisecond</li>
<li><strong>Infinite scaling</strong>: No more 14MB config size limitation</li>
<li><strong>Request buffering</strong>: Graceful handling of cold starts and service restarts</li>
<li><strong>Simplified architecture</strong>: From 3 components to a single stateless service</li>
<li><strong>Optimized cold starts</strong>: Resources can start while clients are connecting</li>
</ul>
<p>Sometimes you just have to build the exact tool you need.</p>
<h2 id="edits" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#edits"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#edits">Edits</a></h2>
<p><strong>Edit (June 4, 2025):</strong> Fix typo of calling Go not &quot;memory safety&quot; and replace with &quot;correctness guarantees&quot;</p><div class="after:bg-secondary relative mt-14 flex items-center justify-center after:absolute after:inset-x-0 after:-z-[1] after:h-[1px]"><a href="/rss/feed.xml" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path></svg></a><a href="https://x.com/share?text=2%2C000x%20faster%20route%20propagation%20by%20rewriting%20our%20Traefik%20gateway%20in%20Rust%20https%3A%2F%2Fwww.rivet.gg%2Fchangelog%2F2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust%2F%20via%20%40rivet_gg" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fwww.rivet.gg%2Fchangelog%2F2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust%2F&amp;t=2%2C000x%20faster%20route%20propagation%20by%20rewriting%20our%20Traefik%20gateway%20in%20Rust" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="hacker-news" class="svg-inline--fa fa-hacker-news fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 32v448h448V32H0zm21.2 197.2H21c.1-.1.2-.3.3-.4 0 .1 0 .3-.1.4zm218 53.9V384h-31.4V281.3L128 128h37.3c52.5 98.3 49.2 101.2 59.3 125.6 12.3-27 5.8-24.4 60.6-125.6H320l-80.8 155.1z"></path></svg></a><a href="https://www.reddit.com/submit?url=https://www.rivet.gg/changelog/2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust/&amp;title=2%2C000x%20faster%20route%20propagation%20by%20rewriting%20our%20Traefik%20gateway%20in%20Rust" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 256C0 114.6 114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256L37.1 512c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256zM349.6 153.6c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34c-34.5 3.7-61.4 33-61.4 68.4l0 .2c-37.5 1.6-71.8 12.3-99 29.1c-10.1-7.8-22.8-12.5-36.5-12.5c-33 0-59.8 26.8-59.8 59.8c0 24 14.1 44.6 34.4 54.1c2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54c0-33-26.8-59.8-59.8-59.8c-13.7 0-26.3 4.6-36.4 12.4c-27.4-17-62.1-27.7-100-29.1l0-.2c0-25.4 18.9-46.5 43.4-49.9l0 0c4.4 18.8 21.3 32.8 41.5 32.8zM177.1 246.9c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6s-31.4-8.8-30.4-30.5s15.4-38.3 32.1-38.3zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6c-1-21.7 11.8-39.3 28.5-39.3s31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9 .8-6.2 3.9-6.5c18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1 .3 5.1 3.6 3.9 6.5z"></path></svg></a></div></article><aside class="order-2 min-w-0 max-w-xs flex-1 lg:order-3"><div class="lg:top-header pt-10 lg:pt-6 w-full lg:pointer-events-auto lg:sticky lg:block lg:max-w-aside lg:self-start lg:overflow-y-auto lg:max-h-content"><div class="relative"><div class="relative"><ul><li class="relative"><div class="relative"><a aria-current="page" class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#what-is-rivet-guard"><span class="truncate">What is Rivet Guard</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#the-problem-with-traefik"><span class="truncate">The Problem with Traefik</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#architecture-with-traefik-http-provider"><span class="truncate">Architecture with Traefik HTTP Provider</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#where-traefik-started-getting-jammed"><span class="truncate">Where Traefik Started Getting Jammed</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#redesigning-from-the-ground-up"><span class="truncate">Redesigning from the Ground Up</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#architecture"><span class="truncate">Architecture</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#lazy-routing"><span class="truncate">Lazy routing</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#configuring-rivet-guard"><span class="truncate">Configuring Rivet Guard</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#request-lifecycle"><span class="truncate">Request lifecycle</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#achieving-2-000x-faster-route-propagation"><span class="truncate">Achieving 2,000x Faster Route Propagation</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#speeding-up-cold-starts-and-cheating-the-speed-of-light"><span class="truncate">Speeding Up Cold Starts &amp; Cheating the Speed of Light</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#request-buffering"><span class="truncate">Request Buffering</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#caching-routes"><span class="truncate">Caching Routes</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#cache-invalidation-of-targets"><span class="truncate">Cache Invalidation of Targets</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#why-rust-and-not-go"><span class="truncate">Why Rust, and Not Go?</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#alternatives-considered"><span class="truncate">Alternatives Considered</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#envoy"><span class="truncate">Envoy</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#cloudflare-pingora"><span class="truncate">Cloudflare Pingora</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#looking-forward"><span class="truncate">Looking Forward</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#rivet-platform-features"><span class="truncate">Rivet Platform Features</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#quic-http-3-and-web-transport"><span class="truncate">QUIC, HTTP/3, and WebTransport</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#conclusion"><span class="truncate">Conclusion</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#edits"><span class="truncate">Edits</span></a></div></li></ul><form class="mt-6 px-2"><div class="flex flex-col gap-2"><label class="font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-sm" for="newsletter-email">Rivet Newsletter</label><input type="email" required="" placeholder="you@company.com" autoComplete="email" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 ring-offset-background file:border-0 file:text-foreground file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-sm" name="$survey_response_2adad347-bc39-48f3-b5d1-755278685c94"/><button class="group group/button inline-flex items-center justify-center whitespace-nowrap font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border button-secondary bg-secondary text-secondary-foreground hover:bg-secondary/80 h-7 rounded-md px-2 text-xs [&amp;_svg]:size-3 gap-1.5" type="submit">Subscribe</button></div></form></div></div></div></aside></div><div class="mx-auto w-full mb-8 max-w-prose mt-4 no-prose"></div><!--$--><!--/$--><!--$--><!--/$--></div><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><div><hr class="mb-8 border-white/10"/><footer aria-labelledby="footer-heading" class="mx-auto max-w-screen-2xl px-6 lg:px-12"><h2 id="footer-heading" class="sr-only">Footer</h2><div class="mx-auto max-w-screen-2xl w-full pb-8 pt-16 sm:pt-20"><div class="xl:grid xl:grid-cols-12 xl:gap-24"><div class="space-y-8 xl:col-span-3"><img alt="Rivet" loading="lazy" width="128" height="128" decoding="async" data-nimg="1" class="size-12" style="color:transparent" src="/_next/static/media/icon-white.4596e04f.svg"/><p class="text-sm leading-6 text-gray-300">The open-source alternative to Durable Objects</p><div class="flex space-x-6"><a class="text-xl text-gray-500 hover:text-gray-400" href="https://discord.gg/aXYfyNxYVn"><span class="sr-only">Discord</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://twitter.com/rivet_gg"><span class="sr-only">Twitter</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://bsky.app/profile/rivet.gg"><span class="sr-only">Bluesky</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bluesky" class="svg-inline--fa fa-bluesky " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://github.com/rivet-gg"><span class="sr-only">GitHub</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://www.youtube.com/@rivet-gg"><span class="sr-only">YouTube</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" class="svg-inline--fa fa-youtube " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://www.linkedin.com/company/72072261/"><span class="sr-only">LinkedIn</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div></div><div class="mt-16 grid grid-cols-1 gap-x-12 gap-y-8 md:grid-cols-4 xl:col-span-9 xl:mt-0"><div><div class="text-sm font-semibold leading-6 text-white">Product</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/docs/actors/">Actors</a></li></ul></div><div><div class="text-sm font-semibold leading-6 text-white">Developers</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/docs/actors/">Documentation</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/changelog/">Changelog</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="https://rivet.betteruptime.com/">Status Page</a></li></ul></div><div><div class="text-sm font-semibold leading-6 text-white">Resources</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/blog/"><span class="">Blog</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/rivet-vs-cloudflare-workers/"><span class="">Rivet vs Cloudflare Workers</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/pricing/"><span class="">Pricing</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/talk-to-an-engineer/"><span class="">Talk to an engineer</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/sales/"><span class="">Sales</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/oss-friends/"><span class="">Open-Source Friends</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="https://releases.rivet.gg/press-kit.zip"><span class="">Press Kit</span></a></li></ul></div><div><div class="text-sm font-semibold leading-6 text-white">Legal</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/terms/">Terms</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/privacy/">Privacy Policy</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/acceptable-use/">Acceptable Use</a></li></ul></div></div></div><div class="mt-4 border-t border-white/10 pt-4 text-center md:mt-8"><p class="text-xs leading-5 text-white">© <!-- -->2025<!-- --> Rivet Gaming, Inc. All rights reserved.</p><p class="text-xs leading-5 text-white/30">Cloudflare® and Durable Objects™ are trademarks of Cloudflare, Inc. No affiliation or endorsement implied. References used for comparison purposes only.</p></div></div></footer></div><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><section aria-label="Notifications alt+T" tabindex="-1" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></section><script src="/_next/static/chunks/webpack-1a373ad8fd0a15c2.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[65327,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"3285\",\"static/chunks/3285-d8e61078321bd50f.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"7177\",\"static/chunks/app/layout-e3cfc449b871f8f6.js\"],\"GoogleAnalytics\"]\n3:I[559,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"3285\",\"static/chunks/3285-d8e61078321bd50f.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"7177\",\"static/chunks/app/layout-e3cfc449b871f8f6.js\"],\"\"]\n4:I[32761,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"TooltipProvider\"]\n5:I[79838,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"3285\",\"static/chunks/3285-d8e61078321bd50f.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1"])</script><script>self.__next_f.push([1,"983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"7177\",\"static/chunks/app/layout-e3cfc449b871f8f6.js\"],\"Providers\"]\n6:I[49287,[],\"\"]\n7:I[34235,[],\"\"]\n8:I[91971,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Toaster\"]\n9:I[82345,[\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"3591\",\"static/chunks/3591-193e430a542376f5.js\",\"4395\",\"static/chunks/4395-09a8f40ef66f9d5c.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7261\",\"static/chunks/7261-eddb3e7984c54a8d.js\",\"4\",\"static/chunks/app/(v2)/(blog)/changelog/layout-b36961b4d0c22716.js\"],\"Header\"]\na:I[59534,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"\"]\nb:\"$Sreact.suspense\"\nc:I[82813,[\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"5519\",\"static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js\"],\"EmbedDetector\"]\nd:I[53696,[\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9"])</script><script>self.__next_f.push([1,"657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"5519\",\"static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js\"],\"Footer\"]\nf:I[93621,[],\"MetadataBoundary\"]\n11:I[93621,[],\"OutletBoundary\"]\n14:I[16867,[],\"AsyncMetadataOutlet\"]\n16:I[93621,[],\"ViewportBoundary\"]\n18:I[27890,[],\"\"]\n:HL[\"/_next/static/css/565f4925fe90494c.css\",\"style\"]\n:HL[\"/_next/static/css/b2a053553e69c47d.css\",\"style\"]\n:HL[\"/_next/static/css/9ded352fd1582faa.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"xyrr8R3WCFgaolPiXJ-Nn\",\"p\":\"\",\"c\":[\"\",\"changelog\",\"2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"(v2)\",{\"children\":[\"(blog)\",{\"children\":[\"changelog\",{\"children\":[[\"slug\",\"2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/565f4925fe90494c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"dark\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"$L2\",null,{\"gaId\":\"G-GHX1328ZFD\"}],[\"$\",\"$L3\",null,{\"src\":\"https://analytics.ahrefs.com/analytics.js\",\"data-key\":\"wQAsHie9RgJMLNhmUbr/fQ\",\"strategy\":\"beforeInteractive\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/icons/apple-touch-icon.png?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/icons/favicon-32x32.png?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/icons/favicon-16x16.png?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/icons/site.webmanifest?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/icons/safari-pinned-tab.svg?20240925\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#0c0a09\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#0c0a09\"}],[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1.0\"}]]}],[\"$\",\"body\",null,{\"className\":\"dark\",\"children\":[[\"$\",\"$L4\",null,{\"children\":[\"$\",\"$L5\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}],[\"$\",\"$L8\",null,{\"theme\":\"system\",\"className\":\"toaster group right-8\",\"toastOptions\":{\"classNames\":{\"toast\":\"group toast group-[.toaster]:bg-card group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg group-[.toaster]:border group-[.toaster]:rounded-md\",\"description\":\"group-[.toast]:text-muted-foreground\",\"actionButton\":\"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\"cancelButton\":\"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\"}}}]]}]]}]]}],{\"children\":[\"(v2)\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b2a053553e69c47d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9ded352fd1582faa.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"$L9\",null,{\"variant\":\"floating\"}],[\"$\",\"div\",null,{\"className\":\"relative flex min-h-[80vh] w-full items-center justify-center text-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"transition-opacity\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-3 flex items-center justify-center text-3xl text-white\",\"children\":[[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"block-question\",\"className\":\"svg-inline--fa fa-block-question mr-2 size-10\",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zm73.8 149.3c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L248 280.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM192 368a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM48 104a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zM376 80a24 24 0 1 1 0 48 24 24 0 1 1 0-48zM48 408a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm328-24a24 24 0 1 1 0 48 24 24 0 1 1 0-48z\",\"style\":{}}]}],\" \",\"Not Found\"]}],[\"$\",\"$La\",null,{\"aria-selected\":false,\"className\":\"relative inline-flex items-center justify-center gap-0.5 overflow-hidden font-semibold transition inline-flex items-center justify-center gap-0.5 rounded-sm px-3 py-1 text-sm font-semibold bg-transparent text-cream-100 border-2 border-cream-100 hover:bg-cream-100 hover:text-charcole-950\",\"href\":\"/\",\"children\":[null,false,\"Home\",false]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$b\",null,{\"children\":[\"$\",\"$Lc\",null,{}]}],[\"$\",\"$Ld\",null,{}]]]}],{\"children\":[\"(blog)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"changelog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L9\",null,{\"active\":\"blog\",\"variant\":\"floating\"}],[\"$\",\"div\",null,{\"className\":\"mx-auto mt-20 w-full max-w-6xl px-8 md:mt-32\",\"style\":{\"--header-height\":\"5rem\"},\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]]}],{\"children\":[[\"slug\",\"2025-06-02-faster-route-propagation-by-rewriting-our-traefik-gateway-in-rust\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Le\",[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null,[\"$\",\"$L11\",null,{\"children\":[\"$L12\",\"$L13\",[\"$\",\"$L14\",null,{\"promise\":\"$@15\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"5NIlPMIQY5XerrBQ3Aj4f\",{\"children\":[[\"$\",\"$L16\",null,{\"children\":\"$L17\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$18\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"19:I[16867,[],\"AsyncMetadata\"]\n10:[\"$\",\"$b\",null,{\"fallback\":null,\"children\":[\"$\",\"$L19\",null,{\"promise\":\"$@1a\"}]}]\n"])</script><script>self.__next_f.push([1,"13:null\n"])</script><script>self.__next_f.push([1,"1b:I[1143,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Avatar\"]\n1c:I[1143,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"AvatarFallback\"]\n1d:I[1143,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"AvatarImage\"]\n1f:I[63571,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea270"])</script><script>self.__next_f.push([1,"1538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Image\"]\n20:I[75036,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Heading\"]\n21:I[28912,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Accordion\"]\n22:I[32761,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"WithTooltip\"]\n23:I[30860,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348"])</script><script>self.__next_f.push([1,".js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"CopyCodeTrigger\"]\n24:I[63843,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"ScrollArea\"]\n28:I[49720,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"3733\",\"static/chunks/3733-74f52baf8b8f8b32.js\",\"481\",\"static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js\"],\"ArticleSocials\"]\n29:I[9777,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"3733\",\"static/chunks/3733-74f52baf8b8f8b32.js\",\"481\",\"static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js\"],\"DocsTableOfContents\"]\n2a:I"])</script><script>self.__next_f.push([1,"[19897,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"3733\",\"static/chunks/3733-74f52baf8b8f8b32.js\",\"481\",\"static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js\"],\"Comments\"]\n25:T1c43,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e{\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e  \"http\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e    \"services\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e      \"job-run:00000000-0000-0000-0000-000000000000:game_default\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"loadBalancer\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"servers\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"url\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"http://10.0.0.1:24534\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e } ]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e    \"routers\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e      \"job-run:00000000-0000-0000-0000-000000000000:example-hash-1:https\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"entryPoints\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"lb-443\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"rule\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"Host(`11111111-1111-1111-1111-111111111111-default.lobby.22222222-2222-2222-2222-222222222222.rivet.run`)\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"service\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"job-run:00000000-0000-0000-0000-000000000000:game_default\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"middlewares\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"job-rate-limit\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"job-in-flight\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"tls\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"domains\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"main\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"lobby.22222222-2222-2222-2222-222222222222.rivet.run\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e \"sans\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"*.lobby.22222222-2222-2222-2222-222222222222.rivet.run\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ] } ] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e      \"job-run:00000000-0000-0000-0000-000000000000:example-hash-2:https\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"entryPoints\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"lb-443\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"rule\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"(Host(`lobby.22222222-2222-2222-2222-222222222222.rivet.run`) \u0026#x26;\u0026#x26; PathPrefix(`/11111111-1111-1111-1111-111111111111-default`))\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"service\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"job-run:00000000-0000-0000-0000-000000000000:game_default\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"middlewares\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"job-rate-limit\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"job-in-flight\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"job-run-strip-prefix:00000000-0000-0000-0000-000000000000:example-hash-3\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"tls\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"domains\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"main\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"lobby.22222222-2222-2222-2222-222222222222.rivet.run/11111111-1111-1111-1111-111111111111-default\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e \"sans\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [] } ] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e    \"middlewares\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e      \"job-run-strip-prefix:00000000-0000-0000-0000-000000000000:example-hash-3\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6\"\u003e        \"stripPrefix\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e\"prefixes\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [ \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"/11111111-1111-1111-1111-111111111111-default\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ] }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"26:T2161,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e#[tokio\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emain]\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003easync\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e fn\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e main\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e-\u003e\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Result\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;()\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t// Routing\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tlet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e routing_fn \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ehostname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003estr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e, path\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003estr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e, port_type\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e rivet_guard_core\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eproxy_service\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003ePortType\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e async\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t// ...fetch routes here...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eSome\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eRoutingOutput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eRoute\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eRouteConfig\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\ttargets\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e vec!\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e[\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\t\t\tRouteTarget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { host, port, path },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t\t\t// ...more targets...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\t],\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\ttimeout\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e RoutingTimeout\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { routing_timeout },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t})))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t// Middleware\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tlet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e middleware_fn \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eactor_id\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003euuid\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eUuid\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e async\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t// ...fetch middleware configuration...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eMiddlewareResponse\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eMiddlewareConfig\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\trate_limit\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e RateLimitConfig\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { requests, period },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\tmax_in_flight\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e MaxInFlightConfig\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { amount },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\tretry\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e RetryConfig\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { max_attempts, initial_interval },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\ttimeout\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e TimeoutConfig\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { request_timeout },\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t}))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t// TLS certificates\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tlet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e cert \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e load_certified_key\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eCertificatePair\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"My Cert\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tcert_path\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Path\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etls_config\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eactor_cert_path)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003einto\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tkey_path\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Path\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etls_config\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eactor_key_path)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003einto\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t})\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tlet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e cert_resolver_fn \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e move\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ehostname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003estr\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t// ... match hostname to the appropriate cert...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(cert\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eclone\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e())\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t// Start server\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\trivet_guard_core\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003erun_server\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(config, routing_fn, middleware_fn, cert_resolver_fn)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003eawait\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"27:T1e9e,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e routing_fn \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ehostname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003estr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e, path\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e \u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003estr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e, port_type\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e rivet_guard_core\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eproxy_service\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003ePortType\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e|\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e async\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tmatch\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e actor_routes\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eroute_via_route_config\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ectx, host, path, dc_id)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003eawait\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eSome\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(x)) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Ok\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(x); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eNone\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e/* Continue to next routing method */\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tErr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(err) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Ok\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eerror_response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(err)); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tmatch\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e actor\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eroute_actor_request\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ectx, host, path, dc_id)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003eawait\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eSome\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(x)) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Ok\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(x); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eNone\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e/* Continue to next routing method */\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tErr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(err) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Ok\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eerror_response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(err)); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tmatch\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e api\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eroute_api_request\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ectx, host, path, \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x26;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edc\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ename_id, dc_id)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003eawait\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eSome\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(x)) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Ok\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(x); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eNone\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e/* Continue to next routing method */\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\t\tErr\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(err) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ereturn\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Ok\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eerror_response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(err)); }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t// No matching route found\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#59C2FF\"\u003e\tOk\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eRoutingOutput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eResponse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eStructuredResponse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tstatus\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e StatusCode\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#95E6CB\"\u003eNOT_FOUND\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Cow\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e::\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eOwned\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eformat!\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#AAD94C\"\u003e\t\t\t\"No route found for hostname: {host}, path: {path}\"\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t)),\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tdocs\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e None\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}))\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e};\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"ul\",null,{\"className\":\"text-muted-foreground my-4 flex flex-wrap items-center gap-2 text-xs\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog\",\"children\":\"Changelog\"}]}],[\"$\",\"li\",null,{\"className\":\"h-2.5\",\"children\":[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"chevron-right\",\"className\":\"svg-inline--fa fa-chevron-right block h-full w-auto\",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 320 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z\",\"style\":{}}]}]}],[\"$\",\"li\",null,{\"className\":\"text-foreground font-semibold\",\"children\":\"2,000x faster route propagation by rewriting our Traefik gateway in Rust\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col gap-4 pb-6 lg:flex-row\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"order-1 mt-2 flex min-w-0 max-w-xs flex-1 flex-col gap-2\",\"children\":[\"$\",\"div\",null,{\"className\":\"top-header sticky pt-2\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm font-semibold\",\"children\":\"Posted by\"}],[\"$\",\"div\",null,{\"className\":\"mb-4 flex items-center gap-2\",\"children\":[[\"$\",\"$L1b\",null,{\"children\":[[\"$\",\"$L1c\",null,{\"children\":\"$undefined\"}],[\"$\",\"$L1d\",null,{\"src\":\"/_next/static/media/avatar.7191d056.jpeg\",\"height\":1516,\"width\":1516,\"blurDataURL\":\"data:image/jpeg;base64,/9j/2wBDAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/2wBDAQoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAEBf/aAAwDAQACEAMQAAAApxJX/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIDEgAEBREj/9oACAEBAAE/AIG3H5iX2rpIoRIq1UmvbHP/xAAXEQADAQAAAAAAAAAAAAAAAAAAAhNh/9oACAECAQE/AKNh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBIXH/2gAIAQMBAT8AlFrD/9k=\",\"blurWidth\":8,\"blurHeight\":8,\"alt\":\"Nathan Flurry\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-bold\",\"children\":\"Nathan Flurry\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm\",\"children\":\"Co-founder \u0026 CTO\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"text-muted-foreground mb-6 flex items-center gap-2 text-sm\",\"children\":[[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"calendar-day\",\"className\":\"svg-inline--fa fa-calendar-day \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 48 0c26.5 0 48 21.5 48 48l0 48L0 160l0-48C0 85.5 21.5 64 48 64l48 0 0-32c0-17.7 14.3-32 32-32zM0 192l448 0 0 272c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 192zm80 64c-8.8 0-16 7.2-16 16l0 96c0 8.8 7.2 16 16 16l96 0c8.8 0 16-7.2 16-16l0-96c0-8.8-7.2-16-16-16l-96 0z\",\"style\":{}}]}],[\"$\",\"time\",null,{\"className\":\"text-sm\",\"children\":\"June 2, 2025\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 hidden text-sm font-semibold lg:block\",\"children\":\"Other entries\"}],\"$L1e\"]}]}],[\"$\",\"article\",null,{\"className\":\"order-3 mt-4 w-full max-w-prose flex-shrink-0 lg:order-2 prose-invert prose\",\"children\":[[\"$\",\"$L1f\",null,{\"src\":\"/_next/static/media/image.c02c4de6.png\",\"height\":1024,\"width\":2048,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAElBMVEUTExMaGBgeHyA3HxYmJiY1NTWHGKItAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nBXJwREAMAzCMBvI/iv3qq8AFGQ3TcLdbJX8qzwD1wA3Cc9QnQAAAABJRU5ErkJggg==\",\"blurWidth\":8,\"blurHeight\":4,\"alt\":\"Promo Image\",\"className\":\"rounded-sm border\"}],[[\"$\",\"h1\",null,{\"children\":\"2,000x faster route propagation by rewriting our Traefik gateway in Rust\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"Rivet is an open-source, self-hostable serverless platform that supports \",[\"$\",\"$La\",null,{\"href\":\"/docs/cloud/functions\",\"children\":\"Rivet Functions\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"/docs/actors\",\"children\":\"Rivet Actors\"}],\" (open-source Cloudflare Durable Objects), and \",[\"$\",\"$La\",null,{\"href\":\"/docs/cloud/containers\",\"children\":\"Rivet Containers\"}],\". We've rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform.\"]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"what-is-rivet-guard\",\"children\":\"What is Rivet Guard\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Rivet Guard is our gateway service that handles all incoming traffic to the Rivet platform. Its core responsibilities include:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[[\"$\",\"$La\",null,{\"href\":\"/docs/cloud/functions\",\"children\":\"Rivet Function\"}],\" Routing\"]}],\": Routing the appropriate paths + hostnames to the correct Rivet Function\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[[\"$\",\"$La\",null,{\"href\":\"/docs/actors\",\"children\":\"Rivet Actors\"}],\" \u0026 \",[\"$\",\"$La\",null,{\"href\":\"/docs/cloud/containers\",\"children\":\"Rivet Containers\"}],\" Routing\"]}],\": Route incoming requests to the correct Rivet Actor or Rivet Container\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rivet API\"}],\": Route API endpoints to the Rivet API server\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"the-problem-with-traefik\",\"children\":\"The Problem with Traefik\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Traefik is a widely used reverse proxy that makes it incredibly easy to set up load balancing \u0026 routing in a variety of environments.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To ship the original version of Rivet, we chose Traefik because of its ease of use for configuring dynamic routes. We always knew this was a temporary solution until we could write a more mature gateway ourselves.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"architecture-with-traefik-http-provider\",\"children\":\"Architecture with Traefik HTTP Provider\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We took advantage of the \",[\"$\",\"$La\",null,{\"href\":\"https://doc.traefik.io/traefik/providers/http/\",\"children\":\"Traefik HTTP provider\"}],\" to dynamically configure routes for the MVP of Rivet. Our setup consisted of 3 components:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Traefik\"}],\": Acts as a gateway for proxying requests from clients to the appropriate Rivet Function, Actor, Container, or API endpoint\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"HTTP provider\"}],\": An HTTP API that Traefik polls every 500 ms to pull the available routes\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Responds with a \\\"state of the world\\\" that includes all of the routes, middleware, and services.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Includes an in-process memory cache of available routes\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"NATS Cache Pub/Sub Topic for purging\"}],\": NATS provides a topic to notify the HTTP API that the routes have updated and the in-memory cache needs to be purged\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"max-w-3xl mx-auto mx-auto py-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative flex justify-center border-b border-white/5\",\"children\":[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/traefik-arch.c1b6739c.svg\",\"height\":798,\"width\":1380,\"blurWidth\":0,\"blurHeight\":0},\"alt\":\"Architecture of Traefik, API server, and NATS\"}]}],[\"$\",\"div\",null,{\"className\":\"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4\",\"children\":[\"$\",\"p\",null,{\"children\":\"Old Gateway Architecture With Traefik\"}]}]]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"where-traefik-started-getting-jammed\",\"children\":\"Where Traefik Started Getting Jammed\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Part 1: Slow route propagation\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"It's incredibly important that Rivet Functions, Actors, and Containers are immediately available when provisioned. We put a lot of work into our infrastructure to make this happen, but Traefik has always been the one piece that slowed down how fast we can make resources available.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Under the hood, we had Traefik configured to poll at a 500 ms interval and \",[\"$\",\"$La\",null,{\"href\":\"https://doc.traefik.io/traefik/providers/overview/#providersprovidersthrottleduration\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"providersThrottleDuration\"}}]}],\" configured to \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"0.025s\"}}],\". If we tried to set the interval any faster, it caused internal backpressure. Despite being configured as such, Traefik does not expose routes within 500 ms in practice. Instead, we found it reliably taking between 1-2 seconds. Therefore, we \",[\"$\",\"strong\",null,{\"children\":\"had to add an artificial timeout of 2 seconds just to wait for our routes to propagate reliably\"}],\" within that time window.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"All of the work we had put into making our backend \u0026 infrastructure provision resources blazing fast was going to waste with a measly timeout.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Part 2: Large HTTP provider responses\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Every single route available on Traefik required a configuration entry for:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"A route entry\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"A service entry\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Custom middleware for in-flight request limits (configurable by developers)\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"These routes come out to a minimum 1.3 KB of JSON per route — assuming the developer has not configured additional middleware.\"}],\"\\n\",[\"$\",\"$L21\",null,{\"title\":\"Example HTTP route\",\"children\":[[\"$\",\"p\",null,{\"children\":\"A single route looks roughly like this:\"}],[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"JSON\"}]}],[\"$\",\"$L22\",null,{\"trigger\":[\"$\",\"$L23\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L24\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$25\"}}]}]}]]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"At \",[\"$\",\"strong\",null,{\"children\":\"around 3 MB JSON responses\"}],\" (just over 100 routes, or 800 routes spread across our 8 regions), Traefik's latency started to increase noticeably.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Our load tests had previously shown that \",[\"$\",\"strong\",null,{\"children\":\"Traefik completely stops working once your HTTP provider JSON config hits ~14 MB\"}],\", so we knew it was time to upgrade the Rivet gateway or bad things would happen.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"redesigning-from-the-ground-up\",\"children\":\"Redesigning from the Ground Up\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"When designing Rivet Guard, we wanted it to support:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Fast route propagation\"}],\": Routes should be available immediately without having to wait for them to propagate\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Infinite routes\"}],\": Vital for the amount of Rivet Actors that developers are creating\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Stateless\"}],\": No complex route materialization or config generation\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"architecture\",\"children\":\"Architecture\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Rivet Guard is built differently than most other proxies: it's built as a library that we can internally plug in our own custom routing handlers. Its routes are lazily resolved \u0026 cached instead of being kept in memory.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"lazy-routing\",\"children\":\"Lazy routing\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When a request is made to Rivet Guard, it will call a user-provided function called \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"routing_fn\"}}],\" that will return the endpoint to connect to lazily. This endpoint will be cached for future requests.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"In contrast to the previous Traefik configuration, this provides the following benefits:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Simpler architecture\"}],\": Simplifying from 3 components (Traefik, API, NATS) → 1 component (Rivet Guard)\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Completely stateless\"}],\": Routes are fetched \u0026 cached on demand\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Scales\"}],\": Infinite number of routes\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Flexible\"}],\": We can parse \u0026 generate routes in any way that you can with code, e.g. regex, dynamic route lookups, etc.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Easy to debug\"}],\": We can use our existing monitoring stack\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Configuration-free\"}],\": \\\"Configuring\\\" Rivet Guard is just writing code without the sharp edges that configuring things like Traefik routes has\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"When configured with a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"routing_fn\"}}],\" that can resolve routes from an external datasource, the new gateway architecture for Rivet looks like:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"max-w-4xl mx-auto mx-auto py-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative flex justify-center border-b border-white/5\",\"children\":[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/rivet-guard-arch.a0a2b7ee.svg\",\"height\":500,\"width\":1343,\"blurWidth\":0,\"blurHeight\":0},\"alt\":\"Rivet Guard and FoundationDB architecture\"}]}],[\"$\",\"div\",null,{\"className\":\"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4\",\"children\":[\"$\",\"p\",null,{\"children\":\"New Rivet Guard Architecture\"}]}]]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"configuring-rivet-guard\",\"children\":\"Configuring Rivet Guard\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Configuring Rivet Guard is done by defining three functions:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"routing_fn\"}}],\": For a given hostname and path, return the target endpoints to route to\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"middleware_fn\"}}],\": For a given endpoint, return the middleware (i.e. rate limiting, max in-flight, retries, timeout)\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"cert_resolver_fn\"}}],\": For a given hostname, return the TLS certificate to use\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"max-w-2xl mx-auto mx-auto py-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative flex justify-center border-b border-white/5\",\"children\":[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/rivet-guard-stack.d9641c98.svg\",\"height\":454,\"width\":836,\"blurWidth\":0,\"blurHeight\":0},\"alt\":\"Rivet Guard stack\"}]}],[\"$\",\"div\",null,{\"className\":\"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4\",\"children\":[\"$\",\"p\",null,{\"children\":\"Configuring Rivet Guard\"}]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Configuring Rivet Guard looks like this:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"main.rs\"}]}],[\"$\",\"$L22\",null,{\"trigger\":[\"$\",\"$L23\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L24\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$26\"}}]}]}]]}],\"\\n\",[\"$\",\"$L21\",null,{\"title\":\"Example of Rivet's real routing function\",\"children\":[[\"$\",\"p\",null,{\"children\":\"In practice, Rivet's actual routing function looks like this:\"}],[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"routing.rs\"}]}],[\"$\",\"$L22\",null,{\"trigger\":[\"$\",\"$L23\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L24\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$27\"}}]}]}]]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"request-lifecycle\",\"children\":\"Request lifecycle\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Rivet Guard is responsible for handling everything from the TCP connection to the actual proxying. Accepting a request handles the following steps:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Accept TCP connection\"}],\": Incoming TCP connection accepted on configured port\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"TLS Handshake\"}],\": TLS handshake using the cert from \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"cert_resolver_fn\"}}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"HTTP Request Parsing\"}],\": Request parsed by \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"hyper\"}}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Route Resolution\"}],\": Check route cache or call \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"routing_fn\"}}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Middleware Resolution\"}],\": Check cache or call \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"middleware_fn\"}}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rate \u0026 in-flight limiting\"}],\": Apply rate limits using middleware config\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Request Proxying\"}],\": Transform and forward request to the target service with retry logic from middleware config (more on this later)\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Requires extra logic for forwarding WebSockets powered by \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"tokio-tungstenite\"}}]]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Response Handling\"}],\": Receive and forward response from target service to the client\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Most of this is pretty standard across reverse proxies, \",[\"$\",\"strong\",null,{\"children\":\"except for steps 4 and 7\"}],\". We'll dive into how these work in practice.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"achieving-2-000x-faster-route-propagation\",\"children\":\"Achieving 2,000x Faster Route Propagation\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Now for the good part: how does rewriting this critical piece of software make it so much faster?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Instead of waiting 2 seconds for Traefik to poll our configuration, \",[\"$\",\"strong\",null,{\"children\":[\"we can immediately look up where to route a request with \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"routing_fn\"}}]]}],\" — even if the route isn't ready to serve requests yet (more on that later).\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Under the hood, almost everything in Rivet is powered by FoundationDB. Route lookups are a single key get operation, which takes between 0.1-1 ms. That means that \",[\"$\",\"strong\",null,{\"children\":\"our worst-case routing latency is 1 millisecond\"}],\" — which is 2,000x faster than our previous 2 second latency.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"After the first request to a route, all following requests are cached, meaning that the 1 millisecond overhead is a one-off scenario \u0026 future requests take a negligible amount of time to resolve. More on this later.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"speeding-up-cold-starts-and-cheating-the-speed-of-light\",\"children\":\"Speeding Up Cold Starts \u0026 Cheating the Speed of Light\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Most infrastructure like Kubernetes \",[\"$\",\"strong\",null,{\"children\":\"takes a long time to start containers because you have to wait for many steps\"}],\" (download image, start container, wait for server ready, wait for health check).\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This means that whenever you need to start a resource, you usually need to wait a \",[\"$\",\"em\",null,{\"children\":\"long\"}],\" time for it to come up before you have a URL you can access it from.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"On the other hand, Rivet returns a URL to access a resource \",[\"$\",\"em\",null,{\"children\":\"before\"}],\" the resource is ready. This way, \",[\"$\",\"strong\",null,{\"children\":\"the resource has time to start up while the connection URL is being sent back to the client over WAN\"}],\" (which is bottlenecked by the speed of light) and while the caller's backend processes the request.\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"max-w-3xl mx-auto mx-auto py-6\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose relative bg-white/5 rounded-xl overflow-hidden border border-white/10 overflow-hidden\",\"children\":[[\"$\",\"div\",null,{\"className\":\"relative flex justify-center border-b border-white/5\",\"children\":[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/cold-starts.75cad13b.svg\",\"height\":752,\"width\":1707,\"blurWidth\":0,\"blurHeight\":0},\"alt\":\"Diagram of cold start events with and without Rivet Guard\"}]}],[\"$\",\"div\",null,{\"className\":\"relative rounded-xl overflow-auto flex justify-center text-sm text-slate-400 px-4 py-4\",\"children\":[\"$\",\"p\",null,{\"children\":\"Create Container Sequence\"}]}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This means that instead of waiting for:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Container Request\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Container Starting\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Route Propagating\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Your Backend\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Send URL To Client\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Client Connects To URL\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Rivet Guard can do:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Container Request\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"In Parallel:\",\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Rivet Infrastructure\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Container Starting\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Your Infrastructure\",\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Your Backend\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Send URL To Client\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Client Connects To URL\"}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"relative w-full rounded-xl border p-4 my-4 flex gap-3 bg-gray-950/20 border-gray-700/50\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex-shrink-0 pt-0.5\",\"children\":[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"circle-info\",\"className\":\"svg-inline--fa fa-circle-info w-5 h-5 text-gray-400\",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 512 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336l24 0 0-64-24 0c-13.3 0-24-10.7-24-24s10.7-24 24-24l48 0c13.3 0 24 10.7 24 24l0 88 8 0c13.3 0 24 10.7 24 24s-10.7 24-24 24l-80 0c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z\",\"style\":{}}]}]}],[\"$\",\"div\",null,{\"className\":\"flex-1 prose-invert prose max-w-full w-full text-gray-100\",\"children\":[[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"What if I don't send URL to the client over WAN?\"}]}],[\"$\",\"p\",null,{\"children\":\"This sequence assumes that a container URL has to be sent back to the client over WAN,  which adds a full round trip. This is a common pattern for container workloads like game servers, desktop automation, and code sandboxes. Even if you don't need to share the URL to a container publicly, this still significantly cuts latency given that your backend needs time to process the response in parallel with the container starting.\"}]]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"request-buffering\",\"children\":\"Request Buffering\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"However, if the resource is not ready by the time the client makes the request, \",[\"$\",\"strong\",null,{\"children\":[\"normally a reverse proxy would fail with something like a \",[\"$\",\"em\",null,{\"children\":\"Bad Gateway\"}],\" error\"]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Instead, Rivet Guard is able to intelligently buffer requests until the resource is ready then delivers the requests.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This has the added benefit of \",[\"$\",\"strong\",null,{\"children\":\"gracefully handling resource crashes \u0026 restarts\"}],\". Say a resource becomes unresponsive or restarts: this mechanism can intelligently buffer and send requests once the service accepts the underlying TCP connection. This is incredibly important for Rivet Actors and Rivet Containers where — unlike traditional edge functions — there are frequently singletons (only one instance of a single resource) which need to be able to be gracefully restarted.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This pattern is \",[\"$\",\"strong\",null,{\"children\":\"well proven in systems like FoundationDB\"}],\" where instead of doing rolling deploys for upgrades, you simply restart the database with the new version. The clients are able to intelligently replay requests so there is no impact to the client. \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/apple/foundationdb/wiki/Upgrading-FoundationDB#upgrade-process\",\"children\":\"Read more about FoundationDB's upgrade process\"}],\" to see prior art to this pattern.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"caching-routes\",\"children\":\"Caching Routes\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The key part of this architecture is that the routing function is called lazily and cached for speedy responses.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The caching is done by returning the host \u0026 path prefix from the routing function. For example, if the user requests \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"example.com/foo/bar\"}}],\", but we know that the route prefix is \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"/foo\"}}],\", we'll cache that route for all future requests to \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"example.com/foo/*\"}}],\" (e.g. including \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"example.com/foo/baz\"}}],\").\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The value that gets cached is the targets \u0026 the middleware (in separate caches with different timeouts).\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"cache-invalidation-of-targets\",\"children\":\"Cache Invalidation of Targets\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"If we cache routes and the target changes (e.g. resource upgrades or migrates to a different machine), how do we know when we need to update the target list?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We could implement a cache invalidation system by sending a message to all Rivet Guard instances (similar to what we did for Traefik with NATS), but this requires adding another moving part to a system that we're trying to keep as simple as possible. \",[\"$\",\"em\",null,{\"children\":\"(We'll still implement this later to minimize p99 when restarting resources \u0026 pick up new targets faster.)\"}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Instead, we can implement a much simpler alternative: if we can't route to a target, invalidate the cache and try again:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Make request to target 1.2.3.4:5678\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"1.2.3.4:5678 returns connection refused\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Invalidate cache \u0026 call routing function again\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Proceed as usual\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A keen eye may notice — what if Container B gets scheduled on 1.2.3.4:5678 before our cache can be invalidated with a connection refused to Container A? Wouldn't that incorrectly route requests meant for Container A to Container B incorrectly? Yep — that's why we reserve the port after it's been released for a duration longer than our cache expiration, so this never happens.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"why-rust-and-not-go\",\"children\":\"Why Rust, and Not Go?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Now for the fun part — provoking the age-old Crustaceans-Gophers Wars.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I want to be clear that this is not your usual \\\"Rewrite It In Rust\\\" post — I firmly believe Go would have been a great choice for this as well.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Either would have been well suited for the job, but these are some factors that made us comfortable choosing Rust instead of Go, despite Go's extensive history with Traefik, Istio, and other networking infrastructure tools:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Extensive internal ecosystem at Rivet\"}],\": Everything we have is written in Rust, so we could use all of the monitoring \u0026 database tooling we've already battle tested\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Building around Hyper \u0026 Tungstenite\"}],\": Hyper is powering many production systems. As a startup, we don't have time to futz with building \\\"correct\\\" lower-level networking implementations. We also want to support QUIC \u0026 upcoming transports, which Hyper provides for free.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Memory safety\"}],\": The surface area of bugs we need to worry about with Rust is much smaller than Go — which I can't overstate the importance of for something as critical as our gateway that touches every request that reaches Rivet\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Correctness guarantees\"}],\": The surface area of bugs we need to worry about with Rust is much smaller than Go because of features like \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"Option\"}}],\" preventing null pointer panics, sum types making invalid states unrepresentable, and concrete error types forcing explicit error handling. I can't overstate the importance of for something as critical as our gateway that touches every request that reaches Rivet.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"No GC pauses\"}],\": Go advertises sub-millisecond GC pauses, but I'm not an expert enough in Go to understand the tradeoffs here. The real experience is always different than the advertised — and Rust has fewer moving parts that make it much easier to conceptualize where any potential performance issues might be coming from.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"alternatives-considered\",\"children\":\"Alternatives Considered\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Our use case is not totally unique. Most large companies need complicated dynamic route discovery, so there are mature tools in the ecosystem for this.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"envoy\",\"children\":\"Envoy\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Envoy is used heavily in services like Consul for dynamic configuration. \",[\"$\",\"$La\",null,{\"href\":\"https://www.envoyproxy.io/\",\"children\":\"Envoy\"}],\" works via using a \\\"discovery service\\\" (xDS) as described in their \",[\"$\",\"$La\",null,{\"href\":\"https://www.envoyproxy.io/docs/envoy/latest/intro/arch_overview/operations/dynamic_configuration\",\"children\":\"dynamic configuration documentation\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"We could've exposed a customized Endpoint Discovery Service (EDS) and Route Discovery Service (RDS) over gRPC or REST to support this.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Why we went with our own custom solution:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"Our logic for optimistic retries, caching, and cache invalidation is incredibly specialized to our architecture\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"We can easily add more features deeply integrated with the gateway, such as analytics, etc\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Gateways are always on the bleeding edge of networking standards — if we want to support WebTransport or other new technologies, we don't want to have fork Envoy\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"We have use cases that include TCP \u0026 UDP that's not included in this piece. This is not Envoy's strong suite — we'd likely have to also incorporate \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/googleforgames/quilkin\",\"children\":\"Quilkin\"}],\" to make UDP work\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Less moving parts: this is a single binary with fewer points of failure (no need for a gRPC or REST server)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"We care a lot about portability \u0026 being able to run all of Rivet in a single container for a full local dev environment (\",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/self-hosting/single-container\",\"children\":\"single container docs\"}],\")\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Faster \u0026 easier to write it from scratch than parse Envoy's obscure documentation; past experiences with Envoy require reading the source to understand how to configure it\"}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"cloudflare-pingora\",\"children\":\"Cloudflare Pingora\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"rivet-guard-core\"}}],\" has a lot of similarities to \",[\"$\",\"$La\",null,{\"href\":\"https://blog.cloudflare.com/pingora-open-source/\",\"children\":\"Cloudflare's Pingora project\"}],\" which supports programmable network services.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Pingora likely would've met our use case with flying colors. It came down to: the MVP for what we need is not that large. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"rivet-guard-core\"}}],\" is only 1,777 physical lines of code (excluding tests) and \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"rivet-guard\"}}],\" (which implements routing logic) is only 861 physical lines of code.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Similar to our reason for not using Envoy, we have a lot of edge cases in what our gateway needs to do, so it was a safer bet in time investment (both for MVP and our future projects) to build it from scratch rather than run into a wall with an external library and have to fork + try to get merged.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Despite Rivet Guard's source being relatively small, I don't want to understate the difficulty of writing a reverse proxy. Reverse proxies are easy to implement, but even easier to implement incorrectly. Most of the time developing Rivet Guard was spent writing test cases to handle edge cases around TLS, WebSockets, retries, caching, common DoS attacks, etc.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"looking-forward\",\"children\":\"Looking Forward\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"There are many features that we're looking forward to being able to support having a solid foundation with Rivet Guard.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"rivet-platform-features\",\"children\":\"Rivet Platform Features\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"These are features that we hope to implement in the future that influenced our design:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Rivet Container \u0026 Rivet Actor wake on network request\"}],\": We can dynamically wake containers when a network request comes to them to make workloads cheaper\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"WebSocket \u0026 SSE hibernation for Rivet Actors \u0026 Rivet Containers\"}],\": A neat feature that Cloudflare has on Durable Objects, having a fully custom gateway allows us to maintain WebSocket connections open on the gateway while letting our actors sleep and re-wake on a WebSocket message\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Request-based autoscaling for Rivet Containers \u0026 Rivet Functions\"}],\" CPU/memory metric based autoscaling (think HPA/VPA) is notoriously slow to respond to requests and can lead to outages if traffic spikes too fast or minimums are not set correctly. You can autoscale much more efficiently and avoid dropping requests with request-based autoscaling that factors the load balancer into the equation. This allows for fewer wasted resources and no outages on spiky traffic.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Analytics on traffic going to your application\"}]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Anycast\"}],\": Roll out our own anycast network with Rivet Guard as the entrypoint\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"quic-http-3-and-web-transport\",\"children\":\"QUIC, HTTP/3, and WebTransport\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"QUIC\"}],\" We don't support QUIC yet — mainly because we haven't taken the time to figure out what sorts of DoS attacks we need to handle with an entirely new transport — but it will be coming soon.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"WebTransport\"}],\": \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\",\"children\":\"WebTransport\"}],\" is coming... eventually (\",[\"$\",\"$La\",null,{\"href\":\"https://caniuse.com/webtransport\",\"children\":\"looking at you Apple\"}],\"). It will serve as a modern replacement to WebSockets, with support for congestion control, unreliable transport, and much more. This is going to make proxies much trickier, since it includes unreliable transport \u0026 relies on QUIC. This is something we'd much rather be able to handle ourselves, since this is fairly bleeding edge and we've found that many load balancers lag behind in proper support for new transports.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"conclusion\",\"children\":\"Conclusion\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Building Rivet Guard has unlocked a massive amount of performance benefits, flexibility with future features, and removed the biggest bottleneck to scaling Rivet.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Key technical improvements include:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"2,000x faster route propagation\"}],\": From 2 seconds to 1 millisecond\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Infinite scaling\"}],\": No more 14MB config size limitation\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Request buffering\"}],\": Graceful handling of cold starts and service restarts\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Simplified architecture\"}],\": From 3 components to a single stateless service\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Optimized cold starts\"}],\": Resources can start while clients are connecting\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Sometimes you just have to build the exact tool you need.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"edits\",\"children\":\"Edits\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Edit (June 4, 2025):\"}],\" Fix typo of calling Go not \\\"memory safety\\\" and replace with \\\"correctness guarantees\\\"\"]}]],[\"$\",\"$L28\",null,{\"title\":\"2,000x faster route propagation by rewriting our Traefik gateway in Rust\"}]]}],[\"$\",\"aside\",null,{\"className\":\"order-2 min-w-0 max-w-xs flex-1 lg:order-3\",\"children\":[\"$\",\"$L29\",null,{\"tableOfContents\":[{\"title\":\"What is Rivet Guard\",\"id\":\"what-is-rivet-guard\",\"children\":[]},{\"title\":\"The Problem with Traefik\",\"id\":\"the-problem-with-traefik\",\"children\":[{\"title\":\"Architecture with Traefik HTTP Provider\",\"id\":\"architecture-with-traefik-http-provider\",\"children\":[]},{\"title\":\"Where Traefik Started Getting Jammed\",\"id\":\"where-traefik-started-getting-jammed\",\"children\":[]}]},{\"title\":\"Redesigning from the Ground Up\",\"id\":\"redesigning-from-the-ground-up\",\"children\":[]},{\"title\":\"Architecture\",\"id\":\"architecture\",\"children\":[{\"title\":\"Lazy routing\",\"id\":\"lazy-routing\",\"children\":[]},{\"title\":\"Configuring Rivet Guard\",\"id\":\"configuring-rivet-guard\",\"children\":[]},{\"title\":\"Request lifecycle\",\"id\":\"request-lifecycle\",\"children\":[]}]},{\"title\":\"Achieving 2,000x Faster Route Propagation\",\"id\":\"achieving-2-000x-faster-route-propagation\",\"children\":[]},{\"title\":\"Speeding Up Cold Starts \u0026 Cheating the Speed of Light\",\"id\":\"speeding-up-cold-starts-and-cheating-the-speed-of-light\",\"children\":[{\"title\":\"Request Buffering\",\"id\":\"request-buffering\",\"children\":[]}]},{\"title\":\"Caching Routes\",\"id\":\"caching-routes\",\"children\":[{\"title\":\"Cache Invalidation of Targets\",\"id\":\"cache-invalidation-of-targets\",\"children\":[]}]},{\"title\":\"Why Rust, and Not Go?\",\"id\":\"why-rust-and-not-go\",\"children\":[]},{\"title\":\"Alternatives Considered\",\"id\":\"alternatives-considered\",\"children\":[{\"title\":\"Envoy\",\"id\":\"envoy\",\"children\":[]},{\"title\":\"Cloudflare Pingora\",\"id\":\"cloudflare-pingora\",\"children\":[]}]},{\"title\":\"Looking Forward\",\"id\":\"looking-forward\",\"children\":[{\"title\":\"Rivet Platform Features\",\"id\":\"rivet-platform-features\",\"children\":[]},{\"title\":\"QUIC, HTTP/3, and WebTransport\",\"id\":\"quic-http-3-and-web-transport\",\"children\":[]}]},{\"title\":\"Conclusion\",\"id\":\"conclusion\",\"children\":[]},{\"title\":\"Edits\",\"id\":\"edits\",\"children\":[]}]}]}]]}],[\"$\",\"$L2a\",null,{\"className\":\"mx-auto w-full mb-8 max-w-prose\"}]]\n"])</script><script>self.__next_f.push([1,"17:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n12:null\n"])</script><script>self.__next_f.push([1,"1a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"2,000x faster route propagation by rewriting our Traefik gateway in Rust\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We've rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Nathan Flurry\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"2,000x faster route propagation by rewriting our Traefik gateway in Rust\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We've rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform.\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/_next/static/media/image.c02c4de6.png\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:width\",\"content\":\"2048\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image:height\",\"content\":\"1024\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"9\",{\"property\":\"article:published_time\",\"content\":\"2025-06-02T00:00:00.000Z\"}],[\"$\",\"meta\",\"10\",{\"property\":\"article:author\",\"content\":\"Nathan Flurry\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:section\",\"content\":\"Technical\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:site\",\"content\":\"@rivetgg\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:title\",\"content\":\"2,000x faster route propagation by rewriting our Traefik gateway in Rust\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:description\",\"content\":\"Rivet is an open-source, self-hostable serverless platform that supports Rivet Functions, Rivet Actors (open-source Cloudflare Durable Objects), and Rivet Containers. We've rewritten our Traefik-based gateway in Rust — now named Rivet Guard — to support the hyper-specific needs of building a serverless platform.\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/_next/static/media/image.c02c4de6.png\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:image:width\",\"content\":\"2048\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:image:height\",\"content\":\"1024\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"15:{\"metadata\":\"$1a:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"1e:[\"$\",\"ul\",null,{\"className\":\"text-muted-foreground hidden list-disc pl-5 text-sm lg:block\",\"children\":[[\"$\",\"li\",\"2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas\",{\"className\":\"py-1\",\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog/2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas\",\"children\":\"Introducing RivetKit: Backend Libraries That Replace SaaS\"}]}],[\"$\",\"li\",\"2025-06-10-rivet-functions-launch\",{\"className\":\"py-1\",\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog/2025-06-10-rivet-functions-launch\",\"children\":\"Rivet Functions Launch\"}]}],[\"$\",\"li\",\"2025-03-15-cli-installation-fixes\",{\"className\":\"py-1\",\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog/2025-03-15-cli-installation-fixes\",\"children\":\"Rivet CLI Installation Update\"}]}]]}]\n"])</script></body></html>