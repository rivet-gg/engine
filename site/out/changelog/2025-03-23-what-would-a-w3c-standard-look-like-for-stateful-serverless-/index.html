<!DOCTYPE html><html lang="en" class="dark"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="/_next/static/css/565f4925fe90494c.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/b2a053553e69c47d.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/9ded352fd1582faa.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-1a373ad8fd0a15c2.js"/><script src="/_next/static/chunks/c7879cf7-ee7261df99d96810.js" async=""></script><script src="/_next/static/chunks/4870-70facba32d301b1a.js" async=""></script><script src="/_next/static/chunks/main-app-9dd32803f609a1e8.js" async=""></script><script src="/_next/static/chunks/f67032f2-9c72234b0d8f41b4.js" async=""></script><script src="/_next/static/chunks/9da6db1e-dbfab9261a7c6a02.js" async=""></script><script src="/_next/static/chunks/7134-7a2ccc87dc1f1c96.js" async=""></script><script src="/_next/static/chunks/9078-9c4b2ff48765f274.js" async=""></script><script src="/_next/static/chunks/6855-c97c866fb9680afe.js" async=""></script><script src="/_next/static/chunks/3285-d8e61078321bd50f.js" async=""></script><script src="/_next/static/chunks/9657-90d7d8e86cd8d7b3.js" async=""></script><script src="/_next/static/chunks/1983-7439545cf8f39348.js" async=""></script><script src="/_next/static/chunks/7678-80db3db210142fa5.js" async=""></script><script src="/_next/static/chunks/3459-aa0b1d8277b7bbbd.js" async=""></script><script src="/_next/static/chunks/app/layout-e3cfc449b871f8f6.js" async=""></script><script src="/_next/static/chunks/5051-51ff92d736937f41.js" async=""></script><script src="/_next/static/chunks/3545-9e4a648ea2701538.js" async=""></script><script src="/_next/static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js" async=""></script><script src="/_next/static/chunks/3591-193e430a542376f5.js" async=""></script><script src="/_next/static/chunks/4395-09a8f40ef66f9d5c.js" async=""></script><script src="/_next/static/chunks/7261-eddb3e7984c54a8d.js" async=""></script><script src="/_next/static/chunks/app/(v2)/(blog)/changelog/layout-b36961b4d0c22716.js" async=""></script><script src="/_next/static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js" async=""></script><script src="/_next/static/chunks/3733-74f52baf8b8f8b32.js" async=""></script><script src="/_next/static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js" async=""></script><link rel="preload" href="https://www.googletagmanager.com/gtag/js?id=G-GHX1328ZFD" as="script"/><link rel="preload" href="https://analytics.ahrefs.com/analytics.js" as="script"/><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png?20240925"/><link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png?20240925"/><link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png?20240925"/><link rel="manifest" href="/icons/site.webmanifest?20240925"/><link rel="mask-icon" href="/icons/safari-pinned-tab.svg?20240925" color="#5bbad5"/><meta name="msapplication-TileColor" content="#0c0a09"/><meta name="theme-color" content="#0c0a09"/><script>(self.__next_s=self.__next_s||[]).push(["https://analytics.ahrefs.com/analytics.js",{"data-key":"wQAsHie9RgJMLNhmUbr/fQ"}])</script><title>Considering A W3C Standard For Stateful Serverless</title><meta name="description" content="We&#x27;re Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, give us a star on GitHub."/><meta name="author" content="Nathan Flurry"/><meta property="og:title" content="Considering A W3C Standard For Stateful Serverless"/><meta property="og:description" content="We&#x27;re Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, give us a star on GitHub."/><meta property="og:image" content="http://localhost:3000/_next/static/media/image.00c62794.png"/><meta property="og:image:width" content="2048"/><meta property="og:image:height" content="1024"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2025-03-23T00:00:00.000Z"/><meta property="article:author" content="Nathan Flurry"/><meta property="article:section" content="Technical"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@rivetgg"/><meta name="twitter:title" content="Considering A W3C Standard For Stateful Serverless"/><meta name="twitter:description" content="We&#x27;re Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, give us a star on GitHub."/><meta name="twitter:image" content="http://localhost:3000/_next/static/media/image.00c62794.png"/><meta name="twitter:image:width" content="2048"/><meta name="twitter:image:height" content="1024"/><script>document.querySelectorAll('body link[rel="icon"], body link[rel="apple-touch-icon"]').forEach(el => document.head.appendChild(el))</script><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="dark"><div class="fixed top-0 z-50 w-full max-w-[1200px] md:left-1/2 md:top-4 md:-translate-x-1/2 md:px-8"><div class="hero-bg-exclude relative before:pointer-events-none before:absolute before:inset-[-1px] before:z-20 before:hidden before:rounded-2xl before:border before:content-[&quot;&quot;] before:transition-colors before:duration-300 before:ease-in-out md:before:block before:border-transparent"><div class="absolute inset-0 -z-[1] hidden overflow-hidden rounded-2xl transition-all duration-300 ease-in-out md:block bg-background backdrop-blur-none"></div><header class="bg-background/60 border-b-border sticky top-0 z-10 flex flex-col items-center border-b backdrop-blur pt-2 pb-2 md:static md:bg-transparent md:rounded-2xl md:max-w-[1200px] md:border-transparent md:backdrop-none [&amp;&gt;div:first-child]:px-3 md:backdrop-blur-none transition-all hover:opacity-100 opacity-80"><div class="w-full px-8 flex min-h-10 flex-col justify-center"><div class="flex w-full items-center gap-4"><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 [&amp;_svg]:size-[1em] border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-10 w-10 gap-1.5 shrink-0 md:hidden text-foreground" type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-«Rmjerddb»" data-state="closed"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bars" class="svg-inline--fa fa-bars size-5" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"></path></svg><span class="sr-only">Toggle navigation menu</span></button><nav class="flex-1 font-medium md:flex md:flex-row md:items-center md:gap-3 md:text-sm lg:gap-4"><span data-state="closed" data-slot="context-menu-trigger" style="-webkit-touch-callout:none"><a href="/"><img alt="Rivet logo" loading="lazy" width="80" height="24" decoding="async" data-nimg="1" class="ml-1 w-20" style="color:transparent" src="/_next/static/media/icon-text-white.f8263556.svg"/></a></span><div class="hidden md:flex"><div class="flex items-center font-v2 subpixel-antialiased"><div class="px-2.5 py-2 opacity-60 hover:opacity-100 transition-all duration-200"><a class="text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white" href="/docs/">Documentation</a></div><div class="px-2.5 py-2 opacity-60 hover:opacity-100 transition-all duration-200"><a class="text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white" href="/cloud/">Cloud</a></div><div class="px-2.5 py-2 opacity-60 hover:opacity-100 transition-all duration-200"><a class="text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white" aria-current="page" href="/changelog/">Changelog</a></div></div></div></nav><div class="gap-6 font-medium md:flex md:flex-row md:items-center md:gap-5 md:text-sm"><div class="flex flex-row items-center"><a class="p-2 mr-4 text-muted-foreground data-[active]:text-foreground aria-current-page:text-foreground hover:text-foreground transition-colors text-white/90" href="https://rivet.gg/discord"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord drop-shadow-md" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></a><div class="relative inline-flex items-center justify-center whitespace-nowrap rounded-md border border-white/10 px-4 py-2 h-10 text-sm mr-2 hover:border-white/20 text-white/90 hover:text-white transition-colors"><button class="flex items-center gap-2 transition-colors text-white/90 hover:text-white" aria-expanded="false" aria-haspopup="true"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><span class="hidden md:inline">GitHub</span></button></div><a class="font-v2 subpixel-antialiased inline-flex items-center justify-center whitespace-nowrap rounded-md border border-white/10 bg-white/5 px-4 py-2 text-sm text-white shadow-sm hover:border-white/20 transition-colors" href="https://hub.rivet.gg">Sign In</a></div></div></div></div></header></div></div><div class="mx-auto mt-20 w-full max-w-6xl px-8 md:mt-32" style="--header-height:5rem"><ul class="text-muted-foreground my-4 flex flex-wrap items-center gap-2 text-xs"><li><a href="/changelog/">Changelog</a></li><li class="h-2.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="chevron-right" class="svg-inline--fa fa-chevron-right block h-full w-auto" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"></path></svg></li><li class="text-foreground font-semibold">Considering A W3C Standard For Stateful Serverless</li></ul><div class="flex flex-col gap-4 pb-6 lg:flex-row"><aside class="order-1 mt-2 flex min-w-0 max-w-xs flex-1 flex-col gap-2"><div class="top-header sticky pt-2"><p class="mb-2 text-sm font-semibold">Posted by</p><div class="mb-4 flex items-center gap-2"><span class="relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full"><span class="flex h-full w-full items-center justify-center rounded-full bg-muted"></span></span><div class="flex flex-col"><h3 class="font-bold">Nathan Flurry</h3><p class="text-muted-foreground text-sm">Co-founder &amp; CTO</p></div></div><div class="text-muted-foreground mb-6 flex items-center gap-2 text-sm"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="calendar-day" class="svg-inline--fa fa-calendar-day " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 48 0c26.5 0 48 21.5 48 48l0 48L0 160l0-48C0 85.5 21.5 64 48 64l48 0 0-32c0-17.7 14.3-32 32-32zM0 192l448 0 0 272c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 192zm80 64c-8.8 0-16 7.2-16 16l0 96c0 8.8 7.2 16 16 16l96 0c8.8 0 16-7.2 16-16l0-96c0-8.8-7.2-16-16-16l-96 0z"></path></svg><time class="text-sm">March 23, 2025</time></div><p class="mb-2 hidden text-sm font-semibold lg:block">Other entries</p><ul class="text-muted-foreground hidden list-disc pl-5 text-sm lg:block"><li class="py-1"><a href="/changelog/2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas/">Introducing RivetKit: Backend Libraries That Replace SaaS</a></li><li class="py-1"><a href="/changelog/2025-06-10-rivet-functions-launch/">Rivet Functions Launch</a></li><li class="py-1"><a href="/changelog/2025-03-15-cli-installation-fixes/">Rivet CLI Installation Update</a></li></ul></div></aside><article class="order-3 mt-4 w-full max-w-prose flex-shrink-0 lg:order-2 prose-invert prose"><img blurWidth="8" blurHeight="4" alt="Promo Image" loading="lazy" width="2048" height="1024" decoding="async" data-nimg="1" class="rounded-sm border" style="color:transparent" src="/_next/static/media/image.00c62794.png"/><h1>Considering A W3C Standard For Stateful Serverless</h1>
<p><strong>We&#x27;re Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, <a target="_blank" href="https://github.com/rivet-gg/rivet">give us a star on GitHub</a>.</strong></p>
<p>Earlier today, I was <a target="_blank" href="https://x.com/janwilmake/status/1903580372920590667">called upon</a> by Cloudflare&#x27;s <a target="_blank" href="https://x.com/threepointone">@threepointone</a> and <a target="_blank" href="https://x.com/janwilmake">@janwilmake</a> regarding my thoughts on a standard for stateful serverless.</p>
<a target="_blank" href="https://x.com/janwilmake/status/1903580372920590667"><img alt="threepointone tweet" loading="lazy" width="2388" height="2264" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/tweet.5d715dca.png"/></a>
<p>Having implemented a cloud-agnostic stateful serverless library called <a target="_blank" href="https://github.com/rivet-gg/rivetkit">RivetKit</a>, I have a lot of experience with what&#x27;s required to build a portable standard. And thus, I derailed my Saturday to write them down here.</p>
<p>This specification is intended as step 1 to start the conversation about what is required to develop a stateful serverless specification that makes stateful serverless easier for companies to adopt. I don&#x27;t expect this to be the end result. See <em>Specification Goals</em> for more information.</p>
<h2 id="what-is-stateful-serverless" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#what-is-stateful-serverless"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#what-is-stateful-serverless">What Is Stateful Serverless?</a></h2>
<p>Unless you&#x27;re deep in to <a target="_blank" href="https://developers.cloudflare.com/durable-objects/">Cloudflare Durable Objects</a> or <a target="_blank" href="https://rivet.gg/docs/cloud/actors">Rivet Actors</a>, there&#x27;s a good chance you&#x27;ve never heard of &quot;stateful serverless.&quot;</p>
<p><strong>Stateful serverless</strong> allows serverless functions to maintain state across multiple invocations. They&#x27;re very similar to <strong>Web Workers (specifically <code>SharedWorker</code>) on the server</strong> and share characteristics with the <strong>actor model</strong>. The most popular implementation of this today is <a target="_blank" href="https://developers.cloudflare.com/durable-objects/">Durable Objects</a>.</p>
<p>The adoption of stateful serverless is fairly new: Durable Objects was announced <a target="_blank" href="https://blog.cloudflare.com/introducing-workers-durable-objects/">4.5 years ago</a> and only recently saw widespread use over the past couple years.</p>
<h3 id="stateless-serverless-functions-vs-stateful-serverless-workers" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#stateless-serverless-functions-vs-stateful-serverless-workers"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#stateless-serverless-functions-vs-stateful-serverless-workers">Stateless Serverless (Functions) vs Stateful Serverless (Workers)</a></h3>
<p><strong>Stateless serverless</strong> is what you&#x27;d normally think of when you hear <strong>&quot;serverless functions.&quot;</strong> An example implementation on Cloudflare Workers would look like this:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">  fetch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">request</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> env</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">    return</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> Response</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">'Hello World!'</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>On the other hand, <strong>stateful serverless provides an infinitely running process with storage</strong>. An example implementation on Rivet Actors would look like this:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Once created, this DurableObject will exist indefinitely</span></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> class</span><span style="color:#59C2FF"> Counter</span><span style="color:#FF8F40"> extends</span><span style="color:#39BAE6"> DurableObject</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">  count</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> number</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">  constructor</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">state</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> env</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    super</span><span style="color:#BFBDB6">(state</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> env)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    this</span><span style="color:#F29668">.</span><span style="color:#FFB454">setup</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">  async</span><span style="color:#FFB454"> setup</span><span style="color:#BFBDB6">() {</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> state</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">||</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFB454">  increment</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">count</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> number</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // Update state</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count </span><span style="color:#F29668">+=</span><span style="color:#D2A6FF"> 1</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // Persist state</span></span>
<span class="line"><span style="color:#FF8F40">    await</span><span style="color:#39BAE6;font-style:italic"> this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ctx</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6B3">,</span><span style="color:#39BAE6;font-style:italic"> this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">    return</span><span style="color:#39BAE6;font-style:italic"> this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="primary-use-cases" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#primary-use-cases"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#primary-use-cases">Primary Use Cases</a></h3>
<p>The primary use cases of stateful serverless are:</p>
<ul>
<li><strong>Long-Running Processes</strong>: Tasks that execute over extended periods or in multiple steps. For example, <strong>AI Agents</strong> with ongoing conversations and stateful tool calls.</li>
<li><strong>Stateful Services</strong>: Applications where maintaining state across interactions is critical. For example, <strong>Collaborative Apps</strong> with shared editing and automatic persistence.</li>
<li><strong>Realtime Systems</strong>: Applications requiring fast, in-memory state modifications or push updates to connected clients. For example, <strong>Multiplayer Games</strong> with game rooms and player state.</li>
<li><strong>Durability</strong>: Processes that must survive crashes and restarts without data loss. For example, <strong>Durable Execution</strong> workflows that continue after system restarts.</li>
<li><strong>Horizontal Scalability</strong>: Systems that need to scale by distributing load across many instances. For example, <strong>Realtime Stream Processing</strong> for stateful event handling.</li>
<li><strong>Local-First Architecture</strong>: Systems that synchronize state between offline clients. For example, <strong>Local-First Sync</strong> between devices.</li>
</ul>
<p>Read more about stateful serverless <a target="_blank" href="https://github.com/rivet-gg/rivetkit">here</a>.</p>
<h3 id="scope-of-this-proposal" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#scope-of-this-proposal"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#scope-of-this-proposal">Scope Of This Proposal</a></h3>
<p>For the purpose of this article, we&#x27;ll assume <strong>stateful serverless includes message passing &amp; persistent storage</strong>. This means we&#x27;re not going to consider actor runtimes, such as Erlang/OTP, Akka, Orleans, Actix, and Swift Actors which do not include storage as a core component.</p>
<h2 id="why-should-i-care" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#why-should-i-care"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#why-should-i-care">Why Should I Care?</a></h2>
<p>Even if you&#x27;ve never heard of stateful serverless, you&#x27;re probably using a site on a daily basis that already relies on stateful serverless with technologies like Cloudflare Durable Objects:</p>
<ul>
<li>CodePen</li>
<li>Liveblocks</li>
<li>Clerk</li>
<li>Wordware</li>
<li>Playroom</li>
<li>Tldraw</li>
</ul>
<p>Similarly, a significant portion of applications in general are powered by services with the actor pattern, which is a subset of what this standard would provide:</p>
<ul>
<li>WhatsApp (notoriously acquired for $19B with Erlang/OTP having only 35 engineers)</li>
<li>Discord</li>
<li>LinkedIn</li>
<li>Twitter/X</li>
<li>Pinterest</li>
<li>PayPal</li>
<li>Halo</li>
<li>FoundationDB (powering Apple, Snowflake, DataDog)</li>
<li>Many, many more</li>
</ul>
<h2 id="why-build-a-web-standard" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#why-build-a-web-standard"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#why-build-a-web-standard">Why Build A Web Standard?</a></h2>
<h3 id="customers-wary-of-vendor-lock" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#customers-wary-of-vendor-lock"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#customers-wary-of-vendor-lock">Customers Wary Of Vendor-Lock</a></h3>
<p>In 2025, customers are <strong>wary of vendor-locking themselves to cloud services</strong>. It&#x27;s common for vendor-locked providers to either shut down, turn out to be unreliable, or price gouge contracts because their customers cannot leave.</p>
<p>Therefore, a standard allows all platforms offering stateful serverless to become a compelling offering. It&#x27;s a rising tide: more competition means wider adoption and more customers.</p>
<p>For example: though AWS is the leading cloud provider and pushes their own closed-source &amp; non-standard software like DynamoDB &amp; Lambda, <strong>they still need to provide standard- and open-source-compatible software</strong> like Redis (ElastiCache), Cassandra (Keyspace), and Postgres/MySQL (Aurora) in order to remain an attractive offering for customers concerned about vendor lock.</p>
<h3 id="incentivize-more-providers" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#incentivize-more-providers"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#incentivize-more-providers">Incentivize More Providers</a></h3>
<p><strong>A standard would incentivize more cloud providers to enter the stateful serverless space.</strong> Currently, only Cloudflare, Rivet, and RivetKit offer this capability, leaving a massive opportunity for other serverless cloud providers to adopt stateful serverless. With a common standard, more frameworks &amp; developers can adopt this model.</p>
<h2 id="todays-stateful-serverless-implementations" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#todays-stateful-serverless-implementations"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#todays-stateful-serverless-implementations">Today&#x27;s Stateful Serverless Implementations</a></h2>
<h3 id="cloudflare-durable-objects-the-most-popular-option" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#cloudflare-durable-objects-the-most-popular-option"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#cloudflare-durable-objects-the-most-popular-option">Cloudflare Durable Objects: The Most Popular Option</a></h3>
<p>Today, <a href="https://developers.cloudflare.com/durable-objects/">Cloudflare Durable Objects</a> are the incumbent of stateful serverless cloud providers.</p>
<p>A Durable Object looks something like this:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> class</span><span style="color:#59C2FF"> Counter</span><span style="color:#FF8F40"> extends</span><span style="color:#39BAE6"> DurableObject</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">  constructor</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">state</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> env</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    super</span><span style="color:#BFBDB6">(state</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> env)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    this</span><span style="color:#F29668">.</span><span style="color:#FFB454">setup</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">  async</span><span style="color:#FFB454"> setup</span><span style="color:#BFBDB6">() {</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> state</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">||</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFB454">  increment</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">count</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> number</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#39BAE6;font-style:italic">    this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count </span><span style="color:#F29668">+=</span><span style="color:#D2A6FF"> 1</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">    await</span><span style="color:#39BAE6;font-style:italic"> this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ctx</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6B3">,</span><span style="color:#39BAE6;font-style:italic"> this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">    return</span><span style="color:#39BAE6;font-style:italic"> this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="cloudflare-agents-framework-moving-beyond-durable-objects" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#cloudflare-agents-framework-moving-beyond-durable-objects"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#cloudflare-agents-framework-moving-beyond-durable-objects">Cloudflare Agents Framework: Moving Beyond Durable Objects</a></h3>
<p>The <a href="https://developers.cloudflare.com/agents/">Cloudflare Agents</a> framework is for AI-powered agents to operate on the Durable Objects infrastructure.</p>
<p>As stated in their <a href="https://blog.cloudflare.com/build-ai-agents-on-cloudflare/">launch blog post</a>:</p>
<blockquote>
<p>Over the coming weeks, expect to see ... the ability to self-host agents on your own infrastructure.</p>
</blockquote>
<p>Purely theorizing: a standard for stateful serverless might provide the foundation for this.</p>
<h3 id="rivet-open-source-serverless-infrastructure" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#rivet-open-source-serverless-infrastructure"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#rivet-open-source-serverless-infrastructure">Rivet: Open-Source Serverless Infrastructure</a></h3>
<p>I&#x27;m the founder of Rivet and have a vested interest in seeing stateful serverless become a standard. Rivet provides an open-source stateful serverless platform that can be easily self-hosted.</p>
<p>We also provide a handful of features in our runtime that don&#x27;t make sense to be part of a standard, since the best W3C standards build on existing web standards: <a href="https://rivet.gg/docs/cloud/containers">Docker containers for non-JavaScript applications</a>, <a href="https://rivet.gg/docs/cloud/networking">HTTP, UDP, and TCP support</a>, <a href="https://rivet.gg/docs/cloud/durability">advanced lifecycle management</a>, <a href="https://rivet.gg/docs/cloud/api/actors/create">actor tagging</a> for advanced multi-tenant applications, <a href="https://rivet.gg/docs/cloud/api/actors/upgrade-all">advanced control over actor upgrades</a> for companies with specific use cases, <a href="https://rivet.gg/docs/cloud/api/regions/list">fine-grained control over where your actor is running</a>, and a developer-friendly REST API for managing Rivet Actors.</p>
<p>We encourage developers building on Rivet to use <a href="https://github.com/rivet-gg/rivetkit">RivetKit</a>. However, we also provide a <a href="https://rivet.gg/docs/cloud/actors">low-level API</a> for defining actors:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">import</span><span style="color:#FF8F40"> type</span><span style="color:#BFBDB6"> { ActorContext } </span><span style="color:#FF8F40">from</span><span style="color:#AAD94C"> "@rivet-gg/actor"</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">import</span><span style="color:#D2A6FF"> *</span><span style="color:#FF8F40"> as</span><span style="color:#BFBDB6"> http </span><span style="color:#FF8F40">from</span><span style="color:#AAD94C"> "http"</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">  async</span><span style="color:#FFB454"> start</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">ctx</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> ActorContext</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">    let</span><span style="color:#BFBDB6"> count </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> ctx</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">kv</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">||</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">    const</span><span style="color:#BFBDB6"> server </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> http</span><span style="color:#F29668">.</span><span style="color:#FFB454">createServer</span><span style="color:#BFBDB6">((</span><span style="color:#D2A6FF">req</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> res</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">      count </span><span style="color:#F29668">+=</span><span style="color:#D2A6FF"> 1</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">      await</span><span style="color:#BFBDB6"> ctx</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">kv</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> count)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BFBDB6">      res</span><span style="color:#F29668">.</span><span style="color:#FFB454">writeHead</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">200</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> { </span><span style="color:#AAD94C">"Content-Type"</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "text/plain"</span><span style="color:#BFBDB6"> })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      res</span><span style="color:#F29668">.</span><span style="color:#FFB454">end</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">`Count: </span><span style="color:#FF8F40">${</span><span style="color:#39BAE6;font-style:italic">this</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">count</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    server</span><span style="color:#F29668">.</span><span style="color:#FFB454">listen</span><span style="color:#BFBDB6">(process</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">env</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">PORT_HTTP)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // Keep the actor running until explicitly destroyed</span></span>
<span class="line"><span style="color:#FF8F40">    await</span><span style="color:#F29668"> new</span><span style="color:#39BAE6"> Promise</span><span style="color:#BFBDB6">((</span><span style="color:#D2A6FF">resolve</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {})</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>Unlike Durable Objects, Rivet&#x27;s core API design opts to lean into Unix-like patterns such as using <code>SIGINT</code> signals, leveraging <code>process.exit</code>, and using environment variables.</p>
<p>Check out the <a href="https://github.com/rivet-gg/rivet">source code on GitHub</a>.</p>
<h3 id="rivet-kit-framework-stateful-serverless-on-any-cloud" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#rivet-kit-framework-stateful-serverless-on-any-cloud"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#rivet-kit-framework-stateful-serverless-on-any-cloud">RivetKit Framework: Stateful Serverless On Any Cloud</a></h3>
<p>At Rivet, we also manage a framework called <a href="https://github.com/rivet-gg/rivetkit">RivetKit</a> that provides a Durable Object-like experience on any cloud that provides <em>stateless</em> serverless.</p>
<p>A Rivet Actor definition looks something like this:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">import</span><span style="color:#BFBDB6"> { actor } </span><span style="color:#FF8F40">from</span><span style="color:#AAD94C"> "@rivetkit/actor"</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> chatRoom </span><span style="color:#F29668">=</span><span style="color:#FFB454"> actor</span><span style="color:#BFBDB6">({</span></span>
<span class="line"><span style="color:#BFBDB6">  state</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> { messages</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> [] }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#BFBDB6">  actions</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // receive an action call from the client</span></span>
<span class="line"><span style="color:#FFB454">    sendMessage</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> (</span><span style="color:#D2A6FF">c</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> username</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> message</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // save message to persistent storage</span></span>
<span class="line"><span style="color:#BFBDB6">      c</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">state</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">messages</span><span style="color:#F29668">.</span><span style="color:#FFB454">push</span><span style="color:#BFBDB6">({ username</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> message })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // broadcast message to all clients</span></span>
<span class="line"><span style="color:#BFBDB6">      c</span><span style="color:#F29668">.</span><span style="color:#FFB454">broadcast</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"newMessage"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> username</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> message)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // allow client to request message history</span></span>
<span class="line"><span style="color:#FFB454">    getMessages</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> (</span><span style="color:#D2A6FF">c</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> c</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">state</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">messages</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">})</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>Under the hood is where it gets interesting: RivetKit is intended to support as many platforms as possible and is <strong>completely abstracted with drivers</strong>. By doing so, RivetKit supports Rivet, Cloudflare Durable Objects, Bun, Node.js. Vercel, Supabase, Deno, and Lambda are coming in the near future.</p>
<p>These drivers provide a <strong>peek at what a standard might require</strong>, since they&#x27;re already abstracted to be platform-agnostic:</p>
<p><strong><a href="https://github.com/rivet-gg/rivetkit/blob/a9a5cfa5b91aff73889bbbee965d52221f89c2c7/packages/actor-core/src/actor/driver.ts#L12">ActorDriver</a></strong>: Manages actor state, lifecycle, and persistence</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> ActorDriver</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	kvGet</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> key</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> KvKey</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">KvValue</span><span style="color:#F29668"> |</span><span style="color:#39BAE6"> undefined</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	kvGetBatch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> key</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> KvKey</span><span style="color:#BFBDB6">[])</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;(</span><span style="color:#59C2FF">KvValue</span><span style="color:#F29668"> |</span><span style="color:#39BAE6"> undefined</span><span style="color:#BFBDB6">)[]></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	kvPut</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> key</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> KvKey</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> value</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> KvValue</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#39BAE6">void</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	kvPutBatch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> key</span><span style="color:#F29668">:</span><span style="color:#BFBDB6"> [</span><span style="color:#59C2FF">KvKey</span><span style="color:#BFBDB6B3">,</span><span style="color:#59C2FF"> KvValue</span><span style="color:#BFBDB6">][])</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#39BAE6">void</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	kvDelete</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> key</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> KvKey</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#39BAE6">void</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	kvDeleteBatch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> key</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> KvKey</span><span style="color:#BFBDB6">[])</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#39BAE6">void</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	setAlarm</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">actor</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> AnyActorInstance</span><span style="color:#BFBDB6B3">,</span><span style="color:#D2A6FF"> timestamp</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> number</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#39BAE6">void</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p><strong><a href="https://github.com/rivet-gg/rivetkit/blob/a9a5cfa5b91aff73889bbbee965d52221f89c2c7/packages/actor-core/src/manager/driver.ts#L5">ManagerDriver</a></strong>: Handles actor discovery, routing, and scaling</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> ManagerDriver</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	getForId</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">input</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> GetForIdInput</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">GetActorOutput</span><span style="color:#F29668"> |</span><span style="color:#39BAE6"> undefined</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	getWithTags</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">input</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> GetWithTagsInput</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">GetActorOutput</span><span style="color:#F29668"> |</span><span style="color:#39BAE6"> undefined</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">	createActor</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">input</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> CreateActorInput</span><span style="color:#BFBDB6">)</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> Promise</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">CreateActorOutput</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> GetForIdInput</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#FF8F40"> extends</span><span style="color:#59C2FF"> Env</span><span style="color:#F29668"> =</span><span style="color:#39BAE6"> any</span><span style="color:#BFBDB6">> {</span></span>
<span class="line"><span style="color:#BFBDB6">	c</span><span style="color:#F29668">?:</span><span style="color:#59C2FF"> HonoContext</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	baseUrl</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	actorId</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> GetWithTagsInput</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#FF8F40"> extends</span><span style="color:#59C2FF"> Env</span><span style="color:#F29668"> =</span><span style="color:#39BAE6"> any</span><span style="color:#BFBDB6">> {</span></span>
<span class="line"><span style="color:#BFBDB6">	c</span><span style="color:#F29668">?:</span><span style="color:#59C2FF"> HonoContext</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	baseUrl</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	name</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	tags</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> ActorTags</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> GetActorOutput</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#FF8F40"> extends</span><span style="color:#59C2FF"> Env</span><span style="color:#F29668"> =</span><span style="color:#39BAE6"> any</span><span style="color:#BFBDB6">> {</span></span>
<span class="line"><span style="color:#BFBDB6">	c</span><span style="color:#F29668">?:</span><span style="color:#59C2FF"> HonoContext</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	endpoint</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	name</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	tags</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> ActorTags</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> CreateActorInput</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#FF8F40"> extends</span><span style="color:#59C2FF"> Env</span><span style="color:#F29668"> =</span><span style="color:#39BAE6"> any</span><span style="color:#BFBDB6">> {</span></span>
<span class="line"><span style="color:#BFBDB6">	c</span><span style="color:#F29668">?:</span><span style="color:#59C2FF"> HonoContext</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">E</span><span style="color:#BFBDB6">></span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	baseUrl</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	name</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	tags</span><span style="color:#F29668">:</span><span style="color:#59C2FF"> ActorTags</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	region</span><span style="color:#F29668">?:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> interface</span><span style="color:#59C2FF"> CreateActorOutput</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">	endpoint</span><span style="color:#F29668">:</span><span style="color:#39BAE6"> string</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>There is also a <strong><a href="https://github.com/rivet-gg/rivetkit/blob/a9a5cfa5b91aff73889bbbee965d52221f89c2c7/packages/actor-core/src/topologies/coordinate/driver.ts#L29">CoordinatedDriver</a></strong> that provides support for implementing actors over peer-to-peer for platforms that don&#x27;t natively support stateful serverless. This would not apply to an actor standard.</p>
<p>Read more about <a href="https://github.com/rivet-gg/rivetkit/tree/main/docs">building your own RivetKit drivers</a>.</p>
<p>Check out the <a href="https://github.com/rivet-gg/rivet">source code on GitHub</a>.</p>
<h3 id="other-actor-runtimes-the-precursor-to-stateful-serverless" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#other-actor-runtimes-the-precursor-to-stateful-serverless"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#other-actor-runtimes-the-precursor-to-stateful-serverless">Other Actor Runtimes: The Precursor To Stateful Serverless</a></h3>
<p>Runtimes like OTP (i.e. Erlang &amp; Elixir &amp; Gleam), Akka, Orleans, Actix, and Swift Actors all <strong>lack built-in support for persisted state</strong>. There are libraries that provide state for actors, but their models are significantly different than what we&#x27;ll consider here. Additionally, we&#x27;re focused on JavaScript since that&#x27;s primary language for web standards.</p>
<h2 id="specification-goals" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#specification-goals"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#specification-goals">Specification Goals</a></h2>
<p>For the purpose of this exploration, I&#x27;m going to <strong>recommend sticking with web standards</strong>, which are managed by the <a target="_blank" href="https://www.w3.org/">W3C</a> organization. Doing so allows us to <strong>build on top of existing successful web standards</strong>, such as <a target="_blank" href="https://wintertc.org/">WinterTC</a> and the <a target="_blank" href="https://fetch.spec.whatwg.org/#request-class">fetch specification</a> that are currently offered across almost all stateless serverless platforms already.</p>
<p>The goals of this proposal are:</p>
<ul>
<li><strong>Simplicity Of Implementation</strong>: Implementing standards correctly is difficult, expensive, and highly error prone. Simpler is better.</li>
<li><strong>Simplicity Of Usage</strong>: Stateful serverless is not a concept that is easy for many developers to understand. Prefer simplicity vs advanced features to keep the API as simple as possible for greater adoption.</li>
<li><strong>Build For Frameworks</strong>: <a target="_blank" href="https://hono.dev/">Hono</a> and <a target="_blank" href="https://itty.dev/itty-router/">itty-router</a> already proved that frameworks are almost always used with serverless runtimes. Stateful serverless is already used widely with <a target="_blank" href="https://www.partykit.io/">PartyKit</a>, <a target="_blank" href="https://github.com/rivet-gg/rivetkit">RivetKit</a>, <a target="_blank" href="https://developers.cloudflare.com/agents/">Agents</a>, and misc tools like <a target="_blank" href="https://tinybase.org/">TinyBase</a>. If possible, leave functionality up to frameworks to implement.</li>
<li><strong>Built On Existing Web Development Paradigms</strong>: Stateful serverless is very similar to <a target="_blank" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">Web Workers</a>. Where possible refer to Web Workers to see what works well.</li>
<li><strong>Focus On Stateful Workloads, Not Actors</strong>: I love building distributed systems with the actor model, but actors require extra consideration around message handling, concurrency, and backpressure.</li>
</ul>
<h3 id="classes-vs-functions" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#classes-vs-functions"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#classes-vs-functions">Classes vs Functions</a></h3>
<p>Durable Objects provides a class-based approach to stateful serverless (e.g. <code>class X extends DurableObject { ... }</code>). Rivet provides a functional approach (e.g. <code>export default { start () { ... } }</code>).</p>
<p>Sticking to the WinterTC ESM-style makes sense. Additionally, it&#x27;s similar to how Web Workers are already defined.</p>
<h3 id="alternative-1-fetch-based-communication" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#alternative-1-fetch-based-communication"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#alternative-1-fetch-based-communication">Alternative #1: Fetch-Based Communication</a></h3>
<p>Both Rivet &amp; Durable Objects use WinterTC-like <code>fetch</code> handlers to accept requests on Durable Objects/Rivet Actors. An alternative spec would opt to use <code>fetch</code> handlers instead of a brand new definition. This is similar to what WinterTC is attempting to do: take existing patterns and standardize them as opposed to implementing a new standard.</p>
<p>This standard makes an intentional decision to define a simpler, more portable API than provide compatibility with only 2 existing implementations.</p>
<h3 id="alternative-2-a-cgi-like-standard" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#alternative-2-a-cgi-like-standard"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#alternative-2-a-cgi-like-standard">Alternative #2: A CGI-Like Standard</a></h3>
<p>An alternative implementation is to consider something along the lines of <a href="https://en.wikipedia.org/wiki/Common_Gateway_Interface">CGI</a> which provides a more Unix-like implementation of serverless functions &amp; supports multiple languages. However, the industry has consolidated behind JavaScript &amp; WebAssembly for serverless clouds because of the developer &amp; cost efficiency. Additionally, CGI lacks many of the modern features that W3C specifications take into account for web standards. (Originally proposed by <a href="https://x.com/mitsuhiko">Armin Ronacher</a>.)</p>
<h2 id="drawing-inspiration-from-shared-worker" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#drawing-inspiration-from-shared-worker"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#drawing-inspiration-from-shared-worker">Drawing Inspiration From <code>SharedWorker</code></a></h2>
<img alt="Overview of SharedWorker arch" loading="lazy" width="1258" height="934" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/sharedworker.1a0b47fb.png"/>
<p>Though designed for client-side concurrency, <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker"><code>SharedWorker</code></a> offers a programming model that closely resembles what we&#x27;re discussing for server-side actors. The <code>SharedWorker</code> API already has many of the core concepts needed for a stateful serverless standard:</p>
<ol>
<li><strong>Multi-Tenant</strong>: <code>SharedWorker</code> can serve multiple browser tabs, similar to how Durable Objects and Rivet Actors serves multiple clients</li>
<li><strong>Isolated Execution Context</strong>: Each worker runs in its own isolated environment</li>
<li><strong>Message-Based Communication</strong>: Workers communicate via structured message passing.</li>
</ol>
<p>You can think of a <code>ServerlessWorker</code> like a <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker"><code>SharedWorker</code></a> that is:</p>
<ul>
<li>In the cloud</li>
<li>Includes persistent storage</li>
<li>Runs forever</li>
</ul>
<p>Here&#x27;s a comparison of how Web Workers operate in the browser:</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R1ad8uterddb»-content-SharedWorker" data-state="active" id="radix-«R1ad8uterddb»-trigger-SharedWorker" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">SharedWorker</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R1ad8uterddb»-content-DurableObject" data-state="inactive" id="radix-«R1ad8uterddb»-trigger-DurableObject" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">DurableObject</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R1ad8uterddb»-content-RivetKit" data-state="inactive" id="radix-«R1ad8uterddb»-trigger-RivetKit" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">RivetKit</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R1ad8uterddb»-trigger-SharedWorker" id="radix-«R1ad8uterddb»-content-SharedWorker" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// main.js - Browser</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> worker </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> Worker</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">'worker.js'</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">worker</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({ type</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> 'INCREMENT'</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> value</span><span style="color:#BFBDB6B3">:</span><span style="color:#D2A6FF"> 5</span><span style="color:#BFBDB6"> })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">worker</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#D2A6FF"> event</span><span style="color:#FF8F40"> =></span><span style="color:#BFBDB6"> console</span><span style="color:#F29668">.</span><span style="color:#FFB454">log</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">'Counter:'</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">// worker.js - Worker</span></span>
<span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> counter </span><span style="color:#F29668">=</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">self</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#D2A6FF"> event</span><span style="color:#FF8F40"> =></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">  const</span><span style="color:#BFBDB6"> { type</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> value } </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">  if</span><span style="color:#BFBDB6"> (type </span><span style="color:#F29668">===</span><span style="color:#AAD94C"> 'INCREMENT'</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#BFBDB6">    counter </span><span style="color:#F29668">+=</span><span style="color:#BFBDB6"> value</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    self</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">(counter)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R1ad8uterddb»-trigger-DurableObject" hidden="" id="radix-«R1ad8uterddb»-content-DurableObject" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R1ad8uterddb»-trigger-RivetKit" hidden="" id="radix-«R1ad8uterddb»-content-RivetKit" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div></div></div>
<p>The <code>onmessage</code> handler is very similar to the <code>fetch</code> handler in a Durable Object or an <a href="/docs/actors/actions/">Action</a> in RivetKit.</p>
<p>The key differences are:</p>
<ol>
<li><strong>Persistence</strong>: Web Workers lose state when the page refreshes, while <code>ServerlessWorker</code>s maintain state between invocations.</li>
<li><strong>Network Access</strong>: Stateful serverless inherently supports network requests via fetch/WebSockets.</li>
<li><strong>Lifecycle Management</strong>: <code>ServerlessWorker</code>s have advanced wake/sleep and scheduling capabilities.</li>
</ol>
<h2 id="introducing-serverless-worker" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#introducing-serverless-worker"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#introducing-serverless-worker">Introducing <code>ServerlessWorker</code></a></h2>
<img alt="Overview of ServerlessWorker arch" loading="lazy" width="1916" height="1060" decoding="async" data-nimg="1" style="color:transparent" src="/_next/static/media/serverlessworker.224d7149.png"/>
<p><code>ServerlessWorker</code> is an API similar to the existing Web Workers API that provides the core functionality of both Cloudflare Durable Objects and Rivet Actors:</p>
<ol>
<li><strong>Multi-Tenant</strong>: <code>ServerlessWorker</code> can serve multiple clients at the same time in realtime.</li>
<li><strong>Message-Based Communication</strong>: Communicates via <code>postMessage</code>.</li>
<li><strong>Persistent</strong>: <code>ServerlessWorkers</code> run forever. They cannot crash. Implementations of the standard can optionally make workers sleep when there is no activity.</li>
<li><strong>Storage</strong>: <code>ServerlessWorkers</code> can store data that persists for ever. Implementations of the standard should design this data to be stored next to compute for optimal read-write performance.</li>
<li><strong>Isolated Execution Context</strong>: Each worker runs in its own isolated environment</li>
</ol>
<h3 id="creating-initializing-and-addressing-serverless-workers" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#creating-initializing-and-addressing-serverless-workers"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#creating-initializing-and-addressing-serverless-workers">Creating, Initializing, &amp; Addressing <code>ServerlessWorker</code>s</a></h3>
<p><strong>Current Implementation: Rivet &amp; RivetKit</strong></p>
<p>Rivet and RivetKit provide a tagging system for organizing actors. This allows you to build more manageable multi-tenant applications with complex requirements. For example:</p>
<p>Rivet allows you to create actors with the <a href="https://rivet.gg/docs/cloud/api/actors/create"><code>actors.create</code></a> endpoint. The API accepts environment variables to configure how the actor behaves.</p>
<p>RivetKit allows passing tags to <a href="https://github.com/rivet-gg/rivetkit"><code>client.get({ /* tags */ })</code></a> to get or create an actor, but does not provide environment variables. You can also use the <code>client.create</code> method to create a fresh actor. Actors can read their own tags to configure behavior accordingly:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> client </span><span style="color:#F29668">=</span><span style="color:#FFB454"> createClient</span><span style="color:#BFBDB6">&#x3C;</span><span style="color:#59C2FF">App</span><span style="color:#BFBDB6">>(</span><span style="color:#AAD94C">"http://localhost:6420"</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> randomChannel </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> client</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">chatRoom</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">({ organization</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "rivet"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> channel</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "random"</span><span style="color:#BFBDB6"> })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p><strong>Current Implementation: Durable Objects</strong></p>
<p>To create a Durable Object on Cloudflare, you call the <a href="https://developers.cloudflare.com/durable-objects/api/namespace/#newuniqueid"><code>newUniqueId</code></a> method. This will give you a unique ID for a new Durable Object.</p>
<p>Cloudflare also provides a <a href="https://developers.cloudflare.com/durable-objects/api/namespace/#idfromname"><code>idFromName</code></a> method to get the ID of an Durable Object from an arbitrary string. This ID is then used to resolve a Durable Object stub that you can send requests to. For example:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">TypeScript</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> id </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> env</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">MY_DURABLE_OBJECT</span><span style="color:#F29668">.</span><span style="color:#FFB454">idFromName</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"channel:rivet:random"</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> stub </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> env</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">MY_DURABLE_OBJECT</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(id)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">await</span><span style="color:#BFBDB6"> stub</span><span style="color:#F29668">.</span><span style="color:#FFB454">fetch</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">...</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>Cloudflare Durable Objects is desigend to have no concept of &quot;created&quot; or &quot;destroyed.&quot; The initial state can be configured by sending an RPC to the DO upon creation. This implementation of not having an input state for a <code>ServerlessWorker</code> is simpler and leaves the functionality up to the framework; instead all a <code>ServerlessWorker</code> has a unique ID that developers can send messages to.</p>
<p><strong>Current Implementation: <code>SharedWorker</code></strong></p>
<p><code>SharedWorker</code> accepts a <code>name</code> parameter, for example: <code>new SharedWorker(&quot;./sharedWorker.js&quot;, </code>chat-room-random<code>)</code>. This is akin to calling <code>idFromName</code> for Durable Objects. Passing no name will give you the same worker.</p>
<p>The <code>name</code> is accessible in the global scope of the <code>SharedWorker</code>.</p>
<p><strong>Proposal</strong></p>
<p>Constructing a <code>ServerlessWorker</code> object will mimic the <code>SharedWorker</code> API. Passing a <code>name</code> parameter to the second constructor argument will let you address a given <code>ServerlessWorker</code>. Passing no arguments will give you the same worker.</p>
<p>The <code>name</code> is accessible in the global scope of the <code>ServerlessWorker</code>.</p>
<p>An example API could look like:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">server.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	fetch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">req</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">		const</span><span style="color:#BFBDB6"> worker </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> ServerlessWorker</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"./worker.js"</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>To resolve with a custom name:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">server.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	fetch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">req</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...</span></span>
<span class="line"><span style="color:#FF8F40">		const</span><span style="color:#BFBDB6"> worker </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> ServerlessWorker</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"./worker.js"</span><span style="color:#BFBDB6B3">,</span><span style="color:#AAD94C"> `chat-room-</span><span style="color:#FF8F40">${</span><span style="color:#BFBDB6">random</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">		// ...</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<p>To access the name in the worker:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">worker.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Worker code can access its name</span></span>
<span class="line"><span style="color:#BFBDB6">console</span><span style="color:#F29668">.</span><span style="color:#FFB454">log</span><span style="color:#BFBDB6">(self</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">name)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="terminating-serverless-workers" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#terminating-serverless-workers"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#terminating-serverless-workers">Terminating <code>ServerlessWorker</code>s</a></h3>
<p><strong>Current Implementation: Rivet</strong></p>
<p>Rivet provides two ways to destroy an actor: use <code>process.exit(0)</code> or call <a href="https://rivet.gg/docs/cloud/api/actors/destroy"><code>actors.destroy</code></a> from the API.</p>
<p>RivetKit will provide a <code>ctx.shutdown</code> method that delegates to <code>ActorDriver</code>, though is not currently implemented.</p>
<p><strong>Current Implementation: Durable Objects</strong></p>
<p>Cloudflare&#x27;s approach to destroying Durable Objects is somewhat unique. There is no concept of &quot;created&quot; or &quot;destroyed&quot; actor. To reset an actor, you clear the storage with <a href="https://developers.cloudflare.com/durable-objects/api/storage-api/#deleteall"><code>deleteAll()</code></a>. While unintuitive, this leaves it up to the framework to implement.</p>
<p><strong>Current Implementation: <code>SharedWorker</code></strong></p>
<p>Web Workers&#x27; <code>SharedWorker</code> is automatically destroyed when all ports are closed. This is not relevant to stateful serverless.</p>
<p><strong>Proposal</strong></p>
<p>Add a <code>terminate</code> method on the <code>ServerlessWorker</code> itself, leave it up to the frameworks to implement destroying. For example:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">worker.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#BFBDB6">		self</span><span style="color:#F29668">.</span><span style="color:#FFB454">terminate</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="connections-and-messages" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#connections-and-messages"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#connections-and-messages">Connections &amp; Messages</a></h3>
<p><strong>Current Implementation: Rivet</strong></p>
<p>Both Rivet Actors &amp; Durable Objects provide a way to serve requests to actors based on web standards.</p>
<p>Rivet provides flexible networking infrastructure, including <a href="https://rivet.gg/docs/cloud/networking">UDP, TCP, and host networking</a>. To remain widely compatible, Rivet relies on the Deno implementation of the fetch handler with <a href="https://docs.deno.com/api/deno/~/Deno.serve"><code>Deno.serve</code></a>.</p>
<p><strong>Current Implementation: Cloudflare</strong></p>
<p>Durable Objects supports a similar <a href="https://developers.cloudflare.com/durable-objects/best-practices/create-durable-object-stubs-and-send-requests/#invoking-the-fetch-handler">fetch handler</a>, but also provides non-standard features like <a href="https://developers.cloudflare.com/durable-objects/best-practices/create-durable-object-stubs-and-send-requests/">RPC</a>.</p>
<p>Both rely on different implementations for WebSockets, though this handled gracefully by libraries like <a href="https://hono.dev/docs/helpers/websocket">Hono&#x27;s WebSocket helper</a>.</p>
<p>There is a WinterTC proposal for a <a href="https://github.com/wintercg/proposal-sockets-api">Sockets API</a>, though I&#x27;m going to consider this out of the scope of this article since <a href="https://developers.cloudflare.com/workers/runtime-apis/tcp-sockets/">Cloudflare&#x27;s implementation</a> is not currently supported on Durable Objects.</p>
<p><strong>Current Implementation: <code>SharedWorker</code></strong></p>
<p>However, Web Worker (<code>SharedWorker</code>) opts for using <code>onconnect</code> &amp; <code>port.onmessage</code> like this:</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R24d8uterddb»-content-main.js" data-state="active" id="radix-«R24d8uterddb»-trigger-main.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">main.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R24d8uterddb»-content-sharedWorker.js" data-state="inactive" id="radix-«R24d8uterddb»-trigger-sharedWorker.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">sharedWorker.js</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R24d8uterddb»-trigger-main.js" id="radix-«R24d8uterddb»-content-main.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> sharedWorker </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> SharedWorker</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">'sharedWorker.js'</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">sharedWorker</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">port</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({ action</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> 'greet'</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> data</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> 'Hello from Tab'</span><span style="color:#BFBDB6"> })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">sharedWorker</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#FF8F40"> function</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#BFBDB6">    console</span><span style="color:#F29668">.</span><span style="color:#FFB454">log</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">'Received response from SharedWorker:'</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">sharedWorker</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">port</span><span style="color:#F29668">.</span><span style="color:#FFB454">start</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R24d8uterddb»-trigger-sharedWorker.js" hidden="" id="radix-«R24d8uterddb»-content-sharedWorker.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div></div></div>
<p><strong>Proposal</strong></p>
<p>This could go two ways: lean into the existing <a href="https://github.com/wintercg/proposal-functions-api/tree/main">WinterTC for ESM-style handlers</a> like Durable Objects and Rivet or opt for a simpler &amp; portable interface like Web Workers.</p>
<p>In my opinion, request/response should use ESM-style exports with the <code>SharedWorker</code> interface. This allows the simplicity of request/response &amp; also enables full bidirectional streaming -- like a WebSocket but without the overhead.</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R26d8uterddb»-content-server.js" data-state="active" id="radix-«R26d8uterddb»-trigger-server.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">server.js</button><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R26d8uterddb»-content-server.js" data-state="active" id="radix-«R26d8uterddb»-trigger-server.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">server.js</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R26d8uterddb»-trigger-server.js" id="radix-«R26d8uterddb»-content-server.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	fetch</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">conn</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">		const</span><span style="color:#BFBDB6"> workerId </span><span style="color:#F29668">=</span><span style="color:#FFB454"> createServerlessWorkerId</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">		const</span><span style="color:#BFBDB6"> worker </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> ServerlessWorker</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"./worker.js"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> workerId)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">		conn</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">port</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({ action</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> 'greet'</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> data</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> 'foo'</span><span style="color:#BFBDB6"> })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"><span style="color:#BFBDB6">}</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R26d8uterddb»-trigger-server.js" id="radix-«R26d8uterddb»-content-server.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">conn</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">		const</span><span style="color:#BFBDB6"> port </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> conn</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ports[</span><span style="color:#D2A6FF">0</span><span style="color:#BFBDB6">]</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BFBDB6">		port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#D2A6FF"> event</span><span style="color:#FF8F40"> =></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">			const</span><span style="color:#BFBDB6"> { action</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> data } </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">			if</span><span style="color:#BFBDB6"> (action </span><span style="color:#F29668">===</span><span style="color:#AAD94C"> 'greet'</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#BFBDB6">				conn</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({ response</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> `Stateful serverless received: </span><span style="color:#FF8F40">${</span><span style="color:#BFBDB6">data</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6"> })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">			}</span></span>
<span class="line"><span style="color:#BFBDB6">		}</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BFBDB6">		port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onclose</span><span style="color:#F29668"> =</span><span style="color:#D2A6FF"> event</span><span style="color:#FF8F40"> =></span><span style="color:#BFBDB6"> console</span><span style="color:#F29668">.</span><span style="color:#FFB454">log</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">'Conn disconnected'</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"><span style="color:#BFBDB6">}</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div></div></div>
<p>Coincidentally, this also feels very similar to socket.io whose API has proven itself as flexible &amp; easy to understand.</p>
<h3 id="storage" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#storage"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#storage">Storage</a></h3>
<p><strong>Current Implementations: Rivet &amp; Durable Objects &amp; Deno</strong></p>
<p>Both Rivet and Durable Objects support a raw KV interface to access data stored on the actor itself.</p>
<p>While not specific to actors, Deno attempts to implement an <a href="https://docs.deno.com/api/deno/~/Deno.Kv">abstract KV interface</a>. However, this API is very opinionated to Deno Deploy and is by no means compatible across multiple clouds.</p>
<p><strong>Why KV</strong></p>
<p>Anything more (especially <code>IndexedDB</code>) is too complicated to expect cloud providers to implement correctly. <code>localStorage</code> has proven itself a simple &amp; reliable key-value store that&#x27;s lasted the test of time.</p>
<p>Frameworks can implement more advanced logic on top of key-value stores, just as they&#x27;ve done in the browser with <code>localStorage</code>.</p>
<p><strong>Async</strong></p>
<p>Regardless of what API this results in, it should be asynchronous. Cloudflare has gone as far as removing async code for their SQLite interface because they state it&#x27;s fast enough to not require an async context; the KV API could likely be made as simple as something like the browser&#x27;s <code>localStorage</code> by making each key a synchronous get. However, platforms all implement KV differently, so this may not make sense if attempting to provide maximum compatibility. Additionally, it would be impossible for compatibility layers to implement a KV API with an external medium if that medum requires an async operation to communicate with.</p>
<p><strong>Strings vs Structured Clone</strong></p>
<p><code>localStorage</code> currently only supports strings, which is what most developers are used to.</p>
<p>However, both Rivet &amp; Cloudflare Workers support natively storing data types that implement <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm">structured cloning</a> which allows storing many types of data in a compact V8-compatible binary interface with high-performance serialization &amp; deserialization.</p>
<p>If structured cloning was a protocol defined earlier, <code>localStorage</code> would likely support it natively. Whatever storage mechanism is chosen should support structured cloning.</p>
<p><strong>A Word On Complexity</strong></p>
<p>W3C has a history of inventing incredibly complicated standards for storage that are both (a) hard to understand as developers and (b) difficult to implement as a platform.</p>
<p>If you know how to use the <a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a> API from memory, I&#x27;m impressed.</p>
<p>Additionally, <a href="https://developer.chrome.com/blog/deprecating-web-sql">Web SQL</a> was an alternative standard that was deprecated because of its complexity.</p>
<p>Whatever the storage mechanism for <code>ServerlessWorker</code>s is, <strong>keep it simple, easy to implement, and easy to understand</strong>. Frameworks can always do the heavy lifting for you.</p>
<p><strong>Concurrency &amp; Input/Output Gates</strong></p>
<p>Concurrency is difficult to implement correctly across multiple platforms.</p>
<p>Cloudflare Durable Objects intelligently prevents common storage race conditions on Durable Objects without transactions through a mechanism called <em>input/output gates</em> detailed <a href="https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three/#our-answer-make-it-automatic">here</a>. This can be disabled with <code>ctx.storage.get(/* key*/, { allowConcurrency: true })</code>. Doing so will make the KV work like naive get/set without any extra functionality.</p>
<p>This is a controversial opinion, but I think that this behavior should be disabled by default and not part of a specification for a few reasons:</p>
<ol>
<li>Durable Object users almost never read from storage at runtime. <code>storage.get</code> is called in the constructor and <code>storage.put</code> is called when changed.</li>
<li>This behavior can be implemented at the framework level.</li>
<li>This behavior is almost certainly going to be incorrectly implemented by vendors.</li>
<li>Input/output gates do not work with WebSocket on Durable Objects already (please correct me if I&#x27;m wrong) and most developers aren&#x27;t accounting for this. <code>postMessage</code> and <code>onmessage</code> are closer to the Durable Object WebSocket behavior than the RPC behavior.</li>
</ol>
<p><strong>Keeping Scope Small</strong></p>
<p>For the purpose of building a broader picture of what <code>ServerlessWorker</code> might look like in practice, I&#x27;m going to assume that storage is going to be part of this specification. However, I think it makes more sense to either (a) find an existing mature spec to use for storage or (b) define a separate spec that can work in contexts outside of <code>ServerlessWorker</code>.</p>
<p><strong>Proposal</strong></p>
<p>Provide a dead simple async structured clone-based KV API and let the platforms provide extra configs for concurrency. For example:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">worker.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> count </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">||</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">  connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">conn</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">	const</span><span style="color:#BFBDB6"> port </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> conn</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ports[</span><span style="color:#D2A6FF">0</span><span style="color:#BFBDB6">]</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> (</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">      count </span><span style="color:#F29668">+=</span><span style="color:#D2A6FF"> 1</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">      await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> count)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="scheduling" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#scheduling"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#scheduling">Scheduling</a></h3>
<p><strong>Current Implementations</strong></p>
<p>A core part of <code>ServerlessWorker</code>s is to be able to run a function at an arbitrary timestamp.</p>
<p>Cloudflare provides a simple <code>setAlarm</code> API that has a single alarm. If you already have an alarm, it will override that alarm. I like this API since it&#x27;s significantly simpler than <code>setInterval</code> and <code>setTimeout</code> and lets frameworks provide more advanced APIs, such as CRONs.</p>
<p><strong>Proposal</strong></p>
<p>Provide an API similar to Cloudflare&#x27;s <a href="https://developers.cloudflare.com/durable-objects/api/storage-api/#setalarm"><code>setAlarm</code></a>. For example:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">worker.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Set an alarm for 1 day</span></span>
<span class="line"><span style="color:#FFB454">setAlarm</span><span style="color:#BFBDB6">(Date</span><span style="color:#F29668">.</span><span style="color:#FFB454">now</span><span style="color:#BFBDB6">() </span><span style="color:#F29668">+</span><span style="color:#D2A6FF"> 86_400</span><span style="color:#F29668"> *</span><span style="color:#D2A6FF"> 1000</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">	alarm</span><span style="color:#BFBDB6">() {</span></span>
<span class="line"><span style="color:#BFBDB6">		console</span><span style="color:#F29668">.</span><span style="color:#FFB454">log</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"It's been 1 day"</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">	}</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="sleeping-and-upgrading-and-host-migrations" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#sleeping-and-upgrading-and-host-migrations"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#sleeping-and-upgrading-and-host-migrations">Sleeping &amp; Upgrading &amp; Host Migrations</a></h3>
<p>A core advantage of <code>ServerlessWorker</code>s to something like <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes jobs</a> or other container-based stateful workloads: <code>ServerlessWorker</code>s can <strong>automatically sleep when there are no active operations</strong> and <strong>wake upon either fetch or alarm</strong>.</p>
<p>However, <code>ServerlessWorker</code> has to address specific edge cases when there are tasks that need to run in the background before being put to sleep.</p>
<p><strong>Current Implementation: Rivet</strong></p>
<p>Rivet mimics Unix behavior by sending a <code>SIGINT</code> signal to the process when it plans to go to sleep. Your application is given time to clean up any work and restart gracefully when it&#x27;s ready. This provides compatibility for a wide range of existing frameworks that implement the Node.js or Deno shutdown handler.</p>
<p><strong>Current Implementation: Durable Objects</strong></p>
<p>Durable Objects provides <a href="https://developers.cloudflare.com/durable-objects/api/state/#waituntil"><code>waitUntil</code></a>. My understanding is this is effectively a noop since (<a href="https://developers.cloudflare.com/durable-objects/api/state/#waituntil">see note</a>). However, I like the <code>waitUntil</code> API since it provides a JavaScript-y way of forcing the actor to stay awake.</p>
<p><strong>Proposal</strong></p>
<p>Provide an API similar to Durable Objects <code>waitUntil</code>. The provider can decide the maximum duration for this function. For example:</p>
<div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs"><div class="text-muted-foreground flex items-center gap-1"><div class="inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground">worker.js</div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">async</span><span style="color:#FF8F40"> function</span><span style="color:#FFB454"> doSomethingAsync</span><span style="color:#BFBDB6">() {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">	// ...</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFB454">waitUntil</span><span style="color:#BFBDB6">(</span><span style="color:#FFB454">doSomethingAsync</span><span style="color:#BFBDB6">())</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div>
<h3 id="handling-backpressure" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#handling-backpressure"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#handling-backpressure">Handling Backpressure</a></h3>
<p>Backpressure is a core problem in every distributed system and should always be handled carefully by developers to handle load gracefully.</p>
<p><strong>Current Implementation: Rivet</strong></p>
<p>Rivet provides low-level primitives to the developer, so it&#x27;s up to the developer to handle backpressure accordingly. An overloaded actor without any special backpressure handling will saturate the CPU.</p>
<p><strong>Current Implementation: Durable Objects</strong></p>
<p>Durable Objects throw an error with the <code>.overloaded</code> property set to <code>true</code> when making requests to a Durable Object that cannot accept more requests.</p>
<p><strong>Proposal</strong></p>
<p>Define an error type that can be used by developers to handle backpressure gracefully.</p>
<h3 id="security-model" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#security-model"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#security-model">Security Model</a></h3>
<p><strong>Proposal</strong></p>
<p><code>ServerlessWorker</code> should rely on the existing work in WinterTC. They are secured via these attributes:</p>
<ul>
<li><strong>Fetch Handler</strong>: Stateful <code>ServerlessWorker</code>s are only accessible through the stateless serverless fetch handler defined in WinterTC. This creates a protected gateway where all requests are authenticated and authorized before reaching any <code>ServerlessWorker</code>.</li>
<li><strong>Isolation Boundaries</strong>: Each <code>ServerlessWorker</code> runs in its own isolated environment, similar to Web Workers, preventing cross-worker data access without explicit communication channels.</li>
<li><strong>No Direct Network Access</strong>: <code>ServerlessWorker</code>s cannot be directly addressed from the public internet. All communication flows through the fetch handler, which can implement rate limiting, validation, and other security controls.</li>
</ul>
<p>The downside of relying on the fetch handler is that it may restrict who can implement <code>ServerlessWorker</code>. For example, there are many container orchestration platforms that may be able to implement the worker part of <code>ServerlessWorker</code>, but cannot implement the <code>fetch</code> handler. I don&#x27;t think this is an issue, since including these technologies that don&#x27;t already comply to WinterTC would make it too broad to be effective.</p>
<h3 id="out-of-scope" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#out-of-scope"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#out-of-scope">Out Of Scope</a></h3>
<p>Items out of the scope for this spec:</p>
<ul>
<li><strong>Locality</strong>: Cloudflare &amp; Rivet both have notions of where actors run, though the default is to run nearest where the request is coming from. This will likely end up as a platform-specific feature when constructing <code>ServerlessWorker</code>.</li>
<li><strong>Supervisors</strong>: Traditional actor runtimes use &quot;supervisors&quot; to automatically restart crashed actors. <code>ServerlessWorker</code> cannot crash, and instead will automatically log and disregard thrown errors -- similar to service workers.</li>
<li><strong>SQLite Storage</strong>: Many serious use cases of Durable Objects rely on SQLite. This is out of the scope for this web standard.</li>
<li><strong>Versioning</strong>: Cloudflare and Rivet each have significantly different ways of implementing versioning. Rivet is more like AWS AMI, while Cloudflare uses a simpler but less flexible version history.</li>
<li><strong>Upgrades &amp; Rolling Deploys</strong>: Leave it up to the platform to decide what code is running. Under the hood, the Rivet implementation of this standard would automatically call <a href="https://rivet.gg/docs/cloud/api/actors/upgrade"><code>actors.upgrade</code></a></li>
<li><strong>Logging</strong>: Leave this up to the platform to decide how to ship logs.</li>
</ul>
<h2 id="full-examples" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#full-examples"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#full-examples">Full Examples</a></h2>
<h3 id="rate-limiter" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#rate-limiter"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#rate-limiter">Rate Limiter</a></h3>
<p>This example demonstrates building a rate limit.</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R37d8uterddb»-content-rateLimiter.js" data-state="active" id="radix-«R37d8uterddb»-trigger-rateLimiter.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">rateLimiter.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R37d8uterddb»-content-server.js" data-state="inactive" id="radix-«R37d8uterddb»-trigger-server.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">server.js</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R37d8uterddb»-trigger-rateLimiter.js" id="radix-«R37d8uterddb»-content-rateLimiter.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// 10 requests/minute</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> maxRequests </span><span style="color:#F29668">=</span><span style="color:#D2A6FF"> 10</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> bucketDuration </span><span style="color:#F29668">=</span><span style="color:#D2A6FF"> 60_000</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Load state from storage</span></span>
<span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> count </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">||</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> resetAt </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"resetAt"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">||</span><span style="color:#BFBDB6"> (Date</span><span style="color:#F29668">.</span><span style="color:#FFB454">now</span><span style="color:#BFBDB6">() </span><span style="color:#F29668">+</span><span style="color:#BFBDB6"> bucketDuration)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">function</span><span style="color:#FFB454"> saveState</span><span style="color:#BFBDB6">() {</span></span>
<span class="line"><span style="color:#FF8F40">  await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"count"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> count)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">  await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"resetAt"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> resetAt)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">  connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">conn</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">    const</span><span style="color:#BFBDB6"> port </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> conn</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ports[</span><span style="color:#D2A6FF">0</span><span style="color:#BFBDB6">]</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#BFBDB6"> (</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">      const</span><span style="color:#BFBDB6"> { type</span><span style="color:#BFBDB6B3">,</span><span style="color:#F29668"> ...</span><span style="color:#BFBDB6">data } </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // Check if bucket should be reset</span></span>
<span class="line"><span style="color:#FF8F40">      const</span><span style="color:#BFBDB6"> now </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> Date</span><span style="color:#F29668">.</span><span style="color:#FFB454">now</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">      if</span><span style="color:#BFBDB6"> (now </span><span style="color:#F29668">>=</span><span style="color:#BFBDB6"> resetAt) {</span></span>
<span class="line"><span style="color:#BFBDB6">        count </span><span style="color:#F29668">=</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">        resetAt </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> now </span><span style="color:#F29668">+</span><span style="color:#BFBDB6"> bucketDuration</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">        saveState</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">      switch</span><span style="color:#BFBDB6"> (type) {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">        // Check if within rate limit</span></span>
<span class="line"><span style="color:#FF8F40">        case</span><span style="color:#AAD94C"> "HIT"</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">          // Update limit</span></span>
<span class="line"><span style="color:#FF8F40">          const</span><span style="color:#BFBDB6"> isAllowed </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> count </span><span style="color:#F29668">&#x3C;</span><span style="color:#BFBDB6"> maxRequests</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          if</span><span style="color:#BFBDB6"> (isAllowed) {</span></span>
<span class="line"><span style="color:#BFBDB6">            count </span><span style="color:#F29668">+=</span><span style="color:#D2A6FF"> 1</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">            saveState</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BFBDB6">          conn</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({ isAllowed })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">          break</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">        // Reset rate limit (unused, purely for example)</span></span>
<span class="line"><span style="color:#FF8F40">        case</span><span style="color:#AAD94C"> "RESET"</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#BFBDB6">          count </span><span style="color:#F29668">=</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          resetAt </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> now </span><span style="color:#F29668">+</span><span style="color:#BFBDB6"> bucketDuration</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FFB454">          saveState</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          break</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R37d8uterddb»-trigger-server.js" hidden="" id="radix-«R37d8uterddb»-content-server.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div></div></div>
<h3 id="pub-sub-server" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#pub-sub-server"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#pub-sub-server">Pub/Sub Server</a></h3>
<p>This example demonstrates a simple pub/sub system where each topic is its own serverless worker with connected clients.</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R38t8uterddb»-content-topicWorker.js" data-state="active" id="radix-«R38t8uterddb»-trigger-topicWorker.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">topicWorker.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R38t8uterddb»-content-server.js" data-state="inactive" id="radix-«R38t8uterddb»-trigger-server.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">server.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R38t8uterddb»-content-client.js" data-state="inactive" id="radix-«R38t8uterddb»-trigger-client.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">client.js</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R38t8uterddb»-trigger-topicWorker.js" id="radix-«R38t8uterddb»-content-topicWorker.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// A set of all connected clients</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> subscribers </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> Set</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">  connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">    const</span><span style="color:#BFBDB6"> port </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ports[</span><span style="color:#D2A6FF">0</span><span style="color:#BFBDB6">]</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    subscribers</span><span style="color:#F29668">.</span><span style="color:#FFB454">add</span><span style="color:#BFBDB6">(port)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#D2A6FF"> event</span><span style="color:#FF8F40"> =></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">      const</span><span style="color:#BFBDB6"> { type</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> data } </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#FF8F40">      if</span><span style="color:#BFBDB6"> (type </span><span style="color:#F29668">===</span><span style="color:#AAD94C"> "publish"</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">        // Broadcast to all subscribers</span></span>
<span class="line"><span style="color:#FF8F40">        for</span><span style="color:#BFBDB6"> (</span><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> client </span><span style="color:#F29668">of</span><span style="color:#BFBDB6"> subscribers) {</span></span>
<span class="line"><span style="color:#BFBDB6">          client</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({</span></span>
<span class="line"><span style="color:#BFBDB6">            type</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "message"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#BFBDB6">            data</span></span>
<span class="line"><span style="color:#BFBDB6">          })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">        }</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // Remove on disconnect</span></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onclose</span><span style="color:#F29668"> =</span><span style="color:#BFBDB6"> () </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">      subscribers</span><span style="color:#F29668">.</span><span style="color:#FFB454">delete</span><span style="color:#BFBDB6">(port)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R38t8uterddb»-trigger-server.js" hidden="" id="radix-«R38t8uterddb»-content-server.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R38t8uterddb»-trigger-client.js" hidden="" id="radix-«R38t8uterddb»-content-client.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div></div></div>
<h3 id="simple-chat-room" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#simple-chat-room"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#simple-chat-room">Simple Chat Room</a></h3>
<p>This example demonstrates a simple chat room implementation with message persistence.</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R3ad8uterddb»-content-chatRoom.js" data-state="active" id="radix-«R3ad8uterddb»-trigger-chatRoom.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">chatRoom.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R3ad8uterddb»-content-server.js" data-state="inactive" id="radix-«R3ad8uterddb»-trigger-server.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">server.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R3ad8uterddb»-content-client.js" data-state="inactive" id="radix-«R3ad8uterddb»-trigger-client.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">client.js</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R3ad8uterddb»-trigger-chatRoom.js" id="radix-«R3ad8uterddb»-content-chatRoom.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Keep track of all connections to this chat room</span></span>
<span class="line"><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> connections </span><span style="color:#F29668">=</span><span style="color:#F29668"> new</span><span style="color:#FFB454"> Set</span><span style="color:#BFBDB6">()</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Keep messages in memory</span></span>
<span class="line"><span style="color:#FF8F40">let</span><span style="color:#BFBDB6"> messages </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"messages"</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">??</span><span style="color:#BFBDB6"> []</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">// Broadcast a message to all connected clients</span></span>
<span class="line"><span style="color:#FF8F40">function</span><span style="color:#FFB454"> broadcast</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">message</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">  for</span><span style="color:#BFBDB6"> (</span><span style="color:#FF8F40">const</span><span style="color:#BFBDB6"> conn </span><span style="color:#F29668">of</span><span style="color:#BFBDB6"> connections) {</span></span>
<span class="line"><span style="color:#BFBDB6">    conn</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">(message)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">  connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">    const</span><span style="color:#BFBDB6"> port </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ports[</span><span style="color:#D2A6FF">0</span><span style="color:#BFBDB6">]</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    connections</span><span style="color:#F29668">.</span><span style="color:#FFB454">add</span><span style="color:#BFBDB6">(port)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // Send message history to new client</span></span>
<span class="line"><span style="color:#FF8F40">    if</span><span style="color:#BFBDB6"> (messages</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">length </span><span style="color:#F29668">></span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#BFBDB6">      port</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">({</span></span>
<span class="line"><span style="color:#BFBDB6">        type</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "history"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#BFBDB6">        messages</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> messages</span><span style="color:#F29668">.</span><span style="color:#FFB454">slice</span><span style="color:#BFBDB6">(</span><span style="color:#F29668">-</span><span style="color:#D2A6FF">20</span><span style="color:#BFBDB6">)</span></span>
<span class="line"><span style="color:#BFBDB6">      })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> (</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">      const</span><span style="color:#BFBDB6"> { text</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> username } </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // Create message object</span></span>
<span class="line"><span style="color:#FF8F40">      const</span><span style="color:#BFBDB6"> message </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">        text</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#BFBDB6">        username</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#BFBDB6">        timestamp</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> Date</span><span style="color:#F29668">.</span><span style="color:#FFB454">now</span><span style="color:#BFBDB6">()</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // Store message</span></span>
<span class="line"><span style="color:#BFBDB6">      messages</span><span style="color:#F29668">.</span><span style="color:#FFB454">push</span><span style="color:#BFBDB6">(message)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // Save periodically </span></span>
<span class="line"><span style="color:#FF8F40">      if</span><span style="color:#BFBDB6"> (messages</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">length </span><span style="color:#F29668">%</span><span style="color:#D2A6FF"> 10</span><span style="color:#F29668"> ===</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">        await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"messages"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> messages)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // Broadcast to all clients</span></span>
<span class="line"><span style="color:#FFB454">      broadcast</span><span style="color:#BFBDB6">({</span></span>
<span class="line"><span style="color:#BFBDB6">        type</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "message"</span><span style="color:#BFBDB6B3">,</span></span>
<span class="line"><span style="color:#BFBDB6">        message</span></span>
<span class="line"><span style="color:#BFBDB6">      })</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">    // Handle client disconnection</span></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onclose</span><span style="color:#F29668"> =</span><span style="color:#BFBDB6"> () </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#BFBDB6">      connections</span><span style="color:#F29668">.</span><span style="color:#FFB454">delete</span><span style="color:#BFBDB6">(port)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // If this was the last connection, save messages</span></span>
<span class="line"><span style="color:#FF8F40">      if</span><span style="color:#BFBDB6"> (connections</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">size </span><span style="color:#F29668">===</span><span style="color:#D2A6FF"> 0</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FFB454">        waitUntil</span><span style="color:#BFBDB6">(storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">"messages"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> messages))</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R3ad8uterddb»-trigger-server.js" hidden="" id="radix-«R3ad8uterddb»-content-server.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R3ad8uterddb»-trigger-client.js" hidden="" id="radix-«R3ad8uterddb»-content-client.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div></div></div>
<h3 id="redis-like-server" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#redis-like-server"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#redis-like-server">Redis-Like Server</a></h3>
<p>This example demonstrates a minimalistic Redis-like key-value store server with get, set, and delete operations.</p>
<div class="code-group group my-4 rounded-md border pt-2" data-code-group="true"><div dir="ltr" data-orientation="horizontal" class=""><div class="flex gap-1 border-b pr-2"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!table" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><div role="tablist" aria-orientation="horizontal" class="inline-flex text-muted-foreground w-full border-b-0" tabindex="-1" data-orientation="horizontal" style="outline:none"><button type="button" role="tab" aria-selected="true" aria-controls="radix-«R3bt8uterddb»-content-redisWorker.js" data-state="active" id="radix-«R3bt8uterddb»-trigger-redisWorker.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">redisWorker.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R3bt8uterddb»-content-server.js" data-state="inactive" id="radix-«R3bt8uterddb»-trigger-server.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">server.js</button><button type="button" role="tab" aria-selected="false" aria-controls="radix-«R3bt8uterddb»-content-client.js" data-state="inactive" id="radix-«R3bt8uterddb»-trigger-client.js" class="inline-flex items-center justify-center whitespace-nowrap py-1 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 relative h-9 rounded-none border-b-2 border-b-transparent bg-transparent px-4 pb-3 pt-2 font-semibold text-muted-foreground shadow-none transition-none data-[state=active]:border-b-primary data-[state=active]:text-foreground data-[state=active]:shadow-none" tabindex="-1" data-orientation="horizontal" data-radix-collection-item="">client.js</button></div></div></div></div><button class="group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 text-foreground"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="copy" class="svg-inline--fa fa-copy " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z"></path></svg></button></div><div data-state="active" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R3bt8uterddb»-trigger-redisWorker.js" id="radix-«R3bt8uterddb»-content-redisWorker.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2" style="animation-duration:0s"><div class="not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none" data-code-group="true"><div class="bg-background text-wrap p-2 text-sm"><div dir="ltr" class="relative overflow-hidden w-full" style="position:relative;--radix-scroll-area-corner-width:0px;--radix-scroll-area-corner-height:0px"><style>[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}</style><div data-radix-scroll-area-viewport="" class="h-full w-full rounded-[inherit] [&amp;&gt;div]:!block" style="overflow-x:hidden;overflow-y:hidden"><div style="min-width:100%;display:table"><span class="not-prose code"><pre class="shiki ayu-dark" style="background-color:#0c0a09;color:#bfbdb6" tabindex="0"><code><span class="line"><span style="color:#FF8F40">export</span><span style="color:#FF8F40"> default</span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FFB454">  connect</span><span style="color:#BFBDB6">(</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) {</span></span>
<span class="line"><span style="color:#FF8F40">    const</span><span style="color:#BFBDB6"> port </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">ports[</span><span style="color:#D2A6FF">0</span><span style="color:#BFBDB6">]</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    </span></span>
<span class="line"><span style="color:#BFBDB6">    port</span><span style="color:#F29668">.</span><span style="color:#FFB454">onmessage</span><span style="color:#F29668"> =</span><span style="color:#FF8F40"> async</span><span style="color:#BFBDB6"> (</span><span style="color:#D2A6FF">event</span><span style="color:#BFBDB6">) </span><span style="color:#FF8F40">=></span><span style="color:#BFBDB6"> {</span></span>
<span class="line"><span style="color:#FF8F40">      const</span><span style="color:#BFBDB6"> { command</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> key</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> value } </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> event</span><span style="color:#F29668">.</span><span style="color:#BFBDB6">data</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">      let</span><span style="color:#BFBDB6"> response</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">      // Handle different Redis-like commands - directly using storage API</span></span>
<span class="line"><span style="color:#FF8F40">      switch</span><span style="color:#BFBDB6"> (command) {</span></span>
<span class="line"><span style="color:#FF8F40">        case</span><span style="color:#AAD94C"> "GET"</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#FF8F40">          const</span><span style="color:#BFBDB6"> storedValue </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">`key:</span><span style="color:#FF8F40">${</span><span style="color:#BFBDB6">key</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          response </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> { </span></span>
<span class="line"><span style="color:#BFBDB6">            status</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "success"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">            value</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> storedValue </span><span style="color:#F29668">!==</span><span style="color:#D2A6FF"> undefined</span><span style="color:#F29668"> ?</span><span style="color:#BFBDB6"> storedValue </span><span style="color:#F29668">:</span><span style="color:#D2A6FF"> null</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">          }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          break</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          </span></span>
<span class="line"><span style="color:#FF8F40">        case</span><span style="color:#AAD94C"> "SET"</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#FF8F40">          await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">put</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">`key:</span><span style="color:#FF8F40">${</span><span style="color:#BFBDB6">key</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> value)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          response </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> { status</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "success"</span><span style="color:#BFBDB6"> }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          break</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          </span></span>
<span class="line"><span style="color:#FF8F40">        case</span><span style="color:#AAD94C"> "DEL"</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#FF8F40">          const</span><span style="color:#BFBDB6"> exists </span><span style="color:#F29668">=</span><span style="color:#FF8F40"> await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">get</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">`key:</span><span style="color:#FF8F40">${</span><span style="color:#BFBDB6">key</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6">) </span><span style="color:#F29668">!==</span><span style="color:#D2A6FF"> undefined</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          if</span><span style="color:#BFBDB6"> (exists) {</span></span>
<span class="line"><span style="color:#FF8F40">            await</span><span style="color:#BFBDB6"> storage</span><span style="color:#F29668">.</span><span style="color:#FFB454">delete</span><span style="color:#BFBDB6">(</span><span style="color:#AAD94C">`key:</span><span style="color:#FF8F40">${</span><span style="color:#BFBDB6">key</span><span style="color:#FF8F40">}</span><span style="color:#AAD94C">`</span><span style="color:#BFBDB6">)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          }</span></span>
<span class="line"><span style="color:#BFBDB6">          response </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> { </span></span>
<span class="line"><span style="color:#BFBDB6">            status</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "success"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">            deleted</span><span style="color:#BFBDB6B3">:</span><span style="color:#BFBDB6"> exists</span></span>
<span class="line"><span style="color:#BFBDB6">          }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          break</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          </span></span>
<span class="line"><span style="color:#FF8F40">        case</span><span style="color:#AAD94C"> "KEYS"</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">          // For a real implementation, this would need support from the platform</span></span>
<span class="line"><span style="color:#ACB6BF8C;font-style:italic">          // to list keys with a specific prefix or pattern</span></span>
<span class="line"><span style="color:#BFBDB6">          response </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> { </span></span>
<span class="line"><span style="color:#BFBDB6">            status</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "error"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">            message</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "KEYS command not supported in this simplified implementation"</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">          }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#FF8F40">          break</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">          </span></span>
<span class="line"><span style="color:#FF8F40">        default</span><span style="color:#BFBDB6">:</span></span>
<span class="line"><span style="color:#BFBDB6">          response </span><span style="color:#F29668">=</span><span style="color:#BFBDB6"> { </span></span>
<span class="line"><span style="color:#BFBDB6">            status</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "error"</span><span style="color:#BFBDB6B3">,</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">            message</span><span style="color:#BFBDB6B3">:</span><span style="color:#AAD94C"> "Unknown command"</span><span style="color:#BFBDB6"> </span></span>
<span class="line"><span style="color:#BFBDB6">          }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">      }</span></span>
<span class="line"><span style="color:#BFBDB6">      </span></span>
<span class="line"><span style="color:#BFBDB6">      port</span><span style="color:#F29668">.</span><span style="color:#FFB454">postMessage</span><span style="color:#BFBDB6">(response)</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">    }</span><span style="color:#BFBDB6B3">;</span></span>
<span class="line"><span style="color:#BFBDB6">  }</span></span>
<span class="line"><span style="color:#BFBDB6">}</span></span>
<span class="line"></span></code></pre></span></div></div></div></div></div></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R3bt8uterddb»-trigger-server.js" hidden="" id="radix-«R3bt8uterddb»-content-server.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div><div data-state="inactive" data-orientation="horizontal" role="tabpanel" aria-labelledby="radix-«R3bt8uterddb»-trigger-client.js" hidden="" id="radix-«R3bt8uterddb»-content-client.js" tabindex="0" class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"></div></div></div>
<h2 id="more-thought-required" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#more-thought-required"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#more-thought-required">More Thought Required</a></h2>
<h3 id="data-migrations" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#data-migrations"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#data-migrations">Data Migrations</a></h3>
<p>WinterTC is great specification for stateless serverless since migrating providers is as simple as updating a DNS record.</p>
<p>However, stateful serverless is significantly different since <strong>this spec is effectively defining a database</strong>, since <code>ServerlessWorker</code>s have persistent storage.</p>
<p>If the whole point of defining a common specification for stateful serverless is to encourage companies to adopt new technologies, then they&#x27;ll also need assurances on their ability to migrate between providers. For example, Postgres provides the ability to use <a target="_blank" href="https://www.postgresql.org/docs/current/logical-replication.html">logical replication</a> for live migrations and is used frequently.</p>
<h3 id="storage-2" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#storage-2"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#storage-2">Storage</a></h3>
<p>The storage is the most rough section of this spec. It probably justifies its own spec.</p>
<h3 id="connection-interruptions" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#connection-interruptions"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#connection-interruptions">Connection Interruptions</a></h3>
<p><code>SharedWorker</code> connections cannot be interrupted. Can <code>ServerlessWorker</code> connections be interrupted? What happens if they are?</p>
<h2 id="next-steps" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#next-steps"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#next-steps">Next Steps</a></h2>
<p>We <a href="https://github.com/rivet-gg/proposal-stateful-serverless-api">uploaded this proposal to GitHub</a> for feedback and iteration. Once there&#x27;s more momentum, I hope to move this out of the <code>rivet-gg</code> organization in to an official W3C process.</p>
<h3 id="feedback-on-git-hub" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#feedback-on-git-hub"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#feedback-on-git-hub">Feedback On GitHub</a></h3>
<p>Please add feedback as a issue or pull request on the <a href="https://github.com/rivet-gg/proposal-stateful-serverless-api">proposal GitHub</a>.</p>
<h3 id="reference-implementation" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#reference-implementation"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#reference-implementation">Reference Implementation</a></h3>
<p>Once a general specification is implemented, a reference specification is trivial to implement on any of the providers previously mentioned. A compatibility layer could be implemented on the existing work with Rivet drivers.</p>
<h2 id="survey-help-shape-the-specification" class="scroll-mt-header group relative scroll-mt-header-offset"><div class="group absolute -left-10 top-1 h-full pr-10"><a class="group group/button items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border border-input bg-transparent hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [&amp;_svg]:size-3 gap-1.5 not-prose relative hidden group-hover:flex" href="#survey-help-shape-the-specification"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="link" class="svg-inline--fa fa-link " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M579.8 267.7c56.5-56.5 56.5-148 0-204.5c-50-50-128.8-56.5-186.3-15.4l-1.6 1.1c-14.4 10.3-17.7 30.3-7.4 44.6s30.3 17.7 44.6 7.4l1.6-1.1c32.1-22.9 76-19.3 103.8 8.6c31.5 31.5 31.5 82.5 0 114L422.3 334.8c-31.5 31.5-82.5 31.5-114 0c-27.9-27.9-31.5-71.8-8.6-103.8l1.1-1.6c10.3-14.4 6.9-34.4-7.4-44.6s-34.4-6.9-44.6 7.4l-1.1 1.6C206.5 251.2 213 330 263 380c56.5 56.5 148 56.5 204.5 0L579.8 267.7zM60.2 244.3c-56.5 56.5-56.5 148 0 204.5c50 50 128.8 56.5 186.3 15.4l1.6-1.1c14.4-10.3 17.7-30.3 7.4-44.6s-30.3-17.7-44.6-7.4l-1.6 1.1c-32.1 22.9-76 19.3-103.8-8.6C74 372 74 321 105.5 289.5L217.7 177.2c31.5-31.5 82.5-31.5 114 0c27.9 27.9 31.5 71.8 8.6 103.9l-1.1 1.6c-10.3 14.4-6.9 34.4 7.4 44.6s34.4 6.9 44.6-7.4l1.1-1.6C433.5 260.8 427 182 377 132c-56.5-56.5-148-56.5-204.5 0L60.2 244.3z"></path></svg></a></div><a class="group text-inherit no-underline hover:text-inherit" href="#survey-help-shape-the-specification">Survey: Help Shape the Specification</a></h2>
<p>If you are either (a) a user of Durable Objects/Rivet actors or (b) want to aid in the direction, it&#x27;d be helpful to take the time to answer these questions as a <a href="https://github.com/rivet-gg/proposal-stateful-serverless-api/issues">GitHub issue</a> on the proposal:</p>
<ul>
<li><strong>Do we attempt to specify existing APIs or implement based on existing work by W3C?</strong> This spec aims to build on patterns already defined by W3C, however it might make sense to stick to better documenting overlap between existing providers (currently only Durable Objects &amp; Rivet as far as I know). My understanding is WinterTC attempted to create a spec that matched existing APIs. I&#x27;d be happy to rewrite this spec based on the <code>fetch</code> API if the answer to this is <em>yes</em>.</li>
<li><strong>What are the most common hesitations for companies adopting stateful serverless?</strong> Is there something this spec can address?</li>
<li><strong>What are the most common problems with stateful serverless that contributes to cognitive load?</strong> Does the simplicity of this spec help address that?</li>
<li><strong>What reference design patterns should we be designing for?</strong> The examples attached attempt to provide a very basic overview of common patterns on Durable Objects, but does not cover use cases like worker-worker communication.</li>
<li><strong>How should storage be represented?</strong> This spec proposes using a simple KV. This storage mechanism might be too restrictive, or we might not want to write a spec for storage altogether and keep <code>ServerlessWorker</code> very simple. It may make sense to leverage an existing storage spec or write a new separate storage spec that is combined with this.</li>
<li><strong>Should this be broader than web technologies?</strong> This spec makes the assumption it&#x27;s part of W3C and leverages web technologies. However, there are a few container platforms that do not use web technologies which might fall under this scope.</li>
<li><strong>Should this spec care about regions?</strong> <code>ServerlessWorker</code> shine when they run at the edge. Should they have a default for configuring locations, similar to Rivet and Cloudflare?</li>
</ul>
<p><em>Thanks to <a href="https://x.com/LambrosPetrou">LambrosPetrou</a>, <a href="https://x.com/firtozb">firtozb</a>, <a href="https://x.com/uripont_">uripont_</a>, and <a href="https://x.com/p_mbanugo">p_mbanugo</a> for feedback on the initial document.</em></p><div class="after:bg-secondary relative mt-14 flex items-center justify-center after:absolute after:inset-x-0 after:-z-[1] after:h-[1px]"><a href="/rss/feed.xml" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="square-rss" class="svg-inline--fa fa-square-rss fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zM96 136c0-13.3 10.7-24 24-24c137 0 248 111 248 248c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-110.5-89.5-200-200-200c-13.3 0-24-10.7-24-24zm0 96c0-13.3 10.7-24 24-24c83.9 0 152 68.1 152 152c0 13.3-10.7 24-24 24s-24-10.7-24-24c0-57.4-46.6-104-104-104c-13.3 0-24-10.7-24-24zm0 120a32 32 0 1 1 64 0 32 32 0 1 1 -64 0z"></path></svg></a><a href="https://x.com/share?text=Considering%20A%20W3C%20Standard%20For%20Stateful%20Serverless%20https%3A%2F%2Fwww.rivet.gg%2Fchangelog%2F2025-03-23-what-would-a-w3c-standard-look-like-for-stateful-serverless-%2F%20via%20%40rivet_gg" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="x-twitter" class="svg-inline--fa fa-x-twitter fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a><a href="https://news.ycombinator.com/submitlink?u=https%3A%2F%2Fwww.rivet.gg%2Fchangelog%2F2025-03-23-what-would-a-w3c-standard-look-like-for-stateful-serverless-%2F&amp;t=Considering%20A%20W3C%20Standard%20For%20Stateful%20Serverless" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="hacker-news" class="svg-inline--fa fa-hacker-news fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 32v448h448V32H0zm21.2 197.2H21c.1-.1.2-.3.3-.4 0 .1 0 .3-.1.4zm218 53.9V384h-31.4V281.3L128 128h37.3c52.5 98.3 49.2 101.2 59.3 125.6 12.3-27 5.8-24.4 60.6-125.6H320l-80.8 155.1z"></path></svg></a><a href="https://www.reddit.com/submit?url=https://www.rivet.gg/changelog/2025-03-23-what-would-a-w3c-standard-look-like-for-stateful-serverless-/&amp;title=Considering%20A%20W3C%20Standard%20For%20Stateful%20Serverless" target="_blank" rel="noreferrer" class="text-primary hover:text-primary/80 bg-background px-3 transition-colors"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-xl " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M0 256C0 114.6 114.6 0 256 0S512 114.6 512 256s-114.6 256-256 256L37.1 512c-13.7 0-20.5-16.5-10.9-26.2L75 437C28.7 390.7 0 326.7 0 256zM349.6 153.6c23.6 0 42.7-19.1 42.7-42.7s-19.1-42.7-42.7-42.7c-20.6 0-37.8 14.6-41.8 34c-34.5 3.7-61.4 33-61.4 68.4l0 .2c-37.5 1.6-71.8 12.3-99 29.1c-10.1-7.8-22.8-12.5-36.5-12.5c-33 0-59.8 26.8-59.8 59.8c0 24 14.1 44.6 34.4 54.1c2 69.4 77.6 125.2 170.6 125.2s168.7-55.9 170.6-125.3c20.2-9.6 34.1-30.2 34.1-54c0-33-26.8-59.8-59.8-59.8c-13.7 0-26.3 4.6-36.4 12.4c-27.4-17-62.1-27.7-100-29.1l0-.2c0-25.4 18.9-46.5 43.4-49.9l0 0c4.4 18.8 21.3 32.8 41.5 32.8zM177.1 246.9c16.7 0 29.5 17.6 28.5 39.3s-13.5 29.6-30.3 29.6s-31.4-8.8-30.4-30.5s15.4-38.3 32.1-38.3zm190.1 38.3c1 21.7-13.7 30.5-30.4 30.5s-29.3-7.9-30.3-29.6c-1-21.7 11.8-39.3 28.5-39.3s31.2 16.6 32.1 38.3zm-48.1 56.7c-10.3 24.6-34.6 41.9-63 41.9s-52.7-17.3-63-41.9c-1.2-2.9 .8-6.2 3.9-6.5c18.4-1.9 38.3-2.9 59.1-2.9s40.7 1 59.1 2.9c3.1 .3 5.1 3.6 3.9 6.5z"></path></svg></a></div></article><aside class="order-2 min-w-0 max-w-xs flex-1 lg:order-3"><div class="lg:top-header pt-10 lg:pt-6 w-full lg:pointer-events-auto lg:sticky lg:block lg:max-w-aside lg:self-start lg:overflow-y-auto lg:max-h-content"><div class="relative"><div class="relative"><ul><li class="relative"><div class="relative"><a aria-current="page" class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#what-is-stateful-serverless"><span class="truncate">What Is Stateful Serverless?</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#stateless-serverless-functions-vs-stateful-serverless-workers"><span class="truncate">Stateless Serverless (Functions) vs Stateful Serverless (Workers)</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#primary-use-cases"><span class="truncate">Primary Use Cases</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#scope-of-this-proposal"><span class="truncate">Scope Of This Proposal</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#why-should-i-care"><span class="truncate">Why Should I Care?</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#why-build-a-web-standard"><span class="truncate">Why Build A Web Standard?</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#customers-wary-of-vendor-lock"><span class="truncate">Customers Wary Of Vendor-Lock</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#incentivize-more-providers"><span class="truncate">Incentivize More Providers</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#todays-stateful-serverless-implementations"><span class="truncate">Today&#x27;s Stateful Serverless Implementations</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#cloudflare-durable-objects-the-most-popular-option"><span class="truncate">Cloudflare Durable Objects: The Most Popular Option</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#cloudflare-agents-framework-moving-beyond-durable-objects"><span class="truncate">Cloudflare Agents Framework: Moving Beyond Durable Objects</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#rivet-open-source-serverless-infrastructure"><span class="truncate">Rivet: Open-Source Serverless Infrastructure</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#rivet-kit-framework-stateful-serverless-on-any-cloud"><span class="truncate">RivetKit Framework: Stateful Serverless On Any Cloud</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#other-actor-runtimes-the-precursor-to-stateful-serverless"><span class="truncate">Other Actor Runtimes: The Precursor To Stateful Serverless</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#specification-goals"><span class="truncate">Specification Goals</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#classes-vs-functions"><span class="truncate">Classes vs Functions</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#alternative-1-fetch-based-communication"><span class="truncate">Alternative #1: Fetch-Based Communication</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#alternative-2-a-cgi-like-standard"><span class="truncate">Alternative #2: A CGI-Like Standard</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#drawing-inspiration-from-shared-worker"><span class="truncate">Drawing Inspiration From SharedWorker</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#introducing-serverless-worker"><span class="truncate">Introducing ServerlessWorker</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#creating-initializing-and-addressing-serverless-workers"><span class="truncate">Creating, Initializing, &amp; Addressing ServerlessWorkers</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#terminating-serverless-workers"><span class="truncate">Terminating ServerlessWorkers</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#connections-and-messages"><span class="truncate">Connections &amp; Messages</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#storage"><span class="truncate">Storage</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#scheduling"><span class="truncate">Scheduling</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#sleeping-and-upgrading-and-host-migrations"><span class="truncate">Sleeping &amp; Upgrading &amp; Host Migrations</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#handling-backpressure"><span class="truncate">Handling Backpressure</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#security-model"><span class="truncate">Security Model</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#out-of-scope"><span class="truncate">Out Of Scope</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#full-examples"><span class="truncate">Full Examples</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#rate-limiter"><span class="truncate">Rate Limiter</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#pub-sub-server"><span class="truncate">Pub/Sub Server</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#simple-chat-room"><span class="truncate">Simple Chat Room</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#redis-like-server"><span class="truncate">Redis-Like Server</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#more-thought-required"><span class="truncate">More Thought Required</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#data-migrations"><span class="truncate">Data Migrations</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#storage-2"><span class="truncate">Storage</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#connection-interruptions"><span class="truncate">Connection Interruptions</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#next-steps"><span class="truncate">Next Steps</span></a></div><div class="relative pl-3"><ul><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#feedback-on-git-hub"><span class="truncate">Feedback On GitHub</span></a></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#reference-implementation"><span class="truncate">Reference Implementation</span></a></div></li></ul></div></li><li class="relative"><div class="relative"><a class="group flex w-full items-center rounded-md border border-transparent px-2 py-1 text-sm text-muted-foreground hover:underline aria-current-page:text-foreground" href="#survey-help-shape-the-specification"><span class="truncate">Survey: Help Shape the Specification</span></a></div></li></ul><form class="mt-6 px-2"><div class="flex flex-col gap-2"><label class="font-medium peer-disabled:cursor-not-allowed peer-disabled:opacity-70 text-sm" for="newsletter-email">Rivet Newsletter</label><input type="email" required="" placeholder="you@company.com" autoComplete="email" class="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 ring-offset-background file:border-0 file:text-foreground file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground/50 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-within:ring-2 focus-within:ring-ring focus-within:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 text-sm" name="$survey_response_2adad347-bc39-48f3-b5d1-755278685c94"/><button class="group group/button inline-flex items-center justify-center whitespace-nowrap font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 border button-secondary bg-secondary text-secondary-foreground hover:bg-secondary/80 h-7 rounded-md px-2 text-xs [&amp;_svg]:size-3 gap-1.5" type="submit">Subscribe</button></div></form></div></div></div></aside></div><div class="mx-auto w-full mb-8 max-w-prose mt-4 no-prose"></div><!--$--><!--/$--><!--$--><!--/$--></div><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><div><hr class="mb-8 border-white/10"/><footer aria-labelledby="footer-heading" class="mx-auto max-w-screen-2xl px-6 lg:px-12"><h2 id="footer-heading" class="sr-only">Footer</h2><div class="mx-auto max-w-screen-2xl w-full pb-8 pt-16 sm:pt-20"><div class="xl:grid xl:grid-cols-12 xl:gap-24"><div class="space-y-8 xl:col-span-3"><img alt="Rivet" loading="lazy" width="128" height="128" decoding="async" data-nimg="1" class="size-12" style="color:transparent" src="/_next/static/media/icon-white.4596e04f.svg"/><p class="text-sm leading-6 text-gray-300">The open-source alternative to Durable Objects</p><div class="flex space-x-6"><a class="text-xl text-gray-500 hover:text-gray-400" href="https://discord.gg/aXYfyNxYVn"><span class="sr-only">Discord</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="discord" class="svg-inline--fa fa-discord " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://twitter.com/rivet_gg"><span class="sr-only">Twitter</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://bsky.app/profile/rivet.gg"><span class="sr-only">Bluesky</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="bluesky" class="svg-inline--fa fa-bluesky " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M111.8 62.2C170.2 105.9 233 194.7 256 242.4c23-47.6 85.8-136.4 144.2-180.2c42.1-31.6 110.3-56 110.3 21.8c0 15.5-8.9 130.5-14.1 149.2C478.2 298 412 314.6 353.1 304.5c102.9 17.5 129.1 75.5 72.5 133.5c-107.4 110.2-154.3-27.6-166.3-62.9l0 0c-1.7-4.9-2.6-7.8-3.3-7.8s-1.6 3-3.3 7.8l0 0c-12 35.3-59 173.1-166.3 62.9c-56.5-58-30.4-116 72.5-133.5C100 314.6 33.8 298 15.7 233.1C10.4 214.4 1.5 99.4 1.5 83.9c0-77.8 68.2-53.4 110.3-21.8z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://github.com/rivet-gg"><span class="sr-only">GitHub</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://www.youtube.com/@rivet-gg"><span class="sr-only">YouTube</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="youtube" class="svg-inline--fa fa-youtube " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a><a class="text-xl text-gray-500 hover:text-gray-400" href="https://www.linkedin.com/company/72072261/"><span class="sr-only">LinkedIn</span><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></div></div><div class="mt-16 grid grid-cols-1 gap-x-12 gap-y-8 md:grid-cols-4 xl:col-span-9 xl:mt-0"><div><div class="text-sm font-semibold leading-6 text-white">Product</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/docs/actors/">Actors</a></li></ul></div><div><div class="text-sm font-semibold leading-6 text-white">Developers</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/docs/actors/">Documentation</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/changelog/">Changelog</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="https://rivet.betteruptime.com/">Status Page</a></li></ul></div><div><div class="text-sm font-semibold leading-6 text-white">Resources</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/blog/"><span class="">Blog</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/rivet-vs-cloudflare-workers/"><span class="">Rivet vs Cloudflare Workers</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/pricing/"><span class="">Pricing</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/talk-to-an-engineer/"><span class="">Talk to an engineer</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/sales/"><span class="">Sales</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/oss-friends/"><span class="">Open-Source Friends</span></a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="https://releases.rivet.gg/press-kit.zip"><span class="">Press Kit</span></a></li></ul></div><div><div class="text-sm font-semibold leading-6 text-white">Legal</div><ul role="list" class="mt-3 space-y-2"><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/terms/">Terms</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/privacy/">Privacy Policy</a></li><li><a class="text-sm leading-4 text-gray-300 hover:text-white" href="/acceptable-use/">Acceptable Use</a></li></ul></div></div></div><div class="mt-4 border-t border-white/10 pt-4 text-center md:mt-8"><p class="text-xs leading-5 text-white">© <!-- -->2025<!-- --> Rivet Gaming, Inc. All rights reserved.</p><p class="text-xs leading-5 text-white/30">Cloudflare® and Durable Objects™ are trademarks of Cloudflare, Inc. No affiliation or endorsement implied. References used for comparison purposes only.</p></div></div></footer></div><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--><section aria-label="Notifications alt+T" tabindex="-1" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></section><script src="/_next/static/chunks/webpack-1a373ad8fd0a15c2.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[65327,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"3285\",\"static/chunks/3285-d8e61078321bd50f.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"7177\",\"static/chunks/app/layout-e3cfc449b871f8f6.js\"],\"GoogleAnalytics\"]\n3:I[559,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"3285\",\"static/chunks/3285-d8e61078321bd50f.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"7177\",\"static/chunks/app/layout-e3cfc449b871f8f6.js\"],\"\"]\n4:I[32761,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"TooltipProvider\"]\n5:I[79838,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"3285\",\"static/chunks/3285-d8e61078321bd50f.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1"])</script><script>self.__next_f.push([1,"983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"7177\",\"static/chunks/app/layout-e3cfc449b871f8f6.js\"],\"Providers\"]\n6:I[49287,[],\"\"]\n7:I[34235,[],\"\"]\n8:I[91971,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Toaster\"]\n9:I[82345,[\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"3591\",\"static/chunks/3591-193e430a542376f5.js\",\"4395\",\"static/chunks/4395-09a8f40ef66f9d5c.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7261\",\"static/chunks/7261-eddb3e7984c54a8d.js\",\"4\",\"static/chunks/app/(v2)/(blog)/changelog/layout-b36961b4d0c22716.js\"],\"Header\"]\na:I[59534,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"\"]\nb:\"$Sreact.suspense\"\nc:I[82813,[\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"5519\",\"static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js\"],\"EmbedDetector\"]\nd:I[53696,[\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9"])</script><script>self.__next_f.push([1,"657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"3459\",\"static/chunks/3459-aa0b1d8277b7bbbd.js\",\"5519\",\"static/chunks/app/(v2)/layout-24f9ee0b53a6742c.js\"],\"Footer\"]\nf:I[93621,[],\"MetadataBoundary\"]\n11:I[93621,[],\"OutletBoundary\"]\n14:I[16867,[],\"AsyncMetadataOutlet\"]\n16:I[93621,[],\"ViewportBoundary\"]\n18:I[27890,[],\"\"]\n:HL[\"/_next/static/css/565f4925fe90494c.css\",\"style\"]\n:HL[\"/_next/static/css/b2a053553e69c47d.css\",\"style\"]\n:HL[\"/_next/static/css/9ded352fd1582faa.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"xyrr8R3WCFgaolPiXJ-Nn\",\"p\":\"\",\"c\":[\"\",\"changelog\",\"2025-03-23-what-would-a-w3c-standard-look-like-for-stateful-serverless-\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"(v2)\",{\"children\":[\"(blog)\",{\"children\":[\"changelog\",{\"children\":[[\"slug\",\"2025-03-23-what-would-a-w3c-standard-look-like-for-stateful-serverless-\",\"c\"],{\"children\":[\"__PAGE__\",{}]}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/565f4925fe90494c.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"className\":\"dark\",\"children\":[[\"$\",\"head\",null,{\"children\":[[\"$\",\"$L2\",null,{\"gaId\":\"G-GHX1328ZFD\"}],[\"$\",\"$L3\",null,{\"src\":\"https://analytics.ahrefs.com/analytics.js\",\"data-key\":\"wQAsHie9RgJMLNhmUbr/fQ\",\"strategy\":\"beforeInteractive\"}],[\"$\",\"link\",null,{\"rel\":\"apple-touch-icon\",\"sizes\":\"180x180\",\"href\":\"/icons/apple-touch-icon.png?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"32x32\",\"href\":\"/icons/favicon-32x32.png?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"icon\",\"type\":\"image/png\",\"sizes\":\"16x16\",\"href\":\"/icons/favicon-16x16.png?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"manifest\",\"href\":\"/icons/site.webmanifest?20240925\"}],[\"$\",\"link\",null,{\"rel\":\"mask-icon\",\"href\":\"/icons/safari-pinned-tab.svg?20240925\",\"color\":\"#5bbad5\"}],[\"$\",\"meta\",null,{\"name\":\"msapplication-TileColor\",\"content\":\"#0c0a09\"}],[\"$\",\"meta\",null,{\"name\":\"theme-color\",\"content\":\"#0c0a09\"}],[\"$\",\"meta\",null,{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1.0\"}]]}],[\"$\",\"body\",null,{\"className\":\"dark\",\"children\":[[\"$\",\"$L4\",null,{\"children\":[\"$\",\"$L5\",null,{\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}],[\"$\",\"$L8\",null,{\"theme\":\"system\",\"className\":\"toaster group right-8\",\"toastOptions\":{\"classNames\":{\"toast\":\"group toast group-[.toaster]:bg-card group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg group-[.toaster]:border group-[.toaster]:rounded-md\",\"description\":\"group-[.toast]:text-muted-foreground\",\"actionButton\":\"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\"cancelButton\":\"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\"}}}]]}]]}]]}],{\"children\":[\"(v2)\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/b2a053553e69c47d.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/9ded352fd1582faa.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"$L9\",null,{\"variant\":\"floating\"}],[\"$\",\"div\",null,{\"className\":\"relative flex min-h-[80vh] w-full items-center justify-center text-center\",\"children\":[\"$\",\"div\",null,{\"className\":\"transition-opacity\",\"children\":[[\"$\",\"h1\",null,{\"className\":\"mb-3 flex items-center justify-center text-3xl text-white\",\"children\":[[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"block-question\",\"className\":\"svg-inline--fa fa-block-question mr-2 size-10\",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l320 0c35.3 0 64-28.7 64-64l0-320c0-35.3-28.7-64-64-64L64 32zm73.8 149.3c7.9-22.3 29.1-37.3 52.8-37.3l58.3 0c34.9 0 63.1 28.3 63.1 63.1c0 22.6-12.1 43.5-31.7 54.8L248 280.4c-.2 13-10.9 23.6-24 23.6c-13.3 0-24-10.7-24-24l0-13.5c0-8.6 4.6-16.5 12.1-20.8l44.3-25.4c4.7-2.7 7.6-7.7 7.6-13.1c0-8.4-6.8-15.1-15.1-15.1l-58.3 0c-3.4 0-6.4 2.1-7.5 5.3l-.4 1.2c-4.4 12.5-18.2 19-30.6 14.6s-19-18.2-14.6-30.6l.4-1.2zM192 368a32 32 0 1 1 64 0 32 32 0 1 1 -64 0zM48 104a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zM376 80a24 24 0 1 1 0 48 24 24 0 1 1 0-48zM48 408a24 24 0 1 1 48 0 24 24 0 1 1 -48 0zm328-24a24 24 0 1 1 0 48 24 24 0 1 1 0-48z\",\"style\":{}}]}],\" \",\"Not Found\"]}],[\"$\",\"$La\",null,{\"aria-selected\":false,\"className\":\"relative inline-flex items-center justify-center gap-0.5 overflow-hidden font-semibold transition inline-flex items-center justify-center gap-0.5 rounded-sm px-3 py-1 text-sm font-semibold bg-transparent text-cream-100 border-2 border-cream-100 hover:bg-cream-100 hover:text-charcole-950\",\"href\":\"/\",\"children\":[null,false,\"Home\",false]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}],[\"$\",\"$b\",null,{\"children\":[\"$\",\"$Lc\",null,{}]}],[\"$\",\"$Ld\",null,{}]]]}],{\"children\":[\"(blog)\",[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"changelog\",[\"$\",\"$1\",\"c\",{\"children\":[null,[[\"$\",\"$L9\",null,{\"active\":\"blog\",\"variant\":\"floating\"}],[\"$\",\"div\",null,{\"className\":\"mx-auto mt-20 w-full max-w-6xl px-8 md:mt-32\",\"style\":{\"--header-height\":\"5rem\"},\"children\":[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]]}],{\"children\":[[\"slug\",\"2025-03-23-what-would-a-w3c-standard-look-like-for-stateful-serverless-\",\"c\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L6\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L7\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$Le\",[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}],null,[\"$\",\"$L11\",null,{\"children\":[\"$L12\",\"$L13\",[\"$\",\"$L14\",null,{\"promise\":\"$@15\"}]]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"M0GKMNXEsnkiuO46kL4X8\",{\"children\":[[\"$\",\"$L16\",null,{\"children\":\"$L17\"}],null]}],null]}],false]],\"m\":\"$undefined\",\"G\":[\"$18\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"19:I[16867,[],\"AsyncMetadata\"]\n10:[\"$\",\"$b\",null,{\"fallback\":null,\"children\":[\"$\",\"$L19\",null,{\"promise\":\"$@1a\"}]}]\n"])</script><script>self.__next_f.push([1,"13:null\n"])</script><script>self.__next_f.push([1,"1b:I[1143,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Avatar\"]\n1c:I[1143,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"AvatarFallback\"]\n1d:I[1143,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"AvatarImage\"]\n1f:I[63571,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea270"])</script><script>self.__next_f.push([1,"1538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Image\"]\n20:I[75036,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Heading\"]\n21:I[32761,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"WithTooltip\"]\n22:I[30860,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"CopyCodeTrigger\"]\n23:I[63843,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8"])</script><script>self.__next_f.push([1,"f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"ScrollArea\"]\n2a:I[48652,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"Tabs\"]\n2b:I[48652,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"TabsList\"]\n2c:I[48652,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"TabsTrigger\"]\n2d:I[48652,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937"])</script><script>self.__next_f.push([1,"f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"9595\",\"static/chunks/app/(v2)/(blog)/changelog/page-cc79e427778bad90.js\"],\"TabsContent\"]\n46:I[49720,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"3733\",\"static/chunks/3733-74f52baf8b8f8b32.js\",\"481\",\"static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js\"],\"ArticleSocials\"]\n47:I[9777,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"3733\",\"static/chunks/3733-74f52baf8b8f8b32.js\",\"481\",\"static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js\"],\"DocsTableOfContents\"]\n48:I[19897,[\"1965\",\"static/chunks/f67032f2-9c72234b0d8f41b4.js\",\"8229\",\"static/chunks/9da6db1e-dbfab9261a7c6a02.js\",\"7134\",\"static/chunks/7134-7a2ccc87dc1f1c96.js\",\"9078\",\"static/chunks/9078-9c4b2ff48765f274.js\",\"6855\",\"static/chunks/6855-c97c866fb9680afe.js\",\"5051\",\"static/chunks/5051-51ff92d736937f41.js\",\"9657\",\"static/chunks/9657-90d7d8e86cd8d7b3.js\",\"1983\",\"static/chunks/1983-7439545cf8f39348.js\",\"7678\",\"static/chunks/7678-80db3db210142fa"])</script><script>self.__next_f.push([1,"5.js\",\"3545\",\"static/chunks/3545-9e4a648ea2701538.js\",\"3733\",\"static/chunks/3733-74f52baf8b8f8b32.js\",\"481\",\"static/chunks/app/(v2)/(blog)/changelog/%5B...slug%5D/page-087a478b9ec8c695.js\"],\"Comments\"]\n24:T10bf,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Once created, this DurableObject will exist indefinitely\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e class\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Counter\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e extends\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e DurableObject\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  count\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e number\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  constructor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    super\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(state\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e env)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esetup\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e setup\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e state\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estorage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  increment\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e number\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Update state\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Persist state\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    await\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estorage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"25:Te5d,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e class\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Counter\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e extends\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e DurableObject\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  constructor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    super\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(state\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e env)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esetup\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e setup\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e state\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estorage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  increment\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e number\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    await\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estorage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"26:T1494,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { ActorContext } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"@rivet-gg/actor\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e *\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e as\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e http \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"http\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e start\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e ActorContext\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    let\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ekv\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e server \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e http\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ecreateServer\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e((\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ereq\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e res\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ekv\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      res\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ewriteHead\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e200\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Content-Type\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"text/plain\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      res\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`Count: \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecount\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elisten\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(process\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eenv\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ePORT_HTTP)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Keep the actor running until explicitly destroyed\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    await\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e((\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eresolve\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {})\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"27:Te50,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { actor } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"@rivetkit/actor\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e chatRoom \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e actor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  state\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { messages\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [] }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  actions\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // receive an action call from the client\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e    sendMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e username\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e message\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // save message to persistent storage\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      c\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emessages\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ username\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e message })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // broadcast message to all clients\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      c\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ebroadcast\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"newMessage\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e username\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e message)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // allow client to request message history\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e    getMessages\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ec\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e c\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emessages\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e})\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"28:T1529,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e ActorDriver\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tkvGet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvKey\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eKvValue\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e undefined\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tkvGetBatch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvKey\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e[])\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;(\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eKvValue\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e undefined\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)[]\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tkvPut\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvKey\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvValue\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tkvPutBatch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eKvKey\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvValue\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e][])\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tkvDelete\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvKey\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tkvDeleteBatch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e KvKey\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e[])\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tsetAlarm\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eactor\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e AnyActorInstance\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e timestamp\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e number\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003evoid\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"29:T1fb2,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e ManagerDriver\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tgetForId\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003einput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e GetForIdInput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eGetActorOutput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e undefined\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tgetWithTags\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003einput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e GetWithTagsInput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eGetActorOutput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e |\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e undefined\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tcreateActor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003einput\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e CreateActorInput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eCreateActorOutput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e GetForIdInput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e extends\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e any\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tc\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e HonoContext\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tbaseUrl\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tactorId\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e GetWithTagsInput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e extends\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e any\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tc\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e HonoContext\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tbaseUrl\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\ttags\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e ActorTags\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e GetActorOutput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e extends\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e any\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tc\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e HonoContext\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tendpoint\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\ttags\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e ActorTags\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e CreateActorInput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e extends\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e any\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tc\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e HonoContext\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eE\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tbaseUrl\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\ttags\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e ActorTags\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tregion\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e?:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e interface\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e CreateActorOutput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\tendpoint\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e string\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"2e:Te31,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// main.js - Browser\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Worker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'worker.js'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003eworker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'INCREMENT'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 5\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003eworker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Counter:'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// worker.js - Worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e counter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003eself\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (type \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'INCREMENT'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    counter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    self\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(counter)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"2f:T1cc9,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// server.js - Fetch handler\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e id \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eCOUNTER\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eidFromName\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'counter-1'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e stub \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eCOUNTER\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(id)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e stub\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003efetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'https://counter'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  method\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'POST'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  body\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'INCREMENT'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 5\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e})\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e counter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e response\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003econsole\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Counter:'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e counter)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// counter.js - Durable Object\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e class\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003e Counter\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  constructor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estate \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e state\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e    this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecounter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e fetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (type \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'INCREMENT'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e      this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecounter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      await\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estorage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'counter'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003e this\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecounter)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#39BAE6;font-style:italic\"\u003ethis\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecounter))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Invalid request'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 400\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"30:T1199,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// client.js - Client side\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { createClient } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e '@rivetkit/actor'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e createClient\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e counter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ecounter\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'counter-1'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e result \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e counter\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eincrement\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e5\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003econsole\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Counter:'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e result)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// counter.js - Actor definition\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eimport\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { actor } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003efrom\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e '@rivetkit/actor'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e counter \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e actor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  state\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  actions\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e    increment\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ectx\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      ctx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003evalue \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ctx\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003estate\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003evalue\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e})\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"31:T536,\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e createClient\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#59C2FF\"\u003eApp\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"http://localhost:6420\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e randomChannel \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003echatRoom\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ organization\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"rivet\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e channel\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"random\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e32:T57b,\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e id \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eMY_DURABLE_OBJECT\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eidFromName\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"channel:rivet:random\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e"])</script><script>self.__next_f.push([1," stub \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eMY_DURABLE_OBJECT\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(id)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eawait\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e stub\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003efetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e...\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e33:T433,\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tfetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ereq\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./worker.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e34:T578,\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan clas"])</script><script>self.__next_f.push([1,"s=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tfetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ereq\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./worker.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e `chat-room-\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003erandom\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e\t\t// ...\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e35:T968,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e sharedWorker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e SharedWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'sharedWorker.js'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003esharedWorker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ action\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'greet'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'Hello from Tab'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003esharedWorker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Received response from SharedWorker:'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003esharedWorker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estart\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"36:Ta83,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003eonconnect\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { action\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (action \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'greet'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e `SharedWorker received: \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"37:T793,\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tfetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003econn\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e workerId \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e createServerlessWorkerId\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./worker.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e workerId)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tconn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ action\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'greet'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'foo'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e38:Tca6,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\tconnect\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003econn\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e conn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\t\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { action\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\t\t\tif\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (action \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'greet'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\t\tconn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e `Stateful serverless received: \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\t}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonclose\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Conn disconnected'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"39:Ta50,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  connect\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003econn\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e\tconst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e conn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e async\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3a:T57f,\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Set an alarm for 1 day\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003esetAlarm\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(Date\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003enow\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 86_400\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e *\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1000\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e\talarm\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t\tconsole\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"It's been 1 day\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e\t}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e3b:T241f,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// 10 requests/minute\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e maxRequests \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 10\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e bucketDuration \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 60_000\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Load state from storage\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e resetAt \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"resetAt\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (Date\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003enow\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e bucketDuration)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e saveState\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"count\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"resetAt\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e resetAt)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  connect\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003econn\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e conn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e ...\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Check if bucket should be reset\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e now \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e Date\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003enow\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (now \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e resetAt) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        resetAt \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e now \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e bucketDuration\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e        saveState\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      switch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (type) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e        // Check if within rate limit\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        case\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"HIT\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e          // Update limit\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e isAllowed \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e maxRequests\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (isAllowed) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e            saveState\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          conn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ isAllowed })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          break\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e        // Reset rate limit (unused, purely for example)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        case\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"RESET\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          count \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          resetAt \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e now \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e+\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e bucketDuration\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e          saveState\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          break\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3c:T1c8f,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e fetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e env\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e url \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e URL\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eurl)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Get client IP\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e forwardedFor \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eheaders\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'x-forwarded-for'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e||\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e '127.0.0.1'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e clientIp \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e forwardedFor\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esplit\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e','\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003etrim\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Create a rate limiter for this IP\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e limiterId \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e `rate-limit:\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eip\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./rateLimiter.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e limiterId)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Handle response\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e resolve\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e reject } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ewithResolvers\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    worker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { isAllowed } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (isAllowed) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e        // Request is allowed - continue to handle the actual request\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e        resolve\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Request allowed\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003eelse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e        // Request is rate limited\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e        resolve\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Rate limit exceeded\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 429\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Send the rate limit check\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    worker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"HIT\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3d:T128b,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// A set of all connected clients\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e subscribers \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Set\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  connect\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    subscribers\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eadd\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(port)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (type \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"publish\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e        // Broadcast to all subscribers\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        for\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003eof\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e subscribers) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          client\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"message\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            data\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Remove on disconnect\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonclose\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e () \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      subscribers\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003edelete\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(port)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3e:T2560,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e fetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e url \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e URL\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eurl)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [_\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e topic] \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e url\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003epathname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esplit\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'/'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etopic) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Specify a topic in the URL path\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Each topic gets its own worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./topicWorker.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e `topic-\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etopic\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Handle WebSocket upgrade\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eheaders\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Upgrade\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"websocket\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e pair \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e WebSocketPair\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e pair[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e server \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e pair[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Connect to worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Client -\u003e Worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        try\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eparse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ecatch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (err) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ error\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"Invalid JSON\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Worker -\u003e Client\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eaccept\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003enull\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 101\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        webSocket\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Expected WebSocket\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"3f:Tef6,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Subscribe to a topic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ws \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e WebSocket\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"wss://pubsub.example.com/news\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Handle incoming messages\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003ews\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eparse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (type \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"message\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"New message:\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Publish a message to the topic\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e publish\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  ws\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"publish\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    data\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Example usage\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003epublish\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Breaking news!\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"40:T2990,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Keep track of all connections to this chat room\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e connections \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Set\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Keep messages in memory\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003elet\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e messages \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"messages\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e??\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e []\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Broadcast a message to all connected clients\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e broadcast\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003emessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  for\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e conn \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003eof\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e connections) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    conn\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(message)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  connect\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    connections\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eadd\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(port)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Send message history to new client\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (messages\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003elength \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e\u003e\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"history\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        messages\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e messages\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eslice\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e-\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e20\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e async\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { text\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e username } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Create message object\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e message \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        text\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        username\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        timestamp\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e Date\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003enow\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Store message\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      messages\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epush\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(message)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Save periodically \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (messages\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003elength \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e%\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 10\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e ===\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"messages\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e messages)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Broadcast to all clients\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e      broadcast\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        type\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"message\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        message\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Handle client disconnection\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonclose\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e () \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      connections\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003edelete\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(port)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // If this was the last connection, save messages\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (connections\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003esize \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e        waitUntil\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"messages\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e messages))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"41:T2b38,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e fetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e url \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e URL\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eurl)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Get chat room name from URL\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e [_\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e roomId] \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e url\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003epathname\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esplit\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'/'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eroomId) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Please specify a room ID in the URL path\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 400\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Get or create a worker for this room\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./chatRoom.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e `chat-\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eroomId\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Handle websocket upgrade\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eheaders\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Upgrade'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e!==\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e 'websocket'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e'Expected websocket'\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 426\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Create a WebSocket pair\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e pair \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e WebSocketPair\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e pair[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e server \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e pair[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e1\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Connect client and worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Client -\u003e Worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      try\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eparse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003ecatch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (err) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({ error\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"Invalid JSON\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Worker -\u003e Client\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Handle WebSocket close\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonclose\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e () \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eclose\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    server\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eaccept\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003enull\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 101\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      webSocket\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e client\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"42:T1d99,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Connect to a chat room\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e username \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"user\"\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e +\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e Math\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003efloor\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(Math\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003erandom\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e*\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 1000\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003econst\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e ws \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e WebSocket\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"wss://chat.example.com/room123\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Handle incoming messages\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003ews\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e data \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eparse\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (data\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etype \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"message\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eusername\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  } \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003eelse\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (data\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etype \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"history\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"--- Message History ---\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    data\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emessages\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eforEach\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003emsg\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e =\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emsg\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eusername\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e: \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emsg\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"---------------------\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Send a chat message\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003efunction\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e sendMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003etext\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  ws\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003esend\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e({\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    text\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    username\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Example usage\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003ews\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonopen\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e () \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  sendMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Hello everyone!\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"43:T2963,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e  connect\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eports[\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e0\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e]\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e async\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { command\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      let\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Handle different Redis-like commands - directly using storage API\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      switch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (command) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        case\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"GET\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storedValue \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`key:\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"success\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storedValue \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e!==\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e undefined\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e ?\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storedValue \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e null\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          break\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        case\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"SET\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eput\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`key:\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"success\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          break\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        case\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"DEL\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e exists \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eget\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`key:\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e!==\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e undefined\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (exists) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e            await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e storage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003edelete\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`key:\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003ekey\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e`\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"success\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            deleted\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e exists\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          break\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        case\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"KEYS\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e          // For a real implementation, this would need support from the platform\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e          // to list keys with a specific prefix or pattern\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"error\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            message\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"KEYS command not supported in this simplified implementation\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e          break\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e        default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e:\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"error\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e            message\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"Unknown command\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(response)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"44:T1c81,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003eexport\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e default\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  async\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e fetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003erequest\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e url \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e URL\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eurl)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Create or access the Redis worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // We use a single worker for the entire Redis server\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e ServerlessWorker\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"./redisWorker.js\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"redis-server\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e port \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e worker\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003eport\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e    // Handle POST requests for Redis commands\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003emethod \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e===\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"POST\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Parse the command from the request body\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e command \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e request\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Create a Promise that will be resolved with the response\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e resolve } \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#39BAE6\"\u003e Promise\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ewithResolvers\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Set up message handler\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003eonmessage\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003eevent\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) \u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e=\u003e\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003e        resolve\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003enew\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(event\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edata)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e          headers\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Content-Type\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"application/json\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e        }))\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Send the command to the worker\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      port\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003epostMessage\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(command)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e      // Wait for the response\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e      return\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e promise\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e    return\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e new\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e Response\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Invalid method\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      status\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e 400\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e      headers\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Content-Type\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"text/plain\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"45:T2018,"])</script><script>self.__next_f.push([1,"\u003cpre class=\"shiki ayu-dark\" style=\"background-color:#0c0a09;color:#bfbdb6\" tabindex=\"0\"\u003e\u003ccode\u003e\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Redis client example\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Function to send a command to the Redis server\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003easync\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e redisCommand\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003ecommand\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e key\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e =\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e null\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e payload \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { command\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e key }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  if\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e (value \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e!==\u003c/span\u003e\u003cspan style=\"color:#D2A6FF\"\u003e null\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e) {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    payload\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003evalue \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e value\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  }\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e response \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e fetch\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"https://redis.example.com\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    method\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"POST\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    headers\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e { \u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Content-Type\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"application/json\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e }\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e    body\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e:\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e JSON\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003estringify\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(payload)\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  })\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  return\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e response\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003ejson\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e// Example usage\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003easync\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e function\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e example\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e() {\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e  // Set a value\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  await\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e redisCommand\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"SET\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"greeting\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"Hello, ServerlessWorker!\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Set greeting key\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e  // Get the value\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e result \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e redisCommand\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"GET\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"greeting\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Get greeting:\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e result\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003evalue)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e  // Delete the key\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e deleted \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e redisCommand\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"DEL\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"greeting\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"Deleted greeting:\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e deleted\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003edeleted)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  \u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#ACB6BF8C;font-style:italic\"\u003e  // Verify it's gone\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FF8F40\"\u003e  const\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e afterDelete \u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e=\u003c/span\u003e\u003cspan style=\"color:#FF8F40\"\u003e await\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003e redisCommand\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"GET\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e \"greeting\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e  console\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#FFB454\"\u003elog\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e(\u003c/span\u003e\u003cspan style=\"color:#AAD94C\"\u003e\"After delete:\"\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e,\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e afterDelete\u003c/span\u003e\u003cspan style=\"color:#F29668\"\u003e.\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003evalue)\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#BFBDB6\"\u003e}\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003cspan style=\"color:#FFB454\"\u003eexample\u003c/span\u003e\u003cspan style=\"color:#BFBDB6\"\u003e()\u003c/span\u003e\u003cspan style=\"color:#BFBDB6B3\"\u003e;\u003c/span\u003e\u003c/span\u003e\n\u003cspan class=\"line\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"ul\",null,{\"className\":\"text-muted-foreground my-4 flex flex-wrap items-center gap-2 text-xs\",\"children\":[[\"$\",\"li\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog\",\"children\":\"Changelog\"}]}],[\"$\",\"li\",null,{\"className\":\"h-2.5\",\"children\":[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"chevron-right\",\"className\":\"svg-inline--fa fa-chevron-right block h-full w-auto\",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 320 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M310.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L242.7 256 73.4 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z\",\"style\":{}}]}]}],[\"$\",\"li\",null,{\"className\":\"text-foreground font-semibold\",\"children\":\"Considering A W3C Standard For Stateful Serverless\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col gap-4 pb-6 lg:flex-row\",\"children\":[[\"$\",\"aside\",null,{\"className\":\"order-1 mt-2 flex min-w-0 max-w-xs flex-1 flex-col gap-2\",\"children\":[\"$\",\"div\",null,{\"className\":\"top-header sticky pt-2\",\"children\":[[\"$\",\"p\",null,{\"className\":\"mb-2 text-sm font-semibold\",\"children\":\"Posted by\"}],[\"$\",\"div\",null,{\"className\":\"mb-4 flex items-center gap-2\",\"children\":[[\"$\",\"$L1b\",null,{\"children\":[[\"$\",\"$L1c\",null,{\"children\":\"$undefined\"}],[\"$\",\"$L1d\",null,{\"src\":\"/_next/static/media/avatar.7191d056.jpeg\",\"height\":1516,\"width\":1516,\"blurDataURL\":\"data:image/jpeg;base64,/9j/2wBDAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/2wBDAQoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAb/xAAVAQEBAAAAAAAAAAAAAAAAAAAEBf/aAAwDAQACEAMQAAAApxJX/8QAHBAAAgICAwAAAAAAAAAAAAAAAQIDEgAEBREj/9oACAEBAAE/AIG3H5iX2rpIoRIq1UmvbHP/xAAXEQADAQAAAAAAAAAAAAAAAAAAAhNh/9oACAECAQE/AKNh/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAIBIXH/2gAIAQMBAT8AlFrD/9k=\",\"blurWidth\":8,\"blurHeight\":8,\"alt\":\"Nathan Flurry\"}]]}],[\"$\",\"div\",null,{\"className\":\"flex flex-col\",\"children\":[[\"$\",\"h3\",null,{\"className\":\"font-bold\",\"children\":\"Nathan Flurry\"}],[\"$\",\"p\",null,{\"className\":\"text-muted-foreground text-sm\",\"children\":\"Co-founder \u0026 CTO\"}]]}]]}],[\"$\",\"div\",null,{\"className\":\"text-muted-foreground mb-6 flex items-center gap-2 text-sm\",\"children\":[[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"calendar-day\",\"className\":\"svg-inline--fa fa-calendar-day \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M128 0c17.7 0 32 14.3 32 32l0 32 128 0 0-32c0-17.7 14.3-32 32-32s32 14.3 32 32l0 32 48 0c26.5 0 48 21.5 48 48l0 48L0 160l0-48C0 85.5 21.5 64 48 64l48 0 0-32c0-17.7 14.3-32 32-32zM0 192l448 0 0 272c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 192zm80 64c-8.8 0-16 7.2-16 16l0 96c0 8.8 7.2 16 16 16l96 0c8.8 0 16-7.2 16-16l0-96c0-8.8-7.2-16-16-16l-96 0z\",\"style\":{}}]}],[\"$\",\"time\",null,{\"className\":\"text-sm\",\"children\":\"March 23, 2025\"}]]}],[\"$\",\"p\",null,{\"className\":\"mb-2 hidden text-sm font-semibold lg:block\",\"children\":\"Other entries\"}],\"$L1e\"]}]}],[\"$\",\"article\",null,{\"className\":\"order-3 mt-4 w-full max-w-prose flex-shrink-0 lg:order-2 prose-invert prose\",\"children\":[[\"$\",\"$L1f\",null,{\"src\":\"/_next/static/media/image.00c62794.png\",\"height\":1024,\"width\":2048,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAAElBMVEUREREaFBMkISEbHBw4OTpJSUl/57+ZAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAH0lEQVR4nGNgYmRkAANmFhYmBmYmRgYmVlZmRhADBgADnwAuL6FfMQAAAABJRU5ErkJggg==\",\"blurWidth\":8,\"blurHeight\":4,\"alt\":\"Promo Image\",\"className\":\"rounded-sm border\"}],[[\"$\",\"h1\",null,{\"children\":\"Considering A W3C Standard For Stateful Serverless\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"We're Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivet\",\"target\":\"_blank\",\"children\":\"give us a star on GitHub\"}],\".\"]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Earlier today, I was \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/janwilmake/status/1903580372920590667\",\"target\":\"_blank\",\"children\":\"called upon\"}],\" by Cloudflare's \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/threepointone\",\"target\":\"_blank\",\"children\":\"@threepointone\"}],\" and \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/janwilmake\",\"target\":\"_blank\",\"children\":\"@janwilmake\"}],\" regarding my thoughts on a standard for stateful serverless.\"]}],\"\\n\",[\"$\",\"$La\",null,{\"href\":\"https://x.com/janwilmake/status/1903580372920590667\",\"target\":\"_blank\",\"children\":[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/tweet.5d715dca.png\",\"height\":2264,\"width\":2388,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAACVBMVEUEBQUTFBQjIh31scrwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAJklEQVR4nD2KQQ4AIAyDKP9/tLFuciElxXAJlq6XVvI/mYSmwPgABmYALJjpHYIAAAAASUVORK5CYII=\",\"blurWidth\":8,\"blurHeight\":8},\"alt\":\"threepointone tweet\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Having implemented a cloud-agnostic stateful serverless library called \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit\",\"target\":\"_blank\",\"children\":\"RivetKit\"}],\", I have a lot of experience with what's required to build a portable standard. And thus, I derailed my Saturday to write them down here.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This specification is intended as step 1 to start the conversation about what is required to develop a stateful serverless specification that makes stateful serverless easier for companies to adopt. I don't expect this to be the end result. See \",[\"$\",\"em\",null,{\"children\":\"Specification Goals\"}],\" for more information.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"what-is-stateful-serverless\",\"children\":\"What Is Stateful Serverless?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Unless you're deep in to \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/\",\"target\":\"_blank\",\"children\":\"Cloudflare Durable Objects\"}],\" or \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/actors\",\"target\":\"_blank\",\"children\":\"Rivet Actors\"}],\", there's a good chance you've never heard of \\\"stateful serverless.\\\"\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Stateful serverless\"}],\" allows serverless functions to maintain state across multiple invocations. They're very similar to \",[\"$\",\"strong\",null,{\"children\":[\"Web Workers (specifically \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\") on the server\"]}],\" and share characteristics with the \",[\"$\",\"strong\",null,{\"children\":\"actor model\"}],\". The most popular implementation of this today is \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/\",\"target\":\"_blank\",\"children\":\"Durable Objects\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The adoption of stateful serverless is fairly new: Durable Objects was announced \",[\"$\",\"$La\",null,{\"href\":\"https://blog.cloudflare.com/introducing-workers-durable-objects/\",\"target\":\"_blank\",\"children\":\"4.5 years ago\"}],\" and only recently saw widespread use over the past couple years.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"stateless-serverless-functions-vs-stateful-serverless-workers\",\"children\":\"Stateless Serverless (Functions) vs Stateful Serverless (Workers)\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Stateless serverless\"}],\" is what you'd normally think of when you hear \",[\"$\",\"strong\",null,{\"children\":\"\\\"serverless functions.\\\"\"}],\" An example implementation on Cloudflare Workers would look like this:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cpre class=\\\"shiki ayu-dark\\\" style=\\\"background-color:#0c0a09;color:#bfbdb6\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003eexport\u003c/span\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003e default\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003e  fetch\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#D2A6FF\\\"\u003erequest\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6B3\\\"\u003e,\u003c/span\u003e\u003cspan style=\\\"color:#D2A6FF\\\"\u003e env\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003e    return\u003c/span\u003e\u003cspan style=\\\"color:#F29668\\\"\u003e new\u003c/span\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003e Response\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#AAD94C\\\"\u003e'Hello World!'\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e)\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6B3\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e  }\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"On the other hand, \",[\"$\",\"strong\",null,{\"children\":\"stateful serverless provides an infinitely running process with storage\"}],\". An example implementation on Rivet Actors would look like this:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$24\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"primary-use-cases\",\"children\":\"Primary Use Cases\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The primary use cases of stateful serverless are:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Long-Running Processes\"}],\": Tasks that execute over extended periods or in multiple steps. For example, \",[\"$\",\"strong\",null,{\"children\":\"AI Agents\"}],\" with ongoing conversations and stateful tool calls.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Stateful Services\"}],\": Applications where maintaining state across interactions is critical. For example, \",[\"$\",\"strong\",null,{\"children\":\"Collaborative Apps\"}],\" with shared editing and automatic persistence.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Realtime Systems\"}],\": Applications requiring fast, in-memory state modifications or push updates to connected clients. For example, \",[\"$\",\"strong\",null,{\"children\":\"Multiplayer Games\"}],\" with game rooms and player state.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Durability\"}],\": Processes that must survive crashes and restarts without data loss. For example, \",[\"$\",\"strong\",null,{\"children\":\"Durable Execution\"}],\" workflows that continue after system restarts.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Horizontal Scalability\"}],\": Systems that need to scale by distributing load across many instances. For example, \",[\"$\",\"strong\",null,{\"children\":\"Realtime Stream Processing\"}],\" for stateful event handling.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Local-First Architecture\"}],\": Systems that synchronize state between offline clients. For example, \",[\"$\",\"strong\",null,{\"children\":\"Local-First Sync\"}],\" between devices.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Read more about stateful serverless \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit\",\"target\":\"_blank\",\"children\":\"here\"}],\".\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"scope-of-this-proposal\",\"children\":\"Scope Of This Proposal\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For the purpose of this article, we'll assume \",[\"$\",\"strong\",null,{\"children\":\"stateful serverless includes message passing \u0026 persistent storage\"}],\". This means we're not going to consider actor runtimes, such as Erlang/OTP, Akka, Orleans, Actix, and Swift Actors which do not include storage as a core component.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"why-should-i-care\",\"children\":\"Why Should I Care?\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Even if you've never heard of stateful serverless, you're probably using a site on a daily basis that already relies on stateful serverless with technologies like Cloudflare Durable Objects:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"CodePen\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Liveblocks\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Clerk\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Wordware\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Playroom\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Tldraw\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Similarly, a significant portion of applications in general are powered by services with the actor pattern, which is a subset of what this standard would provide:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"WhatsApp (notoriously acquired for $19B with Erlang/OTP having only 35 engineers)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Discord\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"LinkedIn\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Twitter/X\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Pinterest\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"PayPal\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Halo\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"FoundationDB (powering Apple, Snowflake, DataDog)\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Many, many more\"}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"why-build-a-web-standard\",\"children\":\"Why Build A Web Standard?\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"customers-wary-of-vendor-lock\",\"children\":\"Customers Wary Of Vendor-Lock\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In 2025, customers are \",[\"$\",\"strong\",null,{\"children\":\"wary of vendor-locking themselves to cloud services\"}],\". It's common for vendor-locked providers to either shut down, turn out to be unreliable, or price gouge contracts because their customers cannot leave.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Therefore, a standard allows all platforms offering stateful serverless to become a compelling offering. It's a rising tide: more competition means wider adoption and more customers.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For example: though AWS is the leading cloud provider and pushes their own closed-source \u0026 non-standard software like DynamoDB \u0026 Lambda, \",[\"$\",\"strong\",null,{\"children\":\"they still need to provide standard- and open-source-compatible software\"}],\" like Redis (ElastiCache), Cassandra (Keyspace), and Postgres/MySQL (Aurora) in order to remain an attractive offering for customers concerned about vendor lock.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"incentivize-more-providers\",\"children\":\"Incentivize More Providers\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"A standard would incentivize more cloud providers to enter the stateful serverless space.\"}],\" Currently, only Cloudflare, Rivet, and RivetKit offer this capability, leaving a massive opportunity for other serverless cloud providers to adopt stateful serverless. With a common standard, more frameworks \u0026 developers can adopt this model.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"todays-stateful-serverless-implementations\",\"children\":\"Today's Stateful Serverless Implementations\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"cloudflare-durable-objects-the-most-popular-option\",\"children\":\"Cloudflare Durable Objects: The Most Popular Option\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Today, \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/\",\"children\":\"Cloudflare Durable Objects\"}],\" are the incumbent of stateful serverless cloud providers.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A Durable Object looks something like this:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$25\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"cloudflare-agents-framework-moving-beyond-durable-objects\",\"children\":\"Cloudflare Agents Framework: Moving Beyond Durable Objects\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/agents/\",\"children\":\"Cloudflare Agents\"}],\" framework is for AI-powered agents to operate on the Durable Objects infrastructure.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"As stated in their \",[\"$\",\"$La\",null,{\"href\":\"https://blog.cloudflare.com/build-ai-agents-on-cloudflare/\",\"children\":\"launch blog post\"}],\":\"]}],\"\\n\",[\"$\",\"blockquote\",null,{\"children\":[\"\\n\",[\"$\",\"p\",null,{\"children\":\"Over the coming weeks, expect to see ... the ability to self-host agents on your own infrastructure.\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Purely theorizing: a standard for stateful serverless might provide the foundation for this.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"rivet-open-source-serverless-infrastructure\",\"children\":\"Rivet: Open-Source Serverless Infrastructure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"I'm the founder of Rivet and have a vested interest in seeing stateful serverless become a standard. Rivet provides an open-source stateful serverless platform that can be easily self-hosted.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We also provide a handful of features in our runtime that don't make sense to be part of a standard, since the best W3C standards build on existing web standards: \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/containers\",\"children\":\"Docker containers for non-JavaScript applications\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/networking\",\"children\":\"HTTP, UDP, and TCP support\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/durability\",\"children\":\"advanced lifecycle management\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/api/actors/create\",\"children\":\"actor tagging\"}],\" for advanced multi-tenant applications, \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/api/actors/upgrade-all\",\"children\":\"advanced control over actor upgrades\"}],\" for companies with specific use cases, \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/api/regions/list\",\"children\":\"fine-grained control over where your actor is running\"}],\", and a developer-friendly REST API for managing Rivet Actors.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We encourage developers building on Rivet to use \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit\",\"children\":\"RivetKit\"}],\". However, we also provide a \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/actors\",\"children\":\"low-level API\"}],\" for defining actors:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$26\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Unlike Durable Objects, Rivet's core API design opts to lean into Unix-like patterns such as using \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SIGINT\"}}],\" signals, leveraging \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"process.exit\"}}],\", and using environment variables.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Check out the \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivet\",\"children\":\"source code on GitHub\"}],\".\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"rivet-kit-framework-stateful-serverless-on-any-cloud\",\"children\":\"RivetKit Framework: Stateful Serverless On Any Cloud\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"At Rivet, we also manage a framework called \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit\",\"children\":\"RivetKit\"}],\" that provides a Durable Object-like experience on any cloud that provides \",[\"$\",\"em\",null,{\"children\":\"stateless\"}],\" serverless.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"A Rivet Actor definition looks something like this:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$27\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Under the hood is where it gets interesting: RivetKit is intended to support as many platforms as possible and is \",[\"$\",\"strong\",null,{\"children\":\"completely abstracted with drivers\"}],\". By doing so, RivetKit supports Rivet, Cloudflare Durable Objects, Bun, Node.js. Vercel, Supabase, Deno, and Lambda are coming in the near future.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"These drivers provide a \",[\"$\",\"strong\",null,{\"children\":\"peek at what a standard might require\"}],\", since they're already abstracted to be platform-agnostic:\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit/blob/a9a5cfa5b91aff73889bbbee965d52221f89c2c7/packages/actor-core/src/actor/driver.ts#L12\",\"children\":\"ActorDriver\"}]}],\": Manages actor state, lifecycle, and persistence\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$28\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit/blob/a9a5cfa5b91aff73889bbbee965d52221f89c2c7/packages/actor-core/src/manager/driver.ts#L5\",\"children\":\"ManagerDriver\"}]}],\": Handles actor discovery, routing, and scaling\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$29\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"There is also a \",[\"$\",\"strong\",null,{\"children\":[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit/blob/a9a5cfa5b91aff73889bbbee965d52221f89c2c7/packages/actor-core/src/topologies/coordinate/driver.ts#L29\",\"children\":\"CoordinatedDriver\"}]}],\" that provides support for implementing actors over peer-to-peer for platforms that don't natively support stateful serverless. This would not apply to an actor standard.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Read more about \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit/tree/main/docs\",\"children\":\"building your own RivetKit drivers\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Check out the \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivet\",\"children\":\"source code on GitHub\"}],\".\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"other-actor-runtimes-the-precursor-to-stateful-serverless\",\"children\":\"Other Actor Runtimes: The Precursor To Stateful Serverless\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Runtimes like OTP (i.e. Erlang \u0026 Elixir \u0026 Gleam), Akka, Orleans, Actix, and Swift Actors all \",[\"$\",\"strong\",null,{\"children\":\"lack built-in support for persisted state\"}],\". There are libraries that provide state for actors, but their models are significantly different than what we'll consider here. Additionally, we're focused on JavaScript since that's primary language for web standards.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"specification-goals\",\"children\":\"Specification Goals\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For the purpose of this exploration, I'm going to \",[\"$\",\"strong\",null,{\"children\":\"recommend sticking with web standards\"}],\", which are managed by the \",[\"$\",\"$La\",null,{\"href\":\"https://www.w3.org/\",\"target\":\"_blank\",\"children\":\"W3C\"}],\" organization. Doing so allows us to \",[\"$\",\"strong\",null,{\"children\":\"build on top of existing successful web standards\"}],\", such as \",[\"$\",\"$La\",null,{\"href\":\"https://wintertc.org/\",\"target\":\"_blank\",\"children\":\"WinterTC\"}],\" and the \",[\"$\",\"$La\",null,{\"href\":\"https://fetch.spec.whatwg.org/#request-class\",\"target\":\"_blank\",\"children\":\"fetch specification\"}],\" that are currently offered across almost all stateless serverless platforms already.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The goals of this proposal are:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Simplicity Of Implementation\"}],\": Implementing standards correctly is difficult, expensive, and highly error prone. Simpler is better.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Simplicity Of Usage\"}],\": Stateful serverless is not a concept that is easy for many developers to understand. Prefer simplicity vs advanced features to keep the API as simple as possible for greater adoption.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Build For Frameworks\"}],\": \",[\"$\",\"$La\",null,{\"href\":\"https://hono.dev/\",\"target\":\"_blank\",\"children\":\"Hono\"}],\" and \",[\"$\",\"$La\",null,{\"href\":\"https://itty.dev/itty-router/\",\"target\":\"_blank\",\"children\":\"itty-router\"}],\" already proved that frameworks are almost always used with serverless runtimes. Stateful serverless is already used widely with \",[\"$\",\"$La\",null,{\"href\":\"https://www.partykit.io/\",\"target\":\"_blank\",\"children\":\"PartyKit\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit\",\"target\":\"_blank\",\"children\":\"RivetKit\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/agents/\",\"target\":\"_blank\",\"children\":\"Agents\"}],\", and misc tools like \",[\"$\",\"$La\",null,{\"href\":\"https://tinybase.org/\",\"target\":\"_blank\",\"children\":\"TinyBase\"}],\". If possible, leave functionality up to frameworks to implement.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Built On Existing Web Development Paradigms\"}],\": Stateful serverless is very similar to \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API\",\"target\":\"_blank\",\"children\":\"Web Workers\"}],\". Where possible refer to Web Workers to see what works well.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Focus On Stateful Workloads, Not Actors\"}],\": I love building distributed systems with the actor model, but actors require extra consideration around message handling, concurrency, and backpressure.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"classes-vs-functions\",\"children\":\"Classes vs Functions\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Durable Objects provides a class-based approach to stateful serverless (e.g. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"class X extends DurableObject { ... }\"}}],\"). Rivet provides a functional approach (e.g. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"export default { start () { ... } }\"}}],\").\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Sticking to the WinterTC ESM-style makes sense. Additionally, it's similar to how Web Workers are already defined.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"alternative-1-fetch-based-communication\",\"children\":\"Alternative #1: Fetch-Based Communication\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Both Rivet \u0026 Durable Objects use WinterTC-like \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"fetch\"}}],\" handlers to accept requests on Durable Objects/Rivet Actors. An alternative spec would opt to use \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"fetch\"}}],\" handlers instead of a brand new definition. This is similar to what WinterTC is attempting to do: take existing patterns and standardize them as opposed to implementing a new standard.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This standard makes an intentional decision to define a simpler, more portable API than provide compatibility with only 2 existing implementations.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"alternative-2-a-cgi-like-standard\",\"children\":\"Alternative #2: A CGI-Like Standard\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"An alternative implementation is to consider something along the lines of \",[\"$\",\"$La\",null,{\"href\":\"https://en.wikipedia.org/wiki/Common_Gateway_Interface\",\"children\":\"CGI\"}],\" which provides a more Unix-like implementation of serverless functions \u0026 supports multiple languages. However, the industry has consolidated behind JavaScript \u0026 WebAssembly for serverless clouds because of the developer \u0026 cost efficiency. Additionally, CGI lacks many of the modern features that W3C specifications take into account for web standards. (Originally proposed by \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/mitsuhiko\",\"children\":\"Armin Ronacher\"}],\".)\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"drawing-inspiration-from-shared-worker\",\"children\":[\"Drawing Inspiration From \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}]]}],\"\\n\",[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/sharedworker.1a0b47fb.png\",\"height\":934,\"width\":1258,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAGCAMAAADJ2y/JAAAACVBMVEUfGxsTExMqICDPjCNjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAIklEQVR4nCWJgQkAAAyCtP+PHrUgC8QGZJsA7aMMU1btiAcEFgAnkkrSDQAAAABJRU5ErkJggg==\",\"blurWidth\":8,\"blurHeight\":6},\"alt\":\"Overview of SharedWorker arch\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Though designed for client-side concurrency, \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}]}],\" offers a programming model that closely resembles what we're discussing for server-side actors. The \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" API already has many of the core concepts needed for a stateful serverless standard:\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Multi-Tenant\"}],\": \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" can serve multiple browser tabs, similar to how Durable Objects and Rivet Actors serves multiple clients\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Isolated Execution Context\"}],\": Each worker runs in its own isolated environment\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Message-Based Communication\"}],\": Workers communicate via structured message passing.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"You can think of a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" like a \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}]}],\" that is:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":\"In the cloud\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Includes persistent storage\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"Runs forever\"}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Here's a comparison of how Web Workers operate in the browser:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"SharedWorker\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"SharedWorker/.0\",{\"value\":\"SharedWorker\",\"children\":\"SharedWorker\"}],[\"$\",\"$L2c\",\"DurableObject/.1\",{\"value\":\"DurableObject\",\"children\":\"DurableObject\"}],[\"$\",\"$L2c\",\"RivetKit/.2\",{\"value\":\"RivetKit\",\"children\":\"RivetKit\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"SharedWorker/.0\",{\"value\":\"SharedWorker\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$2e\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"DurableObject/.1\",{\"value\":\"DurableObject\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$2f\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"RivetKit/.2\",{\"value\":\"RivetKit\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$30\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"onmessage\"}}],\" handler is very similar to the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"fetch\"}}],\" handler in a Durable Object or an \",[\"$\",\"$La\",null,{\"href\":\"/docs/actors/actions\",\"children\":\"Action\"}],\" in RivetKit.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The key differences are:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Persistence\"}],\": Web Workers lose state when the page refreshes, while \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s maintain state between invocations.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Network Access\"}],\": Stateful serverless inherently supports network requests via fetch/WebSockets.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Lifecycle Management\"}],\": \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s have advanced wake/sleep and scheduling capabilities.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"introducing-serverless-worker\",\"children\":[\"Introducing \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}]]}],\"\\n\",[\"$\",\"$L1f\",null,{\"src\":{\"src\":\"/_next/static/media/serverlessworker.224d7149.png\",\"height\":1060,\"width\":1916,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAECAMAAACEE47CAAAACVBMVEUTExMcGRkmHx/6SzHQAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAH0lEQVR4nCXJsQ0AAAyDMOD/oyulLB6AJShZ4sg/5AEBxAAb6hcIGwAAAABJRU5ErkJggg==\",\"blurWidth\":8,\"blurHeight\":4},\"alt\":\"Overview of ServerlessWorker arch\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" is an API similar to the existing Web Workers API that provides the core functionality of both Cloudflare Durable Objects and Rivet Actors:\"]}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Multi-Tenant\"}],\": \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" can serve multiple clients at the same time in realtime.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Message-Based Communication\"}],\": Communicates via \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"postMessage\"}}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Persistent\"}],\": \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorkers\"}}],\" run forever. They cannot crash. Implementations of the standard can optionally make workers sleep when there is no activity.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Storage\"}],\": \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorkers\"}}],\" can store data that persists for ever. Implementations of the standard should design this data to be stored next to compute for optimal read-write performance.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Isolated Execution Context\"}],\": Each worker runs in its own isolated environment\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"creating-initializing-and-addressing-serverless-workers\",\"children\":[\"Creating, Initializing, \u0026 Addressing \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Rivet \u0026 RivetKit\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Rivet and RivetKit provide a tagging system for organizing actors. This allows you to build more manageable multi-tenant applications with complex requirements. For example:\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Rivet allows you to create actors with the \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/api/actors/create\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"actors.create\"}}]}],\" endpoint. The API accepts environment variables to configure how the actor behaves.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"RivetKit allows passing tags to \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/rivetkit\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"client.get({ /* tags */ })\"}}]}],\" to get or create an actor, but does not provide environment variables. You can also use the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"client.create\"}}],\" method to create a fresh actor. Actors can read their own tags to configure behavior accordingly:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$31\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Durable Objects\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"To create a Durable Object on Cloudflare, you call the \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/api/namespace/#newuniqueid\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"newUniqueId\"}}]}],\" method. This will give you a unique ID for a new Durable Object.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Cloudflare also provides a \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/api/namespace/#idfromname\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"idFromName\"}}]}],\" method to get the ID of an Durable Object from an arbitrary string. This ID is then used to resolve a Durable Object stub that you can send requests to. For example:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"TypeScript\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$32\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Cloudflare Durable Objects is desigend to have no concept of \\\"created\\\" or \\\"destroyed.\\\" The initial state can be configured by sending an RPC to the DO upon creation. This implementation of not having an input state for a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" is simpler and leaves the functionality up to the framework; instead all a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" has a unique ID that developers can send messages to.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"Current Implementation: \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" accepts a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"name\"}}],\" parameter, for example: \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"new SharedWorker(\u0026quot;./sharedWorker.js\u0026quot;, \"}}],\"chat-room-random\",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\")\"}}],\". This is akin to calling \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"idFromName\"}}],\" for Durable Objects. Passing no name will give you the same worker.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"name\"}}],\" is accessible in the global scope of the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Constructing a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" object will mimic the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" API. Passing a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"name\"}}],\" parameter to the second constructor argument will let you address a given \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\". Passing no arguments will give you the same worker.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"name\"}}],\" is accessible in the global scope of the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"An example API could look like:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"server.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$33\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To resolve with a custom name:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"server.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$34\"}}]}]}]]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"To access the name in the worker:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"worker.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cpre class=\\\"shiki ayu-dark\\\" style=\\\"background-color:#0c0a09;color:#bfbdb6\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#ACB6BF8C;font-style:italic\\\"\u003e// Worker code can access its name\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003econsole\u003c/span\u003e\u003cspan style=\\\"color:#F29668\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003elog\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e(self\u003c/span\u003e\u003cspan style=\\\"color:#F29668\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003ename)\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6B3\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"terminating-serverless-workers\",\"children\":[\"Terminating \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Rivet\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Rivet provides two ways to destroy an actor: use \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"process.exit(0)\"}}],\" or call \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/api/actors/destroy\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"actors.destroy\"}}]}],\" from the API.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"RivetKit will provide a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ctx.shutdown\"}}],\" method that delegates to \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ActorDriver\"}}],\", though is not currently implemented.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Durable Objects\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Cloudflare's approach to destroying Durable Objects is somewhat unique. There is no concept of \\\"created\\\" or \\\"destroyed\\\" actor. To reset an actor, you clear the storage with \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/api/storage-api/#deleteall\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"deleteAll()\"}}]}],\". While unintuitive, this leaves it up to the framework to implement.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"Current Implementation: \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Web Workers' \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" is automatically destroyed when all ports are closed. This is not relevant to stateful serverless.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Add a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"terminate\"}}],\" method on the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" itself, leave it up to the frameworks to implement destroying. For example:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"worker.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cpre class=\\\"shiki ayu-dark\\\" style=\\\"background-color:#0c0a09;color:#bfbdb6\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003eexport\u003c/span\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003e default\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003e\\tconnect\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#D2A6FF\\\"\u003eevent\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e) {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e\\t\\tself\u003c/span\u003e\u003cspan style=\\\"color:#F29668\\\"\u003e.\u003c/span\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003eterminate\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e()\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6B3\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e\\t}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"connections-and-messages\",\"children\":\"Connections \u0026 Messages\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Rivet\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Both Rivet Actors \u0026 Durable Objects provide a way to serve requests to actors based on web standards.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Rivet provides flexible networking infrastructure, including \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/networking\",\"children\":\"UDP, TCP, and host networking\"}],\". To remain widely compatible, Rivet relies on the Deno implementation of the fetch handler with \",[\"$\",\"$La\",null,{\"href\":\"https://docs.deno.com/api/deno/~/Deno.serve\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"Deno.serve\"}}]}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Cloudflare\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Durable Objects supports a similar \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/best-practices/create-durable-object-stubs-and-send-requests/#invoking-the-fetch-handler\",\"children\":\"fetch handler\"}],\", but also provides non-standard features like \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/best-practices/create-durable-object-stubs-and-send-requests/\",\"children\":\"RPC\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Both rely on different implementations for WebSockets, though this handled gracefully by libraries like \",[\"$\",\"$La\",null,{\"href\":\"https://hono.dev/docs/helpers/websocket\",\"children\":\"Hono's WebSocket helper\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"There is a WinterTC proposal for a \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/wintercg/proposal-sockets-api\",\"children\":\"Sockets API\"}],\", though I'm going to consider this out of the scope of this article since \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/workers/runtime-apis/tcp-sockets/\",\"children\":\"Cloudflare's implementation\"}],\" is not currently supported on Durable Objects.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":[\"Current Implementation: \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"However, Web Worker (\",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\") opts for using \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"onconnect\"}}],\" \u0026 \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"port.onmessage\"}}],\" like this:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"main.js\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"main.js/.0\",{\"value\":\"main.js\",\"children\":\"main.js\"}],[\"$\",\"$L2c\",\"sharedWorker.js/.1\",{\"value\":\"sharedWorker.js\",\"children\":\"sharedWorker.js\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"main.js/.0\",{\"value\":\"main.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$35\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"sharedWorker.js/.1\",{\"value\":\"sharedWorker.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$36\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"This could go two ways: lean into the existing \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/wintercg/proposal-functions-api/tree/main\",\"children\":\"WinterTC for ESM-style handlers\"}],\" like Durable Objects and Rivet or opt for a simpler \u0026 portable interface like Web Workers.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"In my opinion, request/response should use ESM-style exports with the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" interface. This allows the simplicity of request/response \u0026 also enables full bidirectional streaming -- like a WebSocket but without the overhead.\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"server.js\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"server.js/.0\",{\"value\":\"server.js\",\"children\":\"server.js\"}],[\"$\",\"$L2c\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":\"server.js\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"server.js/.0\",{\"value\":\"server.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$37\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$38\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Coincidentally, this also feels very similar to socket.io whose API has proven itself as flexible \u0026 easy to understand.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"storage\",\"children\":\"Storage\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementations: Rivet \u0026 Durable Objects \u0026 Deno\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Both Rivet and Durable Objects support a raw KV interface to access data stored on the actor itself.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"While not specific to actors, Deno attempts to implement an \",[\"$\",\"$La\",null,{\"href\":\"https://docs.deno.com/api/deno/~/Deno.Kv\",\"children\":\"abstract KV interface\"}],\". However, this API is very opinionated to Deno Deploy and is by no means compatible across multiple clouds.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Why KV\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Anything more (especially \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"IndexedDB\"}}],\") is too complicated to expect cloud providers to implement correctly. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"localStorage\"}}],\" has proven itself a simple \u0026 reliable key-value store that's lasted the test of time.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Frameworks can implement more advanced logic on top of key-value stores, just as they've done in the browser with \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"localStorage\"}}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Async\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Regardless of what API this results in, it should be asynchronous. Cloudflare has gone as far as removing async code for their SQLite interface because they state it's fast enough to not require an async context; the KV API could likely be made as simple as something like the browser's \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"localStorage\"}}],\" by making each key a synchronous get. However, platforms all implement KV differently, so this may not make sense if attempting to provide maximum compatibility. Additionally, it would be impossible for compatibility layers to implement a KV API with an external medium if that medum requires an async operation to communicate with.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Strings vs Structured Clone\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"localStorage\"}}],\" currently only supports strings, which is what most developers are used to.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"However, both Rivet \u0026 Cloudflare Workers support natively storing data types that implement \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API/Structured_clone_algorithm\",\"children\":\"structured cloning\"}],\" which allows storing many types of data in a compact V8-compatible binary interface with high-performance serialization \u0026 deserialization.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If structured cloning was a protocol defined earlier, \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"localStorage\"}}],\" would likely support it natively. Whatever storage mechanism is chosen should support structured cloning.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"A Word On Complexity\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"W3C has a history of inventing incredibly complicated standards for storage that are both (a) hard to understand as developers and (b) difficult to implement as a platform.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you know how to use the \",[\"$\",\"$La\",null,{\"href\":\"https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API\",\"children\":\"IndexedDB\"}],\" API from memory, I'm impressed.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Additionally, \",[\"$\",\"$La\",null,{\"href\":\"https://developer.chrome.com/blog/deprecating-web-sql\",\"children\":\"Web SQL\"}],\" was an alternative standard that was deprecated because of its complexity.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Whatever the storage mechanism for \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s is, \",[\"$\",\"strong\",null,{\"children\":\"keep it simple, easy to implement, and easy to understand\"}],\". Frameworks can always do the heavy lifting for you.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Concurrency \u0026 Input/Output Gates\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Concurrency is difficult to implement correctly across multiple platforms.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Cloudflare Durable Objects intelligently prevents common storage race conditions on Durable Objects without transactions through a mechanism called \",[\"$\",\"em\",null,{\"children\":\"input/output gates\"}],\" detailed \",[\"$\",\"$La\",null,{\"href\":\"https://blog.cloudflare.com/durable-objects-easy-fast-correct-choose-three/#our-answer-make-it-automatic\",\"children\":\"here\"}],\". This can be disabled with \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ctx.storage.get(/* key*/, { allowConcurrency: true })\"}}],\". Doing so will make the KV work like naive get/set without any extra functionality.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This is a controversial opinion, but I think that this behavior should be disabled by default and not part of a specification for a few reasons:\"}],\"\\n\",[\"$\",\"ol\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Durable Object users almost never read from storage at runtime. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"storage.get\"}}],\" is called in the constructor and \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"storage.put\"}}],\" is called when changed.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This behavior can be implemented at the framework level.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":\"This behavior is almost certainly going to be incorrectly implemented by vendors.\"}],\"\\n\",[\"$\",\"li\",null,{\"children\":[\"Input/output gates do not work with WebSocket on Durable Objects already (please correct me if I'm wrong) and most developers aren't accounting for this. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"postMessage\"}}],\" and \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"onmessage\"}}],\" are closer to the Durable Object WebSocket behavior than the RPC behavior.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Keeping Scope Small\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"For the purpose of building a broader picture of what \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" might look like in practice, I'm going to assume that storage is going to be part of this specification. However, I think it makes more sense to either (a) find an existing mature spec to use for storage or (b) define a separate spec that can work in contexts outside of \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Provide a dead simple async structured clone-based KV API and let the platforms provide extra configs for concurrency. For example:\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"worker.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$39\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"scheduling\",\"children\":\"Scheduling\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementations\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A core part of \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s is to be able to run a function at an arbitrary timestamp.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Cloudflare provides a simple \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"setAlarm\"}}],\" API that has a single alarm. If you already have an alarm, it will override that alarm. I like this API since it's significantly simpler than \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"setInterval\"}}],\" and \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"setTimeout\"}}],\" and lets frameworks provide more advanced APIs, such as CRONs.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Provide an API similar to Cloudflare's \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/api/storage-api/#setalarm\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"setAlarm\"}}]}],\". For example:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"worker.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$3a\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"sleeping-and-upgrading-and-host-migrations\",\"children\":\"Sleeping \u0026 Upgrading \u0026 Host Migrations\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"A core advantage of \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s to something like \",[\"$\",\"$La\",null,{\"href\":\"https://kubernetes.io/docs/concepts/workloads/controllers/job/\",\"children\":\"Kubernetes jobs\"}],\" or other container-based stateful workloads: \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s can \",[\"$\",\"strong\",null,{\"children\":\"automatically sleep when there are no active operations\"}],\" and \",[\"$\",\"strong\",null,{\"children\":\"wake upon either fetch or alarm\"}],\".\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"However, \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" has to address specific edge cases when there are tasks that need to run in the background before being put to sleep.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Rivet\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Rivet mimics Unix behavior by sending a \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SIGINT\"}}],\" signal to the process when it plans to go to sleep. Your application is given time to clean up any work and restart gracefully when it's ready. This provides compatibility for a wide range of existing frameworks that implement the Node.js or Deno shutdown handler.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Durable Objects\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Durable Objects provides \",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/api/state/#waituntil\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"waitUntil\"}}]}],\". My understanding is this is effectively a noop since (\",[\"$\",\"$La\",null,{\"href\":\"https://developers.cloudflare.com/durable-objects/api/state/#waituntil\",\"children\":\"see note\"}],\"). However, I like the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"waitUntil\"}}],\" API since it provides a JavaScript-y way of forcing the actor to stay awake.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Provide an API similar to Durable Objects \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"waitUntil\"}}],\". The provider can decide the maximum duration for this function. For example:\"]}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[[\"$\",\"div\",null,{\"className\":\"text-foreground flex items-center justify-between gap-2 border-b p-2 text-xs\",\"children\":[[\"$\",\"div\",null,{\"className\":\"text-muted-foreground flex items-center gap-1\",\"children\":[\"$\",\"div\",null,{\"ref\":\"$undefined\",\"className\":\"inline-flex items-center tracking-normal rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 whitespace-nowrap max-w-full overflow-hidden truncate text-foreground\",\"children\":\"worker.js\"}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"\u003cpre class=\\\"shiki ayu-dark\\\" style=\\\"background-color:#0c0a09;color:#bfbdb6\\\" tabindex=\\\"0\\\"\u003e\u003ccode\u003e\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003easync\u003c/span\u003e\u003cspan style=\\\"color:#FF8F40\\\"\u003e function\u003c/span\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003e doSomethingAsync\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e() {\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#ACB6BF8C;font-style:italic\\\"\u003e\\t// ...\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e}\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003ewaitUntil\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e(\u003c/span\u003e\u003cspan style=\\\"color:#FFB454\\\"\u003edoSomethingAsync\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6\\\"\u003e())\u003c/span\u003e\u003cspan style=\\\"color:#BFBDB6B3\\\"\u003e;\u003c/span\u003e\u003c/span\u003e\\n\u003cspan class=\\\"line\\\"\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\"}}]}]}]]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"handling-backpressure\",\"children\":\"Handling Backpressure\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Backpressure is a core problem in every distributed system and should always be handled carefully by developers to handle load gracefully.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Rivet\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Rivet provides low-level primitives to the developer, so it's up to the developer to handle backpressure accordingly. An overloaded actor without any special backpressure handling will saturate the CPU.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Current Implementation: Durable Objects\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Durable Objects throw an error with the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\".overloaded\"}}],\" property set to \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"true\"}}],\" when making requests to a Durable Object that cannot accept more requests.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Define an error type that can be used by developers to handle backpressure gracefully.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"security-model\",\"children\":\"Security Model\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"strong\",null,{\"children\":\"Proposal\"}]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" should rely on the existing work in WinterTC. They are secured via these attributes:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Fetch Handler\"}],\": Stateful \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s are only accessible through the stateless serverless fetch handler defined in WinterTC. This creates a protected gateway where all requests are authenticated and authorized before reaching any \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Isolation Boundaries\"}],\": Each \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" runs in its own isolated environment, similar to Web Workers, preventing cross-worker data access without explicit communication channels.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"No Direct Network Access\"}],\": \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s cannot be directly addressed from the public internet. All communication flows through the fetch handler, which can implement rate limiting, validation, and other security controls.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"The downside of relying on the fetch handler is that it may restrict who can implement \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\". For example, there are many container orchestration platforms that may be able to implement the worker part of \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\", but cannot implement the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"fetch\"}}],\" handler. I don't think this is an issue, since including these technologies that don't already comply to WinterTC would make it too broad to be effective.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"out-of-scope\",\"children\":\"Out Of Scope\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Items out of the scope for this spec:\"}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Locality\"}],\": Cloudflare \u0026 Rivet both have notions of where actors run, though the default is to run nearest where the request is coming from. This will likely end up as a platform-specific feature when constructing \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Supervisors\"}],\": Traditional actor runtimes use \\\"supervisors\\\" to automatically restart crashed actors. \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" cannot crash, and instead will automatically log and disregard thrown errors -- similar to service workers.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"SQLite Storage\"}],\": Many serious use cases of Durable Objects rely on SQLite. This is out of the scope for this web standard.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Versioning\"}],\": Cloudflare and Rivet each have significantly different ways of implementing versioning. Rivet is more like AWS AMI, while Cloudflare uses a simpler but less flexible version history.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Upgrades \u0026 Rolling Deploys\"}],\": Leave it up to the platform to decide what code is running. Under the hood, the Rivet implementation of this standard would automatically call \",[\"$\",\"$La\",null,{\"href\":\"https://rivet.gg/docs/cloud/api/actors/upgrade\",\"children\":[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"actors.upgrade\"}}]}]]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Logging\"}],\": Leave this up to the platform to decide how to ship logs.\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"full-examples\",\"children\":\"Full Examples\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"rate-limiter\",\"children\":\"Rate Limiter\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This example demonstrates building a rate limit.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"rateLimiter.js\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"rateLimiter.js/.0\",{\"value\":\"rateLimiter.js\",\"children\":\"rateLimiter.js\"}],[\"$\",\"$L2c\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":\"server.js\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"rateLimiter.js/.0\",{\"value\":\"rateLimiter.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$3b\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$3c\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"pub-sub-server\",\"children\":\"Pub/Sub Server\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This example demonstrates a simple pub/sub system where each topic is its own serverless worker with connected clients.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"topicWorker.js\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"topicWorker.js/.0\",{\"value\":\"topicWorker.js\",\"children\":\"topicWorker.js\"}],[\"$\",\"$L2c\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":\"server.js\"}],[\"$\",\"$L2c\",\"client.js/.2\",{\"value\":\"client.js\",\"children\":\"client.js\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"topicWorker.js/.0\",{\"value\":\"topicWorker.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$3d\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$3e\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"client.js/.2\",{\"value\":\"client.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$3f\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"simple-chat-room\",\"children\":\"Simple Chat Room\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This example demonstrates a simple chat room implementation with message persistence.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"chatRoom.js\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"chatRoom.js/.0\",{\"value\":\"chatRoom.js\",\"children\":\"chatRoom.js\"}],[\"$\",\"$L2c\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":\"server.js\"}],[\"$\",\"$L2c\",\"client.js/.2\",{\"value\":\"client.js\",\"children\":\"client.js\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"chatRoom.js/.0\",{\"value\":\"chatRoom.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$40\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$41\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"client.js/.2\",{\"value\":\"client.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$42\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"redis-like-server\",\"children\":\"Redis-Like Server\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"This example demonstrates a minimalistic Redis-like key-value store server with get, set, and delete operations.\"}],\"\\n\",[\"$\",\"div\",null,{\"className\":\"code-group group my-4 rounded-md border pt-2\",\"data-code-group\":true,\"children\":[\"$\",\"$L2a\",null,{\"defaultValue\":\"redisWorker.js\",\"children\":[[\"$\",\"div\",null,{\"className\":\"flex gap-1 border-b pr-2\",\"children\":[[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"viewportProps\":{\"className\":\"[\u0026\u003ediv]:!table\"},\"children\":[\"$\",\"$L2b\",null,{\"className\":\"border-b-0\",\"children\":[[\"$\",\"$L2c\",\"redisWorker.js/.0\",{\"value\":\"redisWorker.js\",\"children\":\"redisWorker.js\"}],[\"$\",\"$L2c\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":\"server.js\"}],[\"$\",\"$L2c\",\"client.js/.2\",{\"value\":\"client.js\",\"children\":\"client.js\"}]]}]}],[\"$\",\"$L21\",null,{\"trigger\":[\"$\",\"$L22\",null,{\"children\":[\"$\",\"button\",null,{\"className\":\"group group/button inline-flex items-center justify-center whitespace-nowrap rounded-md font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:z-10 relative aria-disabled:pointer-events-none aria-disabled:opacity-50 disabled:pointer-events-none disabled:opacity-50 hover:bg-accent hover:text-accent-foreground h-7 w-7 text-xs [\u0026_svg]:size-3 gap-1.5 text-foreground\",\"ref\":\"$undefined\",\"disabled\":\"$undefined\",\"children\":[null,[\"$\",\"svg\",null,{\"aria-hidden\":\"true\",\"focusable\":\"false\",\"data-prefix\":\"fas\",\"data-icon\":\"copy\",\"className\":\"svg-inline--fa fa-copy \",\"role\":\"img\",\"xmlns\":\"http://www.w3.org/2000/svg\",\"viewBox\":\"0 0 448 512\",\"style\":{},\"ref\":\"$undefined\",\"children\":[\"$\",\"path\",null,{\"fill\":\"currentColor\",\"d\":\"M208 0L332.1 0c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9L448 336c0 26.5-21.5 48-48 48l-192 0c-26.5 0-48-21.5-48-48l0-288c0-26.5 21.5-48 48-48zM48 128l80 0 0 64-64 0 0 256 192 0 0-32 64 0 0 48c0 26.5-21.5 48-48 48L48 512c-26.5 0-48-21.5-48-48L0 176c0-26.5 21.5-48 48-48z\",\"style\":{}}]}],null]}]}],\"content\":\"Copy code\"}]]}],[[\"$\",\"$L2d\",\"redisWorker.js/.0\",{\"value\":\"redisWorker.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$43\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"server.js/.1\",{\"value\":\"server.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$44\"}}]}]}]]}]}],[\"$\",\"$L2d\",\"client.js/.2\",{\"value\":\"client.js\",\"children\":[\"$\",\"div\",null,{\"className\":\"not-prose my-4 rounded-md border group-[.code-group]:my-0 group-[.code-group]:-mt-2 group-[.code-group]:border-none\",\"data-code-group\":true,\"children\":[null,[\"$\",\"div\",null,{\"className\":\"bg-background text-wrap p-2 text-sm\",\"children\":[\"$\",\"$L23\",null,{\"className\":\"w-full\",\"children\":[\"$\",\"span\",null,{\"className\":\"not-prose code\",\"dangerouslySetInnerHTML\":{\"__html\":\"$45\"}}]}]}]]}]}]]]}]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"more-thought-required\",\"children\":\"More Thought Required\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"data-migrations\",\"children\":\"Data Migrations\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"WinterTC is great specification for stateless serverless since migrating providers is as simple as updating a DNS record.\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"However, stateful serverless is significantly different since \",[\"$\",\"strong\",null,{\"children\":\"this spec is effectively defining a database\"}],\", since \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\"s have persistent storage.\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If the whole point of defining a common specification for stateful serverless is to encourage companies to adopt new technologies, then they'll also need assurances on their ability to migrate between providers. For example, Postgres provides the ability to use \",[\"$\",\"$La\",null,{\"href\":\"https://www.postgresql.org/docs/current/logical-replication.html\",\"target\":\"_blank\",\"children\":\"logical replication\"}],\" for live migrations and is used frequently.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"storage-2\",\"children\":\"Storage\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"The storage is the most rough section of this spec. It probably justifies its own spec.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"connection-interruptions\",\"children\":\"Connection Interruptions\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"SharedWorker\"}}],\" connections cannot be interrupted. Can \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" connections be interrupted? What happens if they are?\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"next-steps\",\"children\":\"Next Steps\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"We \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/proposal-stateful-serverless-api\",\"children\":\"uploaded this proposal to GitHub\"}],\" for feedback and iteration. Once there's more momentum, I hope to move this out of the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"rivet-gg\"}}],\" organization in to an official W3C process.\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"feedback-on-git-hub\",\"children\":\"Feedback On GitHub\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"Please add feedback as a issue or pull request on the \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/proposal-stateful-serverless-api\",\"children\":\"proposal GitHub\"}],\".\"]}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":3,\"id\":\"reference-implementation\",\"children\":\"Reference Implementation\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":\"Once a general specification is implemented, a reference specification is trivial to implement on any of the providers previously mentioned. A compatibility layer could be implemented on the existing work with Rivet drivers.\"}],\"\\n\",[\"$\",\"$L20\",null,{\"level\":2,\"id\":\"survey-help-shape-the-specification\",\"children\":\"Survey: Help Shape the Specification\"}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"If you are either (a) a user of Durable Objects/Rivet actors or (b) want to aid in the direction, it'd be helpful to take the time to answer these questions as a \",[\"$\",\"$La\",null,{\"href\":\"https://github.com/rivet-gg/proposal-stateful-serverless-api/issues\",\"children\":\"GitHub issue\"}],\" on the proposal:\"]}],\"\\n\",[\"$\",\"ul\",null,{\"children\":[\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Do we attempt to specify existing APIs or implement based on existing work by W3C?\"}],\" This spec aims to build on patterns already defined by W3C, however it might make sense to stick to better documenting overlap between existing providers (currently only Durable Objects \u0026 Rivet as far as I know). My understanding is WinterTC attempted to create a spec that matched existing APIs. I'd be happy to rewrite this spec based on the \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"fetch\"}}],\" API if the answer to this is \",[\"$\",\"em\",null,{\"children\":\"yes\"}],\".\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"What are the most common hesitations for companies adopting stateful serverless?\"}],\" Is there something this spec can address?\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"What are the most common problems with stateful serverless that contributes to cognitive load?\"}],\" Does the simplicity of this spec help address that?\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"What reference design patterns should we be designing for?\"}],\" The examples attached attempt to provide a very basic overview of common patterns on Durable Objects, but does not cover use cases like worker-worker communication.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"How should storage be represented?\"}],\" This spec proposes using a simple KV. This storage mechanism might be too restrictive, or we might not want to write a spec for storage altogether and keep \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" very simple. It may make sense to leverage an existing storage spec or write a new separate storage spec that is combined with this.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Should this be broader than web technologies?\"}],\" This spec makes the assumption it's part of W3C and leverages web technologies. However, there are a few container platforms that do not use web technologies which might fall under this scope.\"]}],\"\\n\",[\"$\",\"li\",null,{\"children\":[[\"$\",\"strong\",null,{\"children\":\"Should this spec care about regions?\"}],\" \",[\"$\",\"code\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"ServerlessWorker\"}}],\" shine when they run at the edge. Should they have a default for configuring locations, similar to Rivet and Cloudflare?\"]}],\"\\n\"]}],\"\\n\",[\"$\",\"p\",null,{\"children\":[\"$\",\"em\",null,{\"children\":[\"Thanks to \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/LambrosPetrou\",\"children\":\"LambrosPetrou\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/firtozb\",\"children\":\"firtozb\"}],\", \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/uripont_\",\"children\":\"uripont_\"}],\", and \",[\"$\",\"$La\",null,{\"href\":\"https://x.com/p_mbanugo\",\"children\":\"p_mbanugo\"}],\" for feedback on the initial document.\"]}]}]],[\"$\",\"$L46\",null,{\"title\":\"Considering A W3C Standard For Stateful Serverless\"}]]}],[\"$\",\"aside\",null,{\"className\":\"order-2 min-w-0 max-w-xs flex-1 lg:order-3\",\"children\":[\"$\",\"$L47\",null,{\"tableOfContents\":[{\"title\":\"What Is Stateful Serverless?\",\"id\":\"what-is-stateful-serverless\",\"children\":[{\"title\":\"Stateless Serverless (Functions) vs Stateful Serverless (Workers)\",\"id\":\"stateless-serverless-functions-vs-stateful-serverless-workers\",\"children\":[]},{\"title\":\"Primary Use Cases\",\"id\":\"primary-use-cases\",\"children\":[]},{\"title\":\"Scope Of This Proposal\",\"id\":\"scope-of-this-proposal\",\"children\":[]}]},{\"title\":\"Why Should I Care?\",\"id\":\"why-should-i-care\",\"children\":[]},{\"title\":\"Why Build A Web Standard?\",\"id\":\"why-build-a-web-standard\",\"children\":[{\"title\":\"Customers Wary Of Vendor-Lock\",\"id\":\"customers-wary-of-vendor-lock\",\"children\":[]},{\"title\":\"Incentivize More Providers\",\"id\":\"incentivize-more-providers\",\"children\":[]}]},{\"title\":\"Today's Stateful Serverless Implementations\",\"id\":\"todays-stateful-serverless-implementations\",\"children\":[{\"title\":\"Cloudflare Durable Objects: The Most Popular Option\",\"id\":\"cloudflare-durable-objects-the-most-popular-option\",\"children\":[]},{\"title\":\"Cloudflare Agents Framework: Moving Beyond Durable Objects\",\"id\":\"cloudflare-agents-framework-moving-beyond-durable-objects\",\"children\":[]},{\"title\":\"Rivet: Open-Source Serverless Infrastructure\",\"id\":\"rivet-open-source-serverless-infrastructure\",\"children\":[]},{\"title\":\"RivetKit Framework: Stateful Serverless On Any Cloud\",\"id\":\"rivet-kit-framework-stateful-serverless-on-any-cloud\",\"children\":[]},{\"title\":\"Other Actor Runtimes: The Precursor To Stateful Serverless\",\"id\":\"other-actor-runtimes-the-precursor-to-stateful-serverless\",\"children\":[]}]},{\"title\":\"Specification Goals\",\"id\":\"specification-goals\",\"children\":[{\"title\":\"Classes vs Functions\",\"id\":\"classes-vs-functions\",\"children\":[]},{\"title\":\"Alternative #1: Fetch-Based Communication\",\"id\":\"alternative-1-fetch-based-communication\",\"children\":[]},{\"title\":\"Alternative #2: A CGI-Like Standard\",\"id\":\"alternative-2-a-cgi-like-standard\",\"children\":[]}]},{\"title\":\"Drawing Inspiration From SharedWorker\",\"id\":\"drawing-inspiration-from-shared-worker\",\"children\":[]},{\"title\":\"Introducing ServerlessWorker\",\"id\":\"introducing-serverless-worker\",\"children\":[{\"title\":\"Creating, Initializing, \u0026 Addressing ServerlessWorkers\",\"id\":\"creating-initializing-and-addressing-serverless-workers\",\"children\":[]},{\"title\":\"Terminating ServerlessWorkers\",\"id\":\"terminating-serverless-workers\",\"children\":[]},{\"title\":\"Connections \u0026 Messages\",\"id\":\"connections-and-messages\",\"children\":[]},{\"title\":\"Storage\",\"id\":\"storage\",\"children\":[]},{\"title\":\"Scheduling\",\"id\":\"scheduling\",\"children\":[]},{\"title\":\"Sleeping \u0026 Upgrading \u0026 Host Migrations\",\"id\":\"sleeping-and-upgrading-and-host-migrations\",\"children\":[]},{\"title\":\"Handling Backpressure\",\"id\":\"handling-backpressure\",\"children\":[]},{\"title\":\"Security Model\",\"id\":\"security-model\",\"children\":[]},{\"title\":\"Out Of Scope\",\"id\":\"out-of-scope\",\"children\":[]}]},{\"title\":\"Full Examples\",\"id\":\"full-examples\",\"children\":[{\"title\":\"Rate Limiter\",\"id\":\"rate-limiter\",\"children\":[]},{\"title\":\"Pub/Sub Server\",\"id\":\"pub-sub-server\",\"children\":[]},{\"title\":\"Simple Chat Room\",\"id\":\"simple-chat-room\",\"children\":[]},{\"title\":\"Redis-Like Server\",\"id\":\"redis-like-server\",\"children\":[]}]},{\"title\":\"More Thought Required\",\"id\":\"more-thought-required\",\"children\":[{\"title\":\"Data Migrations\",\"id\":\"data-migrations\",\"children\":[]},{\"title\":\"Storage\",\"id\":\"storage-2\",\"children\":[]},{\"title\":\"Connection Interruptions\",\"id\":\"connection-interruptions\",\"children\":[]}]},{\"title\":\"Next Steps\",\"id\":\"next-steps\",\"children\":[{\"title\":\"Feedback On GitHub\",\"id\":\"feedback-on-git-hub\",\"children\":[]},{\"title\":\"Reference Implementation\",\"id\":\"reference-implementation\",\"children\":[]}]},{\"title\":\"Survey: Help Shape the Specification\",\"id\":\"survey-help-shape-the-specification\",\"children\":[]}]}]}]]}],[\"$\",\"$L48\",null,{\"className\":\"mx-auto w-full mb-8 max-w-prose\"}]]\n"])</script><script>self.__next_f.push([1,"17:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n12:null\n"])</script><script>self.__next_f.push([1,"1a:{\"metadata\":[[\"$\",\"title\",\"0\",{\"children\":\"Considering A W3C Standard For Stateful Serverless\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"We're Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, give us a star on GitHub.\"}],[\"$\",\"meta\",\"2\",{\"name\":\"author\",\"content\":\"Nathan Flurry\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:title\",\"content\":\"Considering A W3C Standard For Stateful Serverless\"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:description\",\"content\":\"We're Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, give us a star on GitHub.\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:image\",\"content\":\"http://localhost:3000/_next/static/media/image.00c62794.png\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:image:width\",\"content\":\"2048\"}],[\"$\",\"meta\",\"7\",{\"property\":\"og:image:height\",\"content\":\"1024\"}],[\"$\",\"meta\",\"8\",{\"property\":\"og:type\",\"content\":\"article\"}],[\"$\",\"meta\",\"9\",{\"property\":\"article:published_time\",\"content\":\"2025-03-23T00:00:00.000Z\"}],[\"$\",\"meta\",\"10\",{\"property\":\"article:author\",\"content\":\"Nathan Flurry\"}],[\"$\",\"meta\",\"11\",{\"property\":\"article:section\",\"content\":\"Technical\"}],[\"$\",\"meta\",\"12\",{\"name\":\"twitter:card\",\"content\":\"summary_large_image\"}],[\"$\",\"meta\",\"13\",{\"name\":\"twitter:site\",\"content\":\"@rivetgg\"}],[\"$\",\"meta\",\"14\",{\"name\":\"twitter:title\",\"content\":\"Considering A W3C Standard For Stateful Serverless\"}],[\"$\",\"meta\",\"15\",{\"name\":\"twitter:description\",\"content\":\"We're Rivet, a new open-source, self-hostable serverless platform with a focus on stateful serverless. If you want to support our mission of building a production-ready and self-hostable serverless runtime, give us a star on GitHub.\"}],[\"$\",\"meta\",\"16\",{\"name\":\"twitter:image\",\"content\":\"http://localhost:3000/_next/static/media/image.00c62794.png\"}],[\"$\",\"meta\",\"17\",{\"name\":\"twitter:image:width\",\"content\":\"2048\"}],[\"$\",\"meta\",\"18\",{\"name\":\"twitter:image:height\",\"content\":\"1024\"}]],\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"15:{\"metadata\":\"$1a:metadata\",\"error\":null,\"digest\":\"$undefined\"}\n"])</script><script>self.__next_f.push([1,"1e:[\"$\",\"ul\",null,{\"className\":\"text-muted-foreground hidden list-disc pl-5 text-sm lg:block\",\"children\":[[\"$\",\"li\",\"2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas\",{\"className\":\"py-1\",\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog/2025-07-01-introducing-rivetkit-backend-libraries-that-replace-saas\",\"children\":\"Introducing RivetKit: Backend Libraries That Replace SaaS\"}]}],[\"$\",\"li\",\"2025-06-10-rivet-functions-launch\",{\"className\":\"py-1\",\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog/2025-06-10-rivet-functions-launch\",\"children\":\"Rivet Functions Launch\"}]}],[\"$\",\"li\",\"2025-03-15-cli-installation-fixes\",{\"className\":\"py-1\",\"children\":[\"$\",\"$La\",null,{\"href\":\"/changelog/2025-03-15-cli-installation-fixes\",\"children\":\"Rivet CLI Installation Update\"}]}]]}]\n"])</script></body></html>